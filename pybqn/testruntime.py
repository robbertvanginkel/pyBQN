import inspect
import unittest
import math

from pybqn.provide import provides, make_prims, bqnstr
from pybqn.program import BQNError, Program, Array, call
from pybqn.precompiled import r0, r1, r


class RuntimeTest(unittest.TestCase):
    def test_r0(self):
        vm = Program(*r0(provides))
        self.assertIsNotNone(vm())

    def test_r1(self):
        runtime_0 = Program(*r0(provides))()
        runtime_1 = Program(*r1(provides, runtime_0))()
        self.assertIsNotNone(runtime_1)

    def test_runtime(self):
        self.assertIsNotNone(Program(*r(provides))())


class RuntimeBasedTestCase(unittest.TestCase):
    def setUp(self) -> None:
        self.runtime, set_prims, _ = Program(*r(provides))()
        decompose, prim_ind, glyph = make_prims(self.runtime)
        call(set_prims, Array([decompose, prim_ind]))

    def runcases(self, cases: dict[str, tuple[int | float | type[Exception], list]]):
        for case, (expected, input) in cases.items():
            with self.subTest(case=case):
                if inspect.isclass(expected) and issubclass(expected, Exception):
                    with self.assertRaises(expected):
                        self.assertEqual(Program(*input)(), expected)
                else:
                    out = Program(*input)()
                    self.assertEqual(out, expected)


class PrimitiveTests(RuntimeBasedTestCase):
    """https://github.com/mlochbaum/BQN/blob/f4b09b675386c789c8296c96874871916a3abdcf/test/cases/prim.bqn"""

    def test_layer0(self):
        runtime = self.runtime
        # fmt: off
        self.runcases({
            "0≡¯2+2"                    : (1, [[0,4,0,0,0,3,17,0,1,0,2,17,7],[runtime[0],runtime[18],0,-2,2],[[0,1,0]],[[0,0]]]),
            "1e4≡5e3+5e3"               : (1, [[0,3,0,0,0,3,17,0,1,0,2,17,7],[runtime[0],runtime[18],10000,5000],[[0,1,0]],[[0,0]]]),
            "'c'≡'a'+2"                 : (1, [[0,2,0,0,0,4,17,0,1,0,3,17,7],[runtime[0],runtime[18],2,'c','a'],[[0,1,0]],[[0,0]]]),
            "'a'≡¯2+'c'"                : (1, [[0,4,0,0,0,2,17,0,1,0,3,17,7],[runtime[0],runtime[18],-2,'a','c'],[[0,1,0]],[[0,0]]]),
            "'a'+'c'"                   : (BQNError, [[0,2,0,0,0,1,17,7],[runtime[0],'a','c'],[[0,1,0]],[[0,0]]]),
            "F←-⋄f+2"                   : (BQNError, [[0,1,33,0,0,48,6,0,2,0,0,34,0,0,17,7],[runtime[0],runtime[1],2],[[0,1,0]],[[0,1]]]),
            "¯4≡+¯4"                    : (1, [[0,2,0,0,16,0,1,0,2,17,7],[runtime[0],runtime[18],-4],[[0,1,0]],[[0,0]]]),
            "+'x'"                      : (BQNError, [[0,1,0,0,16,7],[runtime[0],'x'],[[0,1,0]],[[0,0]]]),
            "F←-⋄+f"                    : (BQNError, [[0,1,33,0,0,48,6,34,0,0,0,0,16,7],[runtime[0],runtime[1]],[[0,1,0]],[[0,1]]]),
            "¯∞≡1e6-∞"                  : (1, [[0,4,0,0,0,3,17,0,1,0,2,17,7],[runtime[1],runtime[18],-math.inf,1000000,math.inf],[[0,1,0]],[[0,0]]]),
            "4≡-¯4"                     : (1, [[0,3,0,0,16,0,1,0,2,17,7],[runtime[1],runtime[18],4,-4],[[0,1,0]],[[0,0]]]),
            "¯∞≡-∞"                     : (1, [[0,3,0,0,16,0,1,0,2,17,7],[runtime[1],runtime[18],-math.inf,math.inf],[[0,1,0]],[[0,0]]]),
            "∞≡-¯∞"                     : (1, [[0,3,0,0,16,0,1,0,2,17,7],[runtime[1],runtime[18],math.inf,-math.inf],[[0,1,0]],[[0,0]]]),
            "4≡9-5"                     : (1, [[0,4,0,0,0,3,17,0,1,0,2,17,7],[runtime[1],runtime[18],4,9,5],[[0,1,0]],[[0,0]]]),
            "@≡'a'-97"                  : (1, [[0,2,0,0,0,4,17,0,1,0,3,17,7],[runtime[1],runtime[18],97,'\0','a'],[[0,1,0]],[[0,0]]]),
            "3≡'d'-'a'"                 : (1, [[0,4,0,0,0,3,17,0,1,0,2,17,7],[runtime[1],runtime[18],3,'d','a'],[[0,1,0]],[[0,0]]]),
            "'Q'≡'q'+'A'-'a'"           : (1, [[0,6,0,1,0,5,17,0,0,0,4,17,0,2,0,3,17,7],[runtime[0],runtime[1],runtime[18],'Q','q','A','a'],[[0,1,0]],[[0,0]]]),
            "97-'a'"                    : (BQNError, [[0,2,0,0,0,1,17,7],[runtime[1],97,'a'],[[0,1,0]],[[0,0]]]),
            "@-1"                       : (BQNError, [[0,1,0,0,0,2,17,7],[runtime[1],1,'\0'],[[0,1,0]],[[0,0]]]),
            "-'a'"                      : (BQNError, [[0,1,0,0,16,7],[runtime[1],'a'],[[0,1,0]],[[0,0]]]),
            "F←÷⋄-f"                    : (BQNError, [[0,1,33,0,0,48,6,34,0,0,0,0,16,7],[runtime[1],runtime[3]],[[0,1,0]],[[0,1]]]),
            "1.5≡3×0.5"                 : (1, [[0,4,0,0,0,3,17,0,1,0,2,17,7],[runtime[2],runtime[18],1.5,3,0.5],[[0,1,0]],[[0,0]]]),
            "2×'a'"                     : (BQNError, [[0,2,0,0,0,1,17,7],[runtime[2],2,'a'],[[0,1,0]],[[0,0]]]),
            "4≡÷0.25"                   : (1, [[0,3,0,0,16,0,1,0,2,17,7],[runtime[3],runtime[18],4,0.25],[[0,1,0]],[[0,0]]]),
            "∞≡÷0"                      : (1, [[0,3,0,0,16,0,1,0,2,17,7],[runtime[3],runtime[18],math.inf,0],[[0,1,0]],[[0,0]]]),
            "0≡÷∞"                      : (1, [[0,3,0,0,16,0,1,0,2,17,7],[runtime[3],runtime[18],0,math.inf],[[0,1,0]],[[0,0]]]),
            "÷'b'"                      : (BQNError, [[0,1,0,0,16,7],[runtime[3],'b'],[[0,1,0]],[[0,0]]]),
            "F←√-⋄÷f"                   : (BQNError, [[0,0,0,2,20,33,0,0,48,6,34,0,0,0,1,16,7],[runtime[1],runtime[3],runtime[5]],[[0,1,0]],[[0,1]]]),
            "1≡⋆0"                      : (1, [[0,3,0,0,16,0,1,0,2,17,7],[runtime[4],runtime[18],1,0],[[0,1,0]],[[0,0]]]),
            "¯1≡¯1⋆5"                   : (1, [[0,3,0,0,0,2,17,0,1,0,2,17,7],[runtime[4],runtime[18],-1,5],[[0,1,0]],[[0,0]]]),
            "1≡¯1⋆¯6"                   : (1, [[0,4,0,0,0,3,17,0,1,0,2,17,7],[runtime[4],runtime[18],1,-1,-6],[[0,1,0]],[[0,0]]]),
            "⋆'π'"                      : (BQNError, [[0,1,0,0,16,7],[runtime[4],'π'],[[0,1,0]],[[0,0]]]),
            "'e'⋆'π'"                   : (BQNError, [[0,2,0,0,0,1,17,7],[runtime[4],'e','π'],[[0,1,0]],[[0,0]]]),
            "3≡⌊3.9"                    : (1, [[0,3,0,0,16,0,1,0,2,17,7],[runtime[6],runtime[18],3,3.9],[[0,1,0]],[[0,0]]]),
            "¯4≡⌊¯3.9"                  : (1, [[0,3,0,0,16,0,1,0,2,17,7],[runtime[6],runtime[18],-4,-3.9],[[0,1,0]],[[0,0]]]),
            "∞≡⌊∞"                      : (1, [[0,2,0,0,16,0,1,0,2,17,7],[runtime[6],runtime[18],math.inf],[[0,1,0]],[[0,0]]]),
            "¯∞≡⌊¯∞"                    : (1, [[0,2,0,0,16,0,1,0,2,17,7],[runtime[6],runtime[18],-math.inf],[[0,1,0]],[[0,0]]]),
            "¯1e30≡⌊¯1e30"              : (1, [[0,2,0,0,16,0,1,0,2,17,7],[runtime[6],runtime[18],-1e30],[[0,1,0]],[[0,0]]]),
            "F←⌈⋄⌊f"                    : (BQNError, [[0,1,33,0,0,48,6,34,0,0,0,0,16,7],[runtime[6],runtime[7]],[[0,1,0]],[[0,1]]]),
            "1≡1=1"                     : (1, [[0,2,0,0,0,2,17,0,1,0,2,17,7],[runtime[15],runtime[18],1],[[0,1,0]],[[0,0]]]),
            "0≡¯1=∞"                    : (1, [[0,4,0,0,0,3,17,0,1,0,2,17,7],[runtime[15],runtime[18],0,-1,math.inf],[[0,1,0]],[[0,0]]]),
            "1≡'a'='a'"                 : (1, [[0,3,0,0,0,3,17,0,1,0,2,17,7],[runtime[15],runtime[18],1,'a'],[[0,1,0]],[[0,0]]]),
            "0≡'a'='A'"                 : (1, [[0,4,0,0,0,3,17,0,1,0,2,17,7],[runtime[15],runtime[18],0,'a','A'],[[0,1,0]],[[0,0]]]),
            "1≡{F←+⋄f=f}"               : (1, [[1,1,0,2,0,3,17,7,0,0,33,0,0,48,6,32,0,0,0,1,34,0,0,17,7],[runtime[0],runtime[15],runtime[18],1],[[0,1,0],[0,1,1]],[[0,0],[8,1]]]),
            "1≡{a‿b←⟨+´,+´⟩⋄a=b}"       : (1, [[1,1,0,2,0,4,17,7,0,3,0,0,26,0,3,0,0,26,11,2,33,0,0,33,0,1,12,2,48,6,34,0,1,0,1,34,0,0,17,7],[runtime[0],runtime[15],runtime[18],runtime[50],1],[[0,1,0],[0,1,1]],[[0,0],[8,2]]]),
            "0≡{_op←{𝕗}⋄op='o'}"        : (1, [[1,1,0,1,0,2,17,7,1,2,33,0,0,48,6,0,3,0,0,34,0,0,17,7,34,0,1,7],[runtime[15],runtime[18],0,'o'],[[0,1,0],[0,1,1],[1,1,2]],[[0,0],[8,1],[24,2]]]),
            "0≡{F←{𝕩}⋄G←{𝕩}⋄f=g}"       : (1, [[1,1,0,1,0,2,17,7,1,2,33,0,0,48,6,1,3,33,0,1,48,6,34,0,1,0,0,34,0,0,17,7,34,0,1,7,34,0,1,7],[runtime[15],runtime[18],0],[[0,1,0],[0,1,1],[0,0,2],[0,0,3]],[[0,0],[8,2],[32,3],[36,3]]]),
            "1≡{F←{𝕩}⋄f=f}"             : (1, [[1,1,0,1,0,2,17,7,1,2,33,0,0,48,6,32,0,0,0,0,34,0,0,17,7,34,0,1,7],[runtime[15],runtime[18],1],[[0,1,0],[0,1,1],[0,0,2]],[[0,0],[8,1],[25,3]]]),
            "1≡1≤1"                     : (1, [[0,2,0,0,0,2,17,0,1,0,2,17,7],[runtime[16],runtime[18],1],[[0,1,0]],[[0,0]]]),
            "1≡¯∞≤¯1e3"                 : (1, [[0,4,0,0,0,3,17,0,1,0,2,17,7],[runtime[16],runtime[18],1,-math.inf,-1000],[[0,1,0]],[[0,0]]]),
            "0≡∞≤¯∞"                    : (1, [[0,4,0,0,0,3,17,0,1,0,2,17,7],[runtime[16],runtime[18],0,math.inf,-math.inf],[[0,1,0]],[[0,0]]]),
            "1≡∞≤@"                     : (1, [[0,4,0,0,0,3,17,0,1,0,2,17,7],[runtime[16],runtime[18],1,math.inf,'\0'],[[0,1,0]],[[0,0]]]),
            "0≡'z'≤¯0.5"                : (1, [[0,3,0,0,0,4,17,0,1,0,2,17,7],[runtime[16],runtime[18],0,-0.5,'z'],[[0,1,0]],[[0,0]]]),
            "1≡'a'≤'a'"                 : (1, [[0,3,0,0,0,3,17,0,1,0,2,17,7],[runtime[16],runtime[18],1,'a'],[[0,1,0]],[[0,0]]]),
            "0≡'c'≤'a'"                 : (1, [[0,4,0,0,0,3,17,0,1,0,2,17,7],[runtime[16],runtime[18],0,'c','a'],[[0,1,0]],[[0,0]]]),
            "F←+⋄G←-⋄f≤g"               : (BQNError, [[0,0,33,0,0,48,6,0,1,33,0,1,48,6,34,0,1,0,2,34,0,0,17,7],[runtime[0],runtime[1],runtime[16]],[[0,1,0]],[[0,2]]]),
            "⟨⟩≡≢<2"                    : (1, [[0,3,0,0,16,0,2,16,0,1,11,0,17,7],[runtime[12],runtime[18],runtime[19],2],[[0,1,0]],[[0,0]]]),
            '⟨3⟩≡≢"abc"'                : (1, [[0,3,0,1,16,0,0,0,2,11,1,17,7],[runtime[18],runtime[19],3,bqnstr("abc")],[[0,1,0]],[[0,0]]]),
            '⟨2,3⟩≡≢>"abc"‿"fed"'       : (1, [[0,5,0,6,11,2,0,0,16,0,2,16,0,1,0,3,0,4,11,2,17,7],[runtime[13],runtime[18],runtime[19],2,3,bqnstr("abc"),bqnstr("fed")],[[0,1,0]],[[0,0]]]),
            '⟨2,3,4,5⟩≡≢2‿3‿4‿5⥊↕120'   : (1, [[0,8,0,3,16,0,2,0,4,0,5,0,6,0,7,11,4,17,0,1,16,0,0,0,4,0,5,0,6,0,7,11,4,17,7],[runtime[18],runtime[19],runtime[22],runtime[28],2,3,4,5,120],[[0,1,0]],[[0,0]]]),
            '⟨6⟩≡≢⥊>"abc"‿"fed"'        : (1, [[0,5,0,6,11,2,0,0,16,0,3,16,0,2,16,0,1,0,4,11,1,17,7],[runtime[13],runtime[18],runtime[19],runtime[22],6,bqnstr("abc"),bqnstr("fed")],[[0,1,0]],[[0,0]]]),
            '"abc"≡0⊑"abc"‿"de"'        : (1, [[0,3,0,4,11,2,0,1,0,2,17,0,0,0,3,17,7],[runtime[18],runtime[37],0,bqnstr("abc"),bqnstr("de")],[[0,1,0]],[[0,0]]]),
            '"de"≡1⊑"abc"‿"de"'         : (1, [[0,4,0,3,11,2,0,1,0,2,17,0,0,0,3,17,7],[runtime[18],runtime[37],1,bqnstr("de"),bqnstr("abc")],[[0,1,0]],[[0,0]]]),
            "⟨⟩≡↕0"                     : (1, [[0,2,0,1,16,0,0,11,0,17,7],[runtime[18],runtime[28],0],[[0,1,0]],[[0,0]]]),
            "⟨0⟩≡↕1"                    : (1, [[0,3,0,1,16,0,0,0,2,11,1,17,7],[runtime[18],runtime[28],0,1],[[0,1,0]],[[0,0]]]),
            "⟨0,1,2,3,4,5,6⟩≡↕7"        : (1, [[0,9,0,1,16,0,0,0,2,0,3,0,4,0,5,0,6,0,7,0,8,11,7,17,7],[runtime[18],runtime[28],0,1,2,3,4,5,6,7],[[0,1,0]],[[0,0]]]),
            "1≡!1"                      : (1, [[0,2,0,1,16,0,0,0,2,17,7],[runtime[18],runtime[43],1],[[0,1,0]],[[0,0]]]),
            "1≡'e'!1"				    : (1, [[0,2,0,1,0,3,17,0,0,0,2,17,7],[runtime[18],runtime[43],1,'e'],[[0,1,0]],[[0,0]]]),
            "!0"                        : (BQNError, [[0,1,0,0,16,7],[runtime[43],0],[[0,1,0]],[[0,0]]]),
            '"error"!"abc"'             : (BQNError, [[0,2,0,0,0,1,17,7],[runtime[43],bqnstr("error"),bqnstr("abc")],[[0,1,0]],[[0,0]]]),
        })
        # fmt: on

    def test_layer1(self):
        runtime = self.runtime
        # fmt: off
        self.runcases({
            "3≡4>◶+‿-1"                         : (1, [[0,7,0,0,0,1,11,2,0,4,0,2,27,0,6,17,0,3,0,5,17,7],[runtime[0],runtime[1],runtime[13],runtime[18],runtime[59],3,4,1],[[0,1,0]],[[0,0]]]),
            "3≡4⊢◶+‿-1"                         : (1, [[0,7,0,0,0,1,11,2,0,4,0,3,27,0,6,17,0,2,0,5,17,7],[runtime[0],runtime[1],runtime[18],runtime[21],runtime[59],3,4,1],[[0,1,0]],[[0,0]]]),
            "3≡4 1◶+‿-1"                        : (1, [[0,6,0,0,0,1,11,2,0,3,0,6,27,0,5,17,0,2,0,4,17,7],[runtime[0],runtime[1],runtime[18],runtime[59],3,4,1],[[0,1,0]],[[0,0]]]),
            "5≡4<◶+‿-1"                         : (1, [[0,7,0,0,0,1,11,2,0,4,0,2,27,0,6,17,0,3,0,5,17,7],[runtime[0],runtime[1],runtime[12],runtime[18],runtime[59],5,4,1],[[0,1,0]],[[0,0]]]),
            "5≡4 0◶+‿-1"                        : (1, [[0,7,0,0,0,1,11,2,0,3,0,6,27,0,5,17,0,2,0,4,17,7],[runtime[0],runtime[1],runtime[18],runtime[59],5,4,0,1],[[0,1,0]],[[0,0]]]),
            "1≡-⊘0 ¯1"                          : (1, [[0,5,0,4,0,2,0,0,27,16,0,1,0,3,17,7],[runtime[1],runtime[18],runtime[58],1,0,-1],[[0,1,0]],[[0,0]]]),
            "1≡¯1-⊘+2"                          : (1, [[0,6,0,0,0,3,0,1,27,0,5,17,0,2,0,4,17,7],[runtime[0],runtime[1],runtime[18],runtime[58],1,-1,2],[[0,1,0]],[[0,0]]]),
            '"abc"≡⊢"abc"'                      : (1, [[0,2,0,1,16,0,0,0,2,17,7],[runtime[18],runtime[21],bqnstr("abc")],[[0,1,0]],[[0,0]]]),
            '""≡3⊢""'                           : (1, [[0,3,0,1,0,2,17,0,0,0,3,17,7],[runtime[18],runtime[21],3,bqnstr("")],[[0,1,0]],[[0,0]]]),
            "⟨⟩≡⊣⟨⟩"                            : (1, [[11,0,0,1,16,0,0,11,0,17,7],[runtime[18],runtime[20]],[[0,1,0]],[[0,0]]]),
            '"ab"≡"ab"⊣⟨⟩'                      : (1, [[11,0,0,1,0,2,17,0,0,0,2,17,7],[runtime[18],runtime[20],bqnstr("ab")],[[0,1,0]],[[0,0]]]),
            "4≡+˜2"                             : (1, [[0,4,0,2,0,0,26,16,0,1,0,3,17,7],[runtime[0],runtime[18],runtime[45],4,2],[[0,1,0]],[[0,0]]]),
            "3≡1-˜4"                            : (1, [[0,5,0,2,0,0,26,0,4,17,0,1,0,3,17,7],[runtime[1],runtime[18],runtime[45],3,1,4],[[0,1,0]],[[0,0]]]),
            "1≡-∘×¯6"                           : (1, [[0,5,0,1,0,3,0,0,27,16,0,2,0,4,17,7],[runtime[1],runtime[2],runtime[18],runtime[53],1,-6],[[0,1,0]],[[0,0]]]),
            "¯6≡2-∘×3"                          : (1, [[0,6,0,1,0,3,0,0,27,0,5,17,0,2,0,4,17,7],[runtime[1],runtime[2],runtime[18],runtime[53],-6,2,3],[[0,1,0]],[[0,0]]]),
            "1≡-○×¯7"                           : (1, [[0,5,0,1,0,3,0,0,27,16,0,2,0,4,17,7],[runtime[1],runtime[2],runtime[18],runtime[54],1,-7],[[0,1,0]],[[0,0]]]),
            "2≡5-○×¯7"                          : (1, [[0,6,0,1,0,3,0,0,27,0,5,17,0,2,0,4,17,7],[runtime[1],runtime[2],runtime[18],runtime[54],2,5,-7],[[0,1,0]],[[0,0]]]),
            "¯20≡1⊸-⊸×5"                        : (1, [[0,6,0,1,0,3,0,0,0,3,0,5,27,27,16,0,2,0,4,17,7],[runtime[1],runtime[2],runtime[18],runtime[55],-20,1,5],[[0,1,0]],[[0,0]]]),
            '(0‿2+⌜0‿1)≡(>⟨"ab","cd"⟩)≢⊸⥊↕4'    : (1, [[0,11,0,5,16,0,4,0,7,0,3,27,0,12,0,13,11,2,0,1,16,17,0,2,0,8,0,10,11,2,0,6,0,0,26,0,8,0,9,11,2,17,17,7],[runtime[0],runtime[13],runtime[18],runtime[19],runtime[22],runtime[28],runtime[48],runtime[55],0,2,1,4,bqnstr("ab"),bqnstr("cd")],[[0,1,0]],[[0,0]]]),
            "20≡×⟜(-⟜1)5"                       : (1, [[0,6,0,5,0,3,0,0,27,0,3,0,1,27,16,0,2,0,4,17,7],[runtime[1],runtime[2],runtime[18],runtime[56],20,1,5],[[0,1,0]],[[0,0]]]),
            "4≡5+⟜×¯3"                          : (1, [[0,6,0,1,0,3,0,0,27,0,5,17,0,2,0,4,17,7],[runtime[0],runtime[2],runtime[18],runtime[56],4,5,-3],[[0,1,0]],[[0,0]]]),
            "7≡5+⟜2 ¯3"                         : (1, [[0,6,0,5,0,2,0,0,27,0,4,17,0,1,0,3,17,7],[runtime[0],runtime[18],runtime[56],7,5,2,-3],[[0,1,0]],[[0,0]]]),
            "2≡√4"                              : (1, [[0,3,0,0,16,0,1,0,2,17,7],[runtime[5],runtime[18],2,4],[[0,1,0]],[[0,0]]]),
            "3≡3√27"                            : (1, [[0,3,0,0,0,2,17,0,1,0,2,17,7],[runtime[5],runtime[18],3,27],[[0,1,0]],[[0,0]]]),
            "√'x'"                              : (BQNError,[[0,1,0,0,16,7],[runtime[5],'x'],[[0,1,0]],[[0,0]]]),
            "6≡2∧3"                             : (1, [[0,4,0,0,0,3,17,0,1,0,2,17,7],[runtime[10],runtime[18],6,2,3],[[0,1,0]],[[0,0]]]),
            "0≡¯2∧0"                            : (1, [[0,2,0,0,0,3,17,0,1,0,2,17,7],[runtime[10],runtime[18],0,-2],[[0,1,0]],[[0,0]]]),
            "'a'∧¯1"                            : (BQNError,[[0,1,0,0,0,2,17,7],[runtime[10],-1,'a'],[[0,1,0]],[[0,0]]]),
            "0.75≡∨˜0.5"                        : (1, [[0,4,0,2,0,0,26,16,0,1,0,3,17,7],[runtime[11],runtime[18],runtime[45],0.75,0.5],[[0,1,0]],[[0,0]]]),
            "1.75≡2∨0.25"                       : (1, [[0,4,0,0,0,3,17,0,1,0,2,17,7],[runtime[11],runtime[18],1.75,2,0.25],[[0,1,0]],[[0,0]]]),
            "F←-⋄2∨f"                           : (BQNError,[[0,0,33,0,0,48,6,34,0,0,0,1,0,2,17,7],[runtime[1],runtime[11],2],[[0,1,0]],[[0,1]]]),
            "0≡¬1"                              : (1, [[0,3,0,0,16,0,1,0,2,17,7],[runtime[9],runtime[18],0,1],[[0,1,0]],[[0,0]]]),
            "1≡¬0"                              : (1, [[0,3,0,0,16,0,1,0,2,17,7],[runtime[9],runtime[18],1,0],[[0,1,0]],[[0,0]]]),
            "2≡¬¯1"                             : (1, [[0,3,0,0,16,0,1,0,2,17,7],[runtime[9],runtime[18],2,-1],[[0,1,0]],[[0,0]]]),
            "¬'a'"                              : (BQNError,[[0,1,0,0,16,7],[runtime[9],'a'],[[0,1,0]],[[0,0]]]),
            "0≡3¬4"                             : (1, [[0,4,0,0,0,3,17,0,1,0,2,17,7],[runtime[9],runtime[18],0,3,4],[[0,1,0]],[[0,0]]]),
            "2≡4¬3"                             : (1, [[0,4,0,0,0,3,17,0,1,0,2,17,7],[runtime[9],runtime[18],2,4,3],[[0,1,0]],[[0,0]]]),
            "4≡5¬2"                             : (1, [[0,4,0,0,0,3,17,0,1,0,2,17,7],[runtime[9],runtime[18],4,5,2],[[0,1,0]],[[0,0]]]),
            "5≡'g'¬'c'"                         : (1, [[0,4,0,0,0,3,17,0,1,0,2,17,7],[runtime[9],runtime[18],5,'g','c'],[[0,1,0]],[[0,0]]]),
            "'b'≡'c'¬2"                         : (1, [[0,2,0,0,0,4,17,0,1,0,3,17,7],[runtime[9],runtime[18],2,'b','c'],[[0,1,0]],[[0,0]]]),
            "2¬'c'"                             : (BQNError,[[0,2,0,0,0,1,17,7],[runtime[9],2,'c'],[[0,1,0]],[[0,0]]]),
            "F←{𝕩}⋄0¬f"                         : (BQNError,[[1,1,33,0,0,48,6,34,0,0,0,0,0,1,17,7,34,0,1,7],[runtime[9],0],[[0,1,0],[0,0,1]],[[0,1],[16,3]]]),
            "0≡|0"                              : (1, [[0,2,0,0,16,0,1,0,2,17,7],[runtime[8],runtime[18],0],[[0,1,0]],[[0,0]]]),
            "5≡|¯5"                             : (1, [[0,3,0,0,16,0,1,0,2,17,7],[runtime[8],runtime[18],5,-5],[[0,1,0]],[[0,0]]]),
            "6≡|6"                              : (1, [[0,2,0,0,16,0,1,0,2,17,7],[runtime[8],runtime[18],6],[[0,1,0]],[[0,0]]]),
            "∞≡|¯∞"                             : (1, [[0,3,0,0,16,0,1,0,2,17,7],[runtime[8],runtime[18],math.inf,-math.inf],[[0,1,0]],[[0,0]]]),
            "F←+-⋄|f"                           : (BQNError,[[0,1,0,0,20,33,0,0,48,6,34,0,0,0,2,16,7],[runtime[0],runtime[1],runtime[8]],[[0,1,0]],[[0,1]]]),
            "2≡3|8"                             : (1, [[0,4,0,0,0,3,17,0,1,0,2,17,7],[runtime[8],runtime[18],2,3,8],[[0,1,0]],[[0,0]]]),
            "2≡3|¯7"                            : (1, [[0,4,0,0,0,3,17,0,1,0,2,17,7],[runtime[8],runtime[18],2,3,-7],[[0,1,0]],[[0,0]]]),
            "¯1≡¯3|8"                           : (1, [[0,4,0,0,0,3,17,0,1,0,2,17,7],[runtime[8],runtime[18],-1,-3,8],[[0,1,0]],[[0,0]]]),
            "26|'A'"                            : (BQNError,[[0,2,0,0,0,1,17,7],[runtime[8],26,'A'],[[0,1,0]],[[0,0]]]),
            '"a"≡⥊<\'a\''                       : (1, [[0,3,0,0,16,0,2,16,0,1,0,4,17,7],[runtime[12],runtime[18],runtime[22],'a',bqnstr("a")],[[0,1,0]],[[0,0]]]),
            '"abcd"≡⊑<"abcd"'                   : (1, [[0,3,0,0,16,0,2,16,0,1,0,3,17,7],[runtime[12],runtime[18],runtime[37],bqnstr("abcd")],[[0,1,0]],[[0,0]]]),
            "0≡5>5"                             : (1, [[0,3,0,0,0,3,17,0,1,0,2,17,7],[runtime[13],runtime[18],0,5],[[0,1,0]],[[0,0]]]),
            "0≡3≥4"                             : (1, [[0,4,0,0,0,3,17,0,1,0,2,17,7],[runtime[17],runtime[18],0,3,4],[[0,1,0]],[[0,0]]]),
            '0≡≠""'                             : (1, [[0,3,0,0,16,0,1,0,2,17,7],[runtime[14],runtime[18],0,bqnstr("")],[[0,1,0]],[[0,0]]]),
            '1≡≠"a"'                            : (1, [[0,3,0,0,16,0,1,0,2,17,7],[runtime[14],runtime[18],1,bqnstr("a")],[[0,1,0]],[[0,0]]]),
            "1≡≠'a'"                            : (1, [[0,3,0,0,16,0,1,0,2,17,7],[runtime[14],runtime[18],1,'a'],[[0,1,0]],[[0,0]]]),
            '2≡≠"ab"'                           : (1, [[0,3,0,0,16,0,1,0,2,17,7],[runtime[14],runtime[18],2,bqnstr("ab")],[[0,1,0]],[[0,0]]]),
            "25≡≠↕25"                           : (1, [[0,3,0,2,16,0,0,16,0,1,0,3,17,7],[runtime[14],runtime[18],runtime[28],25],[[0,1,0]],[[0,0]]]),
            "1≡×5"                              : (1, [[0,3,0,0,16,0,1,0,2,17,7],[runtime[2],runtime[18],1,5],[[0,1,0]],[[0,0]]]),
            "¯1≡×¯2.5"                          : (1, [[0,3,0,0,16,0,1,0,2,17,7],[runtime[2],runtime[18],-1,-2.5],[[0,1,0]],[[0,0]]]),
            "3≡3⌊4"                             : (1, [[0,3,0,0,0,2,17,0,1,0,2,17,7],[runtime[6],runtime[18],3,4],[[0,1,0]],[[0,0]]]),
            "¯3≡¯3⌊∞"                           : (1, [[0,3,0,0,0,2,17,0,1,0,2,17,7],[runtime[6],runtime[18],-3,math.inf],[[0,1,0]],[[0,0]]]),
            "4≡3⌈4"                             : (1, [[0,2,0,0,0,3,17,0,1,0,2,17,7],[runtime[7],runtime[18],4,3],[[0,1,0]],[[0,0]]]),
            "1≡1⌈¯1"                            : (1, [[0,3,0,0,0,2,17,0,1,0,2,17,7],[runtime[7],runtime[18],1,-1],[[0,1,0]],[[0,0]]]),
            "5≡⌈4.01"                           : (1, [[0,3,0,0,16,0,1,0,2,17,7],[runtime[7],runtime[18],5,4.01],[[0,1,0]],[[0,0]]]),
            "⟨⟩≡≢'a'"                           : (1, [[0,2,0,1,16,0,0,11,0,17,7],[runtime[18],runtime[19],'a'],[[0,1,0]],[[0,0]]]),
            "⟨⟩≡≢0"                             : (1, [[0,2,0,1,16,0,0,11,0,17,7],[runtime[18],runtime[19],0],[[0,1,0]],[[0,0]]]),
            "⟨0⟩‿⟨1⟩‿⟨2⟩≡⥊¨↕3"                  : (1, [[0,7,0,2,16,0,3,0,1,26,16,0,0,0,4,11,1,0,5,11,1,0,6,11,1,11,3,17,7],[runtime[18],runtime[22],runtime[28],runtime[47],0,1,2,3],[[0,1,0]],[[0,0]]]),
            '(↕6)≡⟜(≠¨)○(2‿3⊸⥊)⟨⟩‿"a"‿"ab"‿"abc"‿"abcd"‿"abcde"‿"abcdef"' : (1, [[11,0,0,11,0,12,0,13,0,14,0,15,0,16,11,7,0,2,0,6,0,9,0,10,11,2,27,0,5,0,4,0,0,26,0,7,0,1,27,27,0,8,0,3,16,17,7],[runtime[14],runtime[18],runtime[22],runtime[28],runtime[47],runtime[54],runtime[55],runtime[56],6,2,3,bqnstr("a"),bqnstr("ab"),bqnstr("abc"),bqnstr("abcd"),bqnstr("abcde"),bqnstr("abcdef")],[[0,1,0]],[[0,0]]]),
            "≡⟜(≠¨)4‿0‿2⥊↕0"                    : (1, [[0,7,0,3,16,0,2,0,6,0,7,0,8,11,3,17,0,4,0,0,26,0,5,0,1,27,16,7],[runtime[14],runtime[18],runtime[22],runtime[28],runtime[47],runtime[56],4,0,2],[[0,1,0]],[[0,0]]]),
            "6≡+´↕4"                            : (1, [[0,5,0,2,16,0,3,0,0,26,16,0,1,0,4,17,7],[runtime[0],runtime[18],runtime[28],runtime[50],6,4],[[0,1,0]],[[0,0]]]),
            '(⊑≡⊣´)"a"‿2‿(3‿"d")'               : (1, [[0,6,0,4,0,5,0,7,11,2,11,3,0,3,0,1,26,0,0,0,2,21,16,7],[runtime[18],runtime[20],runtime[37],runtime[50],2,3,bqnstr("a"),bqnstr("d")],[[0,1,0]],[[0,0]]]),
            '0(⊑≡⊣´)"a"‿2‿(3‿"d")'              : (1, [[0,7,0,5,0,6,0,8,11,2,11,3,0,3,0,1,26,0,0,0,2,21,0,4,17,7],[runtime[18],runtime[20],runtime[37],runtime[50],0,2,3,bqnstr("a"),bqnstr("d")],[[0,1,0]],[[0,0]]]),
            '(2⊸⊑≡⊢´)"a"‿2‿(3‿"d")'             : (1, [[0,7,0,5,0,6,0,8,11,2,11,3,0,3,0,1,26,0,0,0,2,0,4,0,5,27,21,16,7],[runtime[18],runtime[21],runtime[37],runtime[50],runtime[55],2,3,bqnstr("a"),bqnstr("d")],[[0,1,0]],[[0,0]]]),
            '⊑""'                               : (BQNError,[[0,1,0,0,16,7],[runtime[37],bqnstr("")],[[0,1,0]],[[0,0]]]),
            "⊑2‿0⥊⟨⟩"                           : (BQNError,[[11,0,0,0,0,2,0,3,11,2,17,0,1,16,7],[runtime[22],runtime[37],2,0],[[0,1,0]],[[0,0]]]),
            '2(⊣≡⊢´)"a"‿2‿(3‿"d")'              : (1, [[0,6,0,4,0,5,0,7,11,2,11,3,0,3,0,2,26,0,0,0,1,21,0,4,17,7],[runtime[18],runtime[20],runtime[21],runtime[50],2,3,bqnstr("a"),bqnstr("d")],[[0,1,0]],[[0,0]]]),
            "7‿10≡+¨´⟨⟨2,3⟩,⟨5,7⟩⟩"             : (1, [[0,6,0,7,11,2,0,8,0,4,11,2,11,2,0,3,0,2,0,0,26,26,16,0,1,0,4,0,5,11,2,17,7],[runtime[0],runtime[18],runtime[47],runtime[50],7,10,2,3,5],[[0,1,0]],[[0,0]]]),
            "+´11"                              : (BQNError,[[0,2,0,1,0,0,26,16,7],[runtime[0],runtime[50],11],[[0,1,0]],[[0,0]]]),
            "-´<'a'"                            : (BQNError,[[0,3,0,1,16,0,2,0,0,26,16,7],[runtime[1],runtime[12],runtime[50],'a'],[[0,1,0]],[[0,0]]]),
            '×´3‿1⥊"abc"'                       : (BQNError,[[0,5,0,1,0,3,0,4,11,2,17,0,2,0,0,26,16,7],[runtime[2],runtime[22],runtime[50],3,1,bqnstr("abc")],[[0,1,0]],[[0,0]]]),
        })
        # fmt: on

    def test_layer2(self):
        runtime = self.runtime
        # fmt: off
        self.runcases({
            '⟨⟩≡⟨⟩∾""'                                                              : (1, [[0,2,0,1,11,0,17,0,0,11,0,17,7],[runtime[18],runtime[23],bqnstr("")],[[0,1,0]],[[0,0]]]),
            '"a"≡⟨⟩∾"a"'                                                            : (1, [[0,2,0,1,11,0,17,0,0,0,2,17,7],[runtime[18],runtime[23],bqnstr("a")],[[0,1,0]],[[0,0]]]),
            '"a"≡"a"∾⟨⟩'                                                            : (1, [[11,0,0,1,0,2,17,0,0,0,2,17,7],[runtime[18],runtime[23],bqnstr("a")],[[0,1,0]],[[0,0]]]),
            '"aBCD"≡"a"∾"BCD"'                                                      : (1, [[0,4,0,1,0,3,17,0,0,0,2,17,7],[runtime[18],runtime[23],bqnstr("aBCD"),bqnstr("a"),bqnstr("BCD")],[[0,1,0]],[[0,0]]]),
            '((+⌜˜≠¨)≡(≠¨∾⌜˜))""‿⟨2,3⟩‿"abcde"'                                     : (1, [[0,9,0,7,0,8,11,2,0,10,11,3,0,4,0,6,0,3,26,26,0,5,0,1,26,20,0,2,0,5,0,1,26,0,4,0,6,0,0,26,26,20,21,16,7],[runtime[0],runtime[14],runtime[18],runtime[23],runtime[45],runtime[47],runtime[48],2,3,bqnstr(""),bqnstr("abcde")],[[0,1,0]],[[0,0]]]),
            "(⥊⟜(↕×´)≡(×⟜4)⊸(+⌜)○↕´)3‿4"                                            : (1, [[0,11,0,10,11,2,0,6,0,4,0,7,0,5,0,0,26,0,8,0,10,0,9,0,1,27,27,27,26,0,2,0,6,0,1,26,0,4,20,0,9,0,3,27,21,16,7],[runtime[0],runtime[2],runtime[18],runtime[22],runtime[28],runtime[48],runtime[50],runtime[54],runtime[55],runtime[56],4,3],[[0,1,0]],[[0,0]]]),
            "(⥊⟜(↕×´)≡(×⟜4)⊸(+⌜)○↕´)0‿4"                                            : (1, [[0,11,0,10,11,2,0,6,0,4,0,7,0,5,0,0,26,0,8,0,10,0,9,0,1,27,27,27,26,0,2,0,6,0,1,26,0,4,20,0,9,0,3,27,21,16,7],[runtime[0],runtime[2],runtime[18],runtime[22],runtime[28],runtime[48],runtime[50],runtime[54],runtime[55],runtime[56],4,0],[[0,1,0]],[[0,0]]]),
            '(3‿2‿0⥊"")≡(3‿2⥊↕6)+⌜""'                                               : (1, [[0,9,0,4,0,0,26,0,8,0,3,16,0,2,0,5,0,6,11,2,17,17,0,1,0,9,0,2,0,5,0,6,0,7,11,3,17,17,7],[runtime[0],runtime[18],runtime[22],runtime[28],runtime[48],3,2,0,6,bqnstr("")],[[0,1,0]],[[0,0]]]),
            "(<-2)≡-¨2"                                                             : (1, [[0,4,0,3,0,0,26,16,0,2,0,4,0,0,16,0,1,16,17,7],[runtime[1],runtime[12],runtime[18],runtime[47],2],[[0,1,0]],[[0,0]]]),
            "(<<2)≡<¨2"                                                             : (1, [[0,3,0,2,0,0,26,16,0,1,0,3,0,0,16,0,0,16,17,7],[runtime[12],runtime[18],runtime[47],2],[[0,1,0]],[[0,0]]]),
            "⟨1,⟨3,2,2‿2⥊⟨1,0,2,0⟩⟩,⟨5,4⟩⟩≡-⟨-1,⟨-3,-2,-¨2‿2⥊⟨1,0,2,0⟩⟩,⟨-5,-4⟩⟩"   : (1, [[0,4,0,0,16,0,5,0,0,16,0,6,0,0,16,0,4,0,7,0,6,0,7,11,4,0,2,0,6,0,6,11,2,17,0,3,0,0,26,16,11,3,0,8,0,0,16,0,9,0,0,16,11,2,11,3,0,0,16,0,1,0,4,0,5,0,6,0,4,0,7,0,6,0,7,11,4,0,2,0,6,0,6,11,2,17,11,3,0,8,0,9,11,2,11,3,17,7],[runtime[1],runtime[18],runtime[22],runtime[47],1,3,2,0,5,4],[[0,1,0]],[[0,0]]]),
            "3(+¨≡+⌜)↕6"                                                            : (1, [[0,6,0,2,16,0,4,0,0,26,0,1,0,3,0,0,26,21,0,5,17,7],[runtime[0],runtime[18],runtime[28],runtime[47],runtime[48],3,6],[[0,1,0]],[[0,0]]]),
            "2‿3⊢¨4‿5‿6"                                                            : (BQNError, [[0,4,0,5,0,6,11,3,0,1,0,0,26,0,2,0,3,11,2,17,7],[runtime[21],runtime[47],2,3,4,5,6],[[0,1,0]],[[0,0]]]),
            '"abcd"-"a"'                                                            :  (BQNError, [[0,2,0,0,0,1,17,7],[runtime[1],bqnstr("abcd"),bqnstr("a")],[[0,1,0]],[[0,0]]]),
            "3‿4‿5‿6‿6≡{𝕊⍟(×≡)⊸∾⟜⥊´𝕩}⟨2,1⟩+⟨⟨⟨⟨1,2⟩,3⟩,4⟩,5⟩"                       : (1, [[0,14,0,13,11,2,0,9,11,2,0,10,11,2,0,11,11,2,0,0,0,13,0,14,11,2,17,1,1,16,0,2,0,9,0,10,0,11,0,12,0,12,11,5,17,7,34,0,1,0,5,0,3,0,7,0,4,0,6,0,2,0,1,20,0,8,34,0,0,27,27,27,26,16,7],[runtime[0],runtime[2],runtime[18],runtime[22],runtime[23],runtime[50],runtime[55],runtime[56],runtime[62],3,4,5,6,2,1],[[0,1,0],[0,0,1]],[[0,0],[46,3]]]),
            "3‿2≡≢(↕3)(⊣×⊢⌜)↕2"                                                     : (1, [[0,8,0,5,16,0,6,0,4,26,0,0,0,3,21,0,7,0,5,16,17,0,2,16,0,1,0,7,0,8,11,2,17,7],[runtime[2],runtime[18],runtime[19],runtime[20],runtime[21],runtime[28],runtime[48],3,2],[[0,1,0]],[[0,0]]]),
            "(<-4)≡-<4"                                                             : (1, [[0,3,0,1,16,0,0,16,0,2,0,3,0,0,16,0,1,16,17,7],[runtime[1],runtime[12],runtime[18],4],[[0,1,0]],[[0,0]]]),
            "(<2)≡1+<1"                                                             : (1, [[0,4,0,1,16,0,0,0,4,17,0,2,0,3,0,1,16,17,7],[runtime[0],runtime[12],runtime[18],2,1],[[0,1,0]],[[0,0]]]),
            "(↕4)×(↕3)⊢⌜↕2"                                                         : (BQNError, [[0,6,0,2,16,0,3,0,1,26,0,5,0,2,16,17,0,0,0,4,0,2,16,17,7],[runtime[2],runtime[21],runtime[28],runtime[48],4,3,2],[[0,1,0]],[[0,0]]]),
            "(=¨⟜(⥊⟜(↕×´)3‿4)≡(↕4)=⌜˜4|⊢)1‿6‿8"                                     : (1, [[0,14,0,15,0,16,11,3,0,4,0,1,0,13,21,0,7,0,9,0,2,26,26,0,13,0,6,16,21,0,3,0,12,0,13,11,2,0,10,0,0,26,0,6,20,0,11,0,5,27,16,0,11,0,8,0,2,26,27,21,16,7],[runtime[2],runtime[8],runtime[15],runtime[18],runtime[21],runtime[22],runtime[28],runtime[45],runtime[47],runtime[48],runtime[50],runtime[56],3,4,1,6,8],[[0,1,0]],[[0,0]]]),
            "0‿1≡+‿-=⊑⟨-⟩"                                                          : (1, [[0,1,11,1,0,4,16,0,2,0,0,0,1,11,2,17,0,3,0,5,0,6,11,2,17,7],[runtime[0],runtime[1],runtime[15],runtime[18],runtime[37],0,1],[[0,1,0]],[[0,0]]]),
        })
        # fmt: on

    def test_layer3(self):
        runtime = self.runtime
        # fmt: off
        self.runcases({
            '2≡⊑2'                                      :(1, [[0,2,0,1,16,0,0,0,2,17,7],[runtime[18],runtime[37],2],[[0,1,0]],[[0,0]]]),
            '2≡⊑⟨2⟩'                                    :(1, [[0,2,11,1,0,1,16,0,0,0,2,17,7],[runtime[18],runtime[37],2],[[0,1,0]],[[0,0]]]),
            '"ab"≡⊑⟨"ab"⟩'                              :(1, [[0,2,11,1,0,1,16,0,0,0,2,17,7],[runtime[18],runtime[37],bqnstr("ab")],[[0,1,0]],[[0,0]]]),
            '0≡⊑↕20'                                    :(1, [[0,4,0,1,16,0,2,16,0,0,0,3,17,7],[runtime[18],runtime[28],runtime[37],0,20],[[0,1,0]],[[0,0]]]),
            '4≡⊑3‿2‿1⥊4⥊⊸∾5⥊0'                          :(1, [[0,10,0,1,0,9,17,0,2,0,4,0,1,27,0,5,17,0,1,0,6,0,7,0,8,11,3,17,0,3,16,0,0,0,5,17,7],[runtime[18],runtime[22],runtime[23],runtime[37],runtime[55],4,3,2,1,5,0],[[0,1,0]],[[0,0]]]),
            '\'c\'≡2⊑"abcd"'                            :(1, [[0,4,0,1,0,2,17,0,0,0,3,17,7],[runtime[18],runtime[37],2,'c',bqnstr("abcd")],[[0,1,0]],[[0,0]]]),
            '\'c\'≡¯2⊑"abcd"'                           :(1, [[0,4,0,1,0,2,17,0,0,0,3,17,7],[runtime[18],runtime[37],-2,'c',bqnstr("abcd")],[[0,1,0]],[[0,0]]]),
            '7≡7⊑↕10'                                   :(1, [[0,4,0,1,16,0,2,0,3,17,0,0,0,3,17,7],[runtime[18],runtime[28],runtime[37],7,10],[[0,1,0]],[[0,0]]]),
            '7≡⟨7⟩⊑↕10'                                 :(1, [[0,4,0,1,16,0,2,0,3,11,1,17,0,0,0,3,17,7],[runtime[18],runtime[28],runtime[37],7,10],[[0,1,0]],[[0,0]]]),
            '0≡¯10⊑↕10'                                 :(1, [[0,5,0,1,16,0,2,0,4,17,0,0,0,3,17,7],[runtime[18],runtime[28],runtime[37],0,-10,10],[[0,1,0]],[[0,0]]]),
            '10⊑↕10'                                    :(BQNError, [[0,2,0,0,16,0,1,0,2,17,7],[runtime[28],runtime[37],10],[[0,1,0]],[[0,0]]]),
            '¯11⊑↕10'                                   :(BQNError, [[0,3,0,0,16,0,1,0,2,17,7],[runtime[28],runtime[37],-11,10],[[0,1,0]],[[0,0]]]),
            '0.5⊑↕10'                                   :(BQNError, [[0,3,0,0,16,0,1,0,2,17,7],[runtime[28],runtime[37],0.5,10],[[0,1,0]],[[0,0]]]),
            "'x'⊑↕10"                                   :(BQNError, [[0,2,0,0,16,0,1,0,3,17,7],[runtime[28],runtime[37],10,'x'],[[0,1,0]],[[0,0]]]),
            '⟨⟩⊑↕10'                                    :(BQNError, [[0,2,0,0,16,0,1,11,0,17,7],[runtime[28],runtime[37],10],[[0,1,0]],[[0,0]]]),
            '21≡2‿¯3⊑(10×↕3)+⌜↕4'                       :(1, [[0,11,0,3,16,0,5,0,0,26,0,10,0,3,16,0,1,0,9,17,17,0,4,0,7,0,8,11,2,17,0,2,0,6,17,7],[runtime[0],runtime[2],runtime[18],runtime[28],runtime[37],runtime[48],21,2,-3,10,3,4],[[0,1,0]],[[0,0]]]),
            '2⊑3+⌜○↕4'                                  :(BQNError, [[0,7,0,1,0,4,0,3,0,0,26,27,0,6,17,0,2,0,5,17,7],[runtime[0],runtime[28],runtime[37],runtime[48],runtime[54],2,3,4],[[0,1,0]],[[0,0]]]),
            '21‿12‿03≡⟨2‿¯3,1‿2,0‿¯1⟩⊑(10×↕3)+⌜↕4'      :(1, [[0,15,0,3,16,0,5,0,0,26,0,8,0,3,16,0,1,0,14,17,17,0,4,0,9,0,10,11,2,0,11,0,9,11,2,0,12,0,13,11,2,11,3,17,0,2,0,6,0,7,0,8,11,3,17,7],[runtime[0],runtime[2],runtime[18],runtime[28],runtime[37],runtime[48],21,12,3,2,-3,1,0,-1,10,4],[[0,1,0]],[[0,0]]]),
            '21‿12‿03≡⟨2‿¯3‿0,1‿2,0‿¯1⟩⊑(10×↕3)+⌜↕4'    :(BQNError, [[0,15,0,3,16,0,5,0,0,26,0,8,0,3,16,0,1,0,14,17,17,0,4,0,9,0,10,0,11,11,3,0,12,0,9,11,2,0,11,0,13,11,2,11,3,17,0,2,0,6,0,7,0,8,11,3,17,7],[runtime[0],runtime[2],runtime[18],runtime[28],runtime[37],runtime[48],21,12,3,2,-3,0,1,-1,10,4],[[0,1,0]],[[0,0]]]),
            '⟨2,⟨3⟩⟩⊑↕4'                                :(BQNError, [[0,4,0,0,16,0,1,0,2,0,3,11,1,11,2,17,7],[runtime[28],runtime[37],2,3,4],[[0,1,0]],[[0,0]]]),
            '(<2)⊑↕4'                                   :(BQNError, [[0,4,0,1,16,0,2,0,3,0,0,16,17,7],[runtime[12],runtime[28],runtime[37],2,4],[[0,1,0]],[[0,0]]]),
            '(≍≍2)⊑↕4'                                  :(BQNError, [[0,4,0,1,16,0,2,0,3,0,0,16,0,0,16,17,7],[runtime[24],runtime[28],runtime[37],2,4],[[0,1,0]],[[0,0]]]),
            '⟨≍1‿2⟩⊑↕5‿5'                               :(BQNError, [[0,5,0,5,11,2,0,1,16,0,2,0,3,0,4,11,2,0,0,16,11,1,17,7],[runtime[24],runtime[28],runtime[37],1,2,5],[[0,1,0]],[[0,0]]]),
            '"dfeb"≡(⥊¨-⟨3,1,2,5⟩)⊑"abcdef"'            :(1, [[0,10,0,3,0,5,0,6,0,7,0,8,11,4,0,0,16,0,4,0,2,26,16,17,0,1,0,9,17,7],[runtime[1],runtime[18],runtime[22],runtime[37],runtime[47],3,1,2,5,bqnstr("dfeb"),bqnstr("abcdef")],[[0,1,0]],[[0,0]]]),
            '"abc"≡⟨⟩⊑<"abc"'                           :(1, [[0,3,0,0,16,0,2,11,0,17,0,1,0,3,17,7],[runtime[12],runtime[18],runtime[37],bqnstr("abc")],[[0,1,0]],[[0,0]]]),
            "'a'≡⟨⟩⊑'a'"                                :(1, [[0,2,0,1,11,0,17,0,0,0,2,17,7],[runtime[18],runtime[37],'a'],[[0,1,0]],[[0,0]]]),
            '⟨7,7‿7,7⟩≡⟨⟨⟩,⟨⟨⟩,⟨⟩⟩,⟨⟩⟩⊑<7'              :(1, [[0,3,0,0,16,0,2,11,0,11,0,11,0,11,2,11,0,11,3,17,0,1,0,3,0,3,0,3,11,2,0,3,11,3,17,7],[runtime[12],runtime[18],runtime[37],7],[[0,1,0]],[[0,0]]]),
            '⟨7,⟨7,<7⟩⟩≡⟨⟨⟩,⟨⟨⟩,<⟨⟩⟩⟩⊑7'                :(1, [[0,3,0,2,11,0,11,0,11,0,0,0,16,11,2,11,2,17,0,1,0,3,0,3,0,3,0,0,16,11,2,11,2,17,7],[runtime[12],runtime[18],runtime[37],7],[[0,1,0]],[[0,0]]]),
            '"abcfab"≡⥊(↕2‿3)⊑5‿5⥊"abcdef"'             :(1, [[0,8,0,1,0,6,0,6,11,2,17,0,3,0,4,0,5,11,2,0,2,16,17,0,1,16,0,0,0,7,17,7],[runtime[18],runtime[22],runtime[28],runtime[37],2,3,5,bqnstr("abcfab"),bqnstr("abcdef")],[[0,1,0]],[[0,0]]]),
            '"aedcaf"≡⥊(-↕2‿3)⊑5‿5⥊"abcdef"'            :(1, [[0,9,0,2,0,7,0,7,11,2,17,0,4,0,5,0,6,11,2,0,3,16,0,0,16,17,0,2,16,0,1,0,8,17,7],[runtime[1],runtime[18],runtime[22],runtime[28],runtime[37],2,3,5,bqnstr("aedcaf"),bqnstr("abcdef")],[[0,1,0]],[[0,0]]]),
            '↕@'                                        :(BQNError, [[0,1,0,0,16,7],[runtime[28],'\0'],[[0,1,0]],[[0,0]]]),
            '↕2.4'                                      :(BQNError, [[0,1,0,0,16,7],[runtime[28],2.4],[[0,1,0]],[[0,0]]]),
            '↕<6'                                       :(BQNError, [[0,2,0,0,16,0,1,16,7],[runtime[12],runtime[28],6],[[0,1,0]],[[0,0]]]),
            '↕≍2‿3'                                     :(BQNError, [[0,2,0,3,11,2,0,0,16,0,1,16,7],[runtime[24],runtime[28],2,3],[[0,1,0]],[[0,0]]]),
            '↕¯1‿2'                                     :(BQNError, [[0,1,0,2,11,2,0,0,16,7],[runtime[28],-1,2],[[0,1,0]],[[0,0]]]),
            '(<6⥊0)(⊑≡<∘⊑∘⊢)(6⥊1)⥊5'                    :(1, [[0,9,0,3,0,8,0,3,0,6,17,17,0,2,0,5,0,4,0,5,0,0,27,27,0,1,0,4,21,0,7,0,3,0,6,17,0,0,16,17,7],[runtime[12],runtime[18],runtime[21],runtime[22],runtime[37],runtime[53],6,0,1,5],[[0,1,0]],[[0,0]]]),
            '¯6≡1‿0◶(2‿2⥊0‿0‿-‿0)6'                     :(1, [[0,8,0,6,0,6,0,0,0,6,11,4,0,2,0,7,0,7,11,2,17,0,3,0,5,0,6,11,2,27,16,0,1,0,4,17,7],[runtime[1],runtime[18],runtime[22],runtime[59],-6,1,0,2,6],[[0,1,0]],[[0,0]]]),
            '-˙◶÷‿× 4'                                  :(BQNError, [[0,5,0,2,0,1,11,2,0,4,0,3,0,0,26,27,16,7],[runtime[1],runtime[2],runtime[3],runtime[44],runtime[59],4],[[0,1,0]],[[0,0]]]),
            '⟨3⟩≡⥊3'                                    :(1, [[0,2,0,1,16,0,0,0,2,11,1,17,7],[runtime[18],runtime[22],3],[[0,1,0]],[[0,0]]]),
            '(⟨⟩⊸⥊≡<)3'                                 :(1, [[0,4,0,0,0,1,0,2,0,3,11,0,27,21,16,7],[runtime[12],runtime[18],runtime[22],runtime[55],3],[[0,1,0]],[[0,0]]]),
            '⟨3,3,3⟩≡3⥊3'                               :(1, [[0,2,0,1,0,2,17,0,0,0,2,0,2,0,2,11,3,17,7],[runtime[18],runtime[22],3],[[0,1,0]],[[0,0]]]),
            '⟨3,3,3⟩≡3<⊸⥊3'                             :(1, [[0,4,0,2,0,3,0,0,27,0,4,17,0,1,0,4,0,4,0,4,11,3,17,7],[runtime[12],runtime[18],runtime[22],runtime[55],3],[[0,1,0]],[[0,0]]]),
            '¯3⥊3'                                      :(BQNError, [[0,2,0,0,0,1,17,7],[runtime[22],-3,3],[[0,1,0]],[[0,0]]]),
            '1.6‿2.5⥊↕4'                                :(BQNError, [[0,4,0,1,16,0,0,0,2,0,3,11,2,17,7],[runtime[22],runtime[28],1.6,2.5,4],[[0,1,0]],[[0,0]]]),
            '(≍2‿3)⥊↕3'                                 :(BQNError, [[0,4,0,2,16,0,0,0,3,0,4,11,2,0,1,16,17,7],[runtime[22],runtime[24],runtime[28],2,3],[[0,1,0]],[[0,0]]]),
            '"     "≡5⥊""'                              :(BQNError, [[0,4,0,1,0,2,17,0,0,0,3,17,7],[runtime[18],runtime[22],5,bqnstr("     "),bqnstr("")],[[0,1,0]],[[0,0]]]),
            '6(⊢⌜≡∾○≢⥊⊢)○↕3'                            :(1, [[0,9,0,5,0,7,0,2,0,3,0,1,0,7,0,4,27,21,0,0,0,6,0,2,26,21,27,0,8,17,7],[runtime[18],runtime[19],runtime[21],runtime[22],runtime[23],runtime[28],runtime[48],runtime[54],6,3],[[0,1,0]],[[0,0]]]),
            '(<≡↕)⟨⟩'                                   :(1, [[11,0,0,2,0,1,0,0,21,16,7],[runtime[12],runtime[18],runtime[28]],[[0,1,0]],[[0,0]]]),
            '(↕∘⥊≡⥊¨∘↕)9'                               :(1, [[0,5,0,2,0,4,0,3,0,1,26,27,0,0,0,1,0,4,0,2,27,21,16,7],[runtime[18],runtime[22],runtime[28],runtime[47],runtime[53],9],[[0,1,0]],[[0,0]]]),
            '∧´(⟨∘⟩⊸⥊≡⥊)¨ ⟨4,↕4,↕2‿4⟩'                  :(1, [[0,8,0,8,0,3,16,0,9,0,8,11,2,0,3,16,11,3,0,4,0,2,0,1,0,2,0,7,0,6,11,1,27,21,26,16,0,5,0,0,26,16,7],[runtime[10],runtime[18],runtime[22],runtime[28],runtime[47],runtime[50],runtime[53],runtime[55],4,2],[[0,1,0]],[[0,0]]]),
            '4‿∘⥊↕15'                                   :(BQNError, [[0,4,0,1,16,0,0,0,3,0,2,11,2,17,7],[runtime[22],runtime[28],runtime[53],4,15],[[0,1,0]],[[0,0]]]),
            '1‿2‿3‿0‿1≡⥊5‿⌽⥊↑‿4⥊3‿⌊⥊1+↕4'               :(1, [[0,12,0,5,16,0,0,0,7,17,0,3,0,9,0,1,11,2,17,0,3,0,4,0,12,11,2,17,0,3,0,11,0,6,11,2,17,0,3,16,0,2,0,7,0,8,0,9,0,10,0,7,11,5,17,7],[runtime[0],runtime[6],runtime[18],runtime[22],runtime[26],runtime[28],runtime[31],1,2,3,0,5,4],[[0,1,0]],[[0,0]]]),
            '≡´⟨2‿⌽‿4,2‿3‿4⟩⥊¨<↕19'                     :(1, [[0,10,0,3,16,0,0,16,0,5,0,2,26,0,7,0,4,0,8,11,3,0,7,0,9,0,8,11,3,11,2,17,0,6,0,1,26,16,7],[runtime[12],runtime[18],runtime[22],runtime[28],runtime[31],runtime[47],runtime[50],2,4,3,19],[[0,1,0]],[[0,0]]]),
            "¬'a'≡<'a'"                                 :(1, [[0,3,0,1,16,0,2,0,3,17,0,0,16,7],[runtime[9],runtime[12],runtime[18],'a'],[[0,1,0]],[[0,0]]]),
            '¬"a"≡≍"a"'                                 :(1, [[0,3,0,2,16,0,1,0,3,17,0,0,16,7],[runtime[9],runtime[18],runtime[24],bqnstr("a")],[[0,1,0]],[[0,0]]]),
            '¬⟨1,2,⟨4,4⟩,5⟩≡○(2‿2⊸⥊)⟨1,2,⟨3,4⟩,5⟩'      :(1, [[0,5,0,6,0,9,0,7,11,2,0,8,11,4,0,2,0,4,0,6,0,6,11,2,27,0,3,0,1,27,0,5,0,6,0,7,0,7,11,2,0,8,11,4,17,0,0,16,7],[runtime[9],runtime[18],runtime[22],runtime[54],runtime[55],1,2,4,5,3],[[0,1,0]],[[0,0]]]),
            '¬2‿3‿4≡2‿3'                                :(1, [[0,2,0,3,11,2,0,1,0,2,0,3,0,4,11,3,17,0,0,16,7],[runtime[9],runtime[18],2,3,4],[[0,1,0]],[[0,0]]]),
            '¬1.001≡1.002'                              :(1, [[0,3,0,1,0,2,17,0,0,16,7],[runtime[9],runtime[18],1.001,1.002],[[0,1,0]],[[0,0]]]),
            "'a'≢2"                                     :(1, [[0,1,0,0,0,2,17,7],[runtime[19],2,'a'],[[0,1,0]],[[0,0]]]),
            '2≢<2'                                      :(1, [[0,2,0,0,16,0,1,0,2,17,7],[runtime[12],runtime[19],2],[[0,1,0]],[[0,0]]]),
            '2‿3≢2‿4'                                   :(1, [[0,1,0,3,11,2,0,0,0,1,0,2,11,2,17,7],[runtime[19],2,3,4],[[0,1,0]],[[0,0]]]),
            '2‿3≢≍2‿3'                                  :(1, [[0,2,0,3,11,2,0,1,16,0,0,0,2,0,3,11,2,17,7],[runtime[19],runtime[24],2,3],[[0,1,0]],[[0,0]]]),
            "0≡≡'a'"                                    :(1, [[0,2,0,0,16,0,0,0,1,17,7],[runtime[18],0,'a'],[[0,1,0]],[[0,0]]]),
            '1≡≡↕6'                                     :(1, [[0,3,0,1,16,0,0,16,0,0,0,2,17,7],[runtime[18],runtime[28],1,6],[[0,1,0]],[[0,0]]]),
            '2≡≡↕2‿4'                                   :(1, [[0,2,0,3,11,2,0,1,16,0,0,16,0,0,0,2,17,7],[runtime[18],runtime[28],2,4],[[0,1,0]],[[0,0]]]),
            '3≡≡<<<4'                                   :(1, [[0,3,0,0,16,0,0,16,0,0,16,0,1,16,0,1,0,2,17,7],[runtime[12],runtime[18],3,4],[[0,1,0]],[[0,0]]]),
            '(1¨≡-○≡˜⟜↕¨)⟨0,⟨⟩,⟨1⟩,2,⟨3,4⟩⟩'            :(1, [[0,8,11,0,0,7,11,1,0,9,0,10,0,11,11,2,11,5,0,4,0,2,0,6,0,3,0,1,0,5,0,0,27,26,27,26,0,1,0,4,0,7,26,21,16,7],[runtime[1],runtime[18],runtime[28],runtime[45],runtime[47],runtime[54],runtime[56],1,0,2,3,4],[[0,1,0]],[[0,0]]]),
            "2≡≡⟨5,⟨'c',+,2⟩⟩"                          :(1, [[0,3,0,4,0,0,0,2,11,3,11,2,0,1,16,0,1,0,2,17,7],[runtime[0],runtime[18],2,5,'c'],[[0,1,0]],[[0,0]]]),
            '0≡≡⊑⟨-⟩'                                   :(1, [[0,0,11,1,0,2,16,0,1,16,0,1,0,3,17,7],[runtime[1],runtime[18],runtime[37],0],[[0,1,0]],[[0,0]]]),
        })
        # fmt: on

    def test_layer4(self):
        runtime = self.runtime
        # fmt: off
        self.runcases({
            '"a"≡⋈\'a\''                                          :(1, [[0,2,0,1,16,0,0,0,3,17,7],[runtime[18],runtime[25],'a',bqnstr("a")],[[0,1,0]],[[0,0]]]),
            "({⟨𝕩⟩}≡⋈)'a'‿2"                                      :(1, [[0,3,0,2,11,2,0,1,0,0,1,1,21,16,7,34,0,1,11,1,7],[runtime[18],runtime[25],2,'a'],[[0,1,0],[0,0,1]],[[0,0],[15,3]]]),
            '"abc"‿1≡"abc"⋈1'                                     :(1, [[0,2,0,1,0,3,17,0,0,0,3,0,2,11,2,17,7],[runtime[18],runtime[25],1,bqnstr("abc")],[[0,1,0]],[[0,0]]]),
            '⋈´⊸≡"ab"'                                            :(1, [[0,4,0,0,0,3,0,2,0,1,26,27,16,7],[runtime[18],runtime[25],runtime[50],runtime[55],bqnstr("ab")],[[0,1,0]],[[0,0]]]),
            "∧´≡⟜>¨⟨1,<'a',<∞,↕5,5‿3⥊2⟩"                          :(1, [[0,9,0,14,0,1,16,0,10,0,1,16,0,11,0,5,16,0,13,0,4,0,11,0,12,11,2,17,11,5,0,6,0,2,0,8,0,3,27,26,16,0,7,0,0,26,16,7],[runtime[10],runtime[12],runtime[13],runtime[18],runtime[22],runtime[28],runtime[47],runtime[50],runtime[56],1,math.inf,5,3,2,'a'],[[0,1,0]],[[0,0]]]),
            '2‿3‿2≡≢>↕2‿3'                                        :(1, [[0,4,0,5,11,2,0,3,16,0,0,16,0,2,16,0,1,0,4,0,5,0,4,11,3,17,7],[runtime[13],runtime[18],runtime[19],runtime[28],2,3],[[0,1,0]],[[0,0]]]),
            '2‿3≡>⟨<2,3⟩'                                         :(1, [[0,3,0,0,16,0,4,11,2,0,1,16,0,2,0,3,0,4,11,2,17,7],[runtime[12],runtime[13],runtime[18],2,3],[[0,1,0]],[[0,0]]]),
            '>↕¨2‿3'                                              :(BQNError, [[0,3,0,4,11,2,0,2,0,1,26,16,0,0,16,7],[runtime[13],runtime[28],runtime[47],2,3],[[0,1,0]],[[0,0]]]),
            '>⟨⥊2,3⟩'                                             :(BQNError, [[0,2,0,1,16,0,3,11,2,0,0,16,7],[runtime[13],runtime[22],2,3],[[0,1,0]],[[0,0]]]),
            '>(≍⋈⊢)↕4'                                            :(BQNError, [[0,5,0,4,16,0,1,0,3,0,2,21,16,0,0,16,7],[runtime[13],runtime[21],runtime[24],runtime[25],runtime[28],4],[[0,1,0]],[[0,0]]]),
            '((4⥊2)⊸⥊≡(>2‿2⥊·<2‿2⥊⊢))"abcd"'                      :(1, [[0,8,0,3,0,4,0,7,0,7,11,2,21,0,0,20,0,4,0,7,0,7,11,2,21,0,1,20,0,2,0,4,0,5,0,7,0,4,0,6,17,27,21,16,7],[runtime[12],runtime[13],runtime[18],runtime[21],runtime[22],runtime[55],4,2,bqnstr("abcd")],[[0,1,0]],[[0,0]]]),
            '(⊢≡>∘<)5‿3⥊↕15'                                      :(1, [[0,9,0,5,16,0,4,0,7,0,8,11,2,17,0,0,0,6,0,1,27,0,2,0,3,21,16,7],[runtime[12],runtime[13],runtime[18],runtime[21],runtime[22],runtime[28],runtime[53],5,3,15],[[0,1,0]],[[0,0]]]),
            '(⊢≡(><¨))5‿3⥊↕15'                                    :(1, [[0,9,0,5,16,0,4,0,7,0,8,11,2,17,0,6,0,0,26,0,1,20,0,2,0,3,21,16,7],[runtime[12],runtime[13],runtime[18],runtime[21],runtime[22],runtime[28],runtime[47],5,3,15],[[0,1,0]],[[0,0]]]),
            "(⥊≡≍)'a'"                                            :(1, [[0,3,0,2,0,0,0,1,21,16,7],[runtime[18],runtime[22],runtime[24],'a'],[[0,1,0]],[[0,0]]]),
            "(⥊≡≍)<'a'"                                           :(1, [[0,4,0,0,16,0,3,0,1,0,2,21,16,7],[runtime[12],runtime[18],runtime[22],runtime[24],'a'],[[0,1,0]],[[0,0]]]),
            '(1‿2⊸⥊≡≍)"ab"'                                       :(1, [[0,6,0,2,0,0,0,1,0,3,0,4,0,5,11,2,27,21,16,7],[runtime[18],runtime[22],runtime[24],runtime[55],1,2,bqnstr("ab")],[[0,1,0]],[[0,0]]]),
            '1‿2≡1≍2'                                             :(1, [[0,3,0,1,0,2,17,0,0,0,2,0,3,11,2,17,7],[runtime[18],runtime[24],1,2],[[0,1,0]],[[0,0]]]),
            '2‿1(≍≡2‿2⥊∾)4‿3'                                     :(1, [[0,6,0,7,11,2,0,2,0,1,0,4,0,4,11,2,21,0,0,0,3,21,0,4,0,5,11,2,17,7],[runtime[18],runtime[22],runtime[23],runtime[24],2,1,4,3],[[0,1,0]],[[0,0]]]),
            "(≍⟜<≡≍˜)'a'"                                         :(1, [[0,5,0,3,0,2,26,0,1,0,0,0,4,0,2,27,21,16,7],[runtime[12],runtime[18],runtime[24],runtime[45],runtime[56],'a'],[[0,1,0]],[[0,0]]]),
            '1‿0≍1‿2‿3'                                           :(BQNError, [[0,1,0,3,0,4,11,3,0,0,0,1,0,2,11,2,17,7],[runtime[24],1,0,2,3],[[0,1,0]],[[0,0]]]),
            '≍⟜≍↕3'                                               :(BQNError, [[0,3,0,1,16,0,0,0,2,0,0,27,16,7],[runtime[24],runtime[28],runtime[56],3],[[0,1,0]],[[0,0]]]),
            '⌽⎉1.1 ↕4'                                            :(BQNError, [[0,4,0,0,16,0,3,0,2,0,1,27,16,7],[runtime[28],runtime[31],runtime[60],1.1,4],[[0,1,0]],[[0,0]]]),
            "⌽⎉'x' ↕4"                                            :(BQNError, [[0,3,0,0,16,0,4,0,2,0,1,27,16,7],[runtime[28],runtime[31],runtime[60],4,'x'],[[0,1,0]],[[0,0]]]),
            '⌽⎉(<<0) ↕4'                                          :(BQNError, [[0,5,0,1,16,0,4,0,0,16,0,0,16,0,3,0,2,27,16,7],[runtime[12],runtime[28],runtime[31],runtime[60],0,4],[[0,1,0]],[[0,0]]]),
            '⌽⎉≍ ↕4'                                              :(BQNError, [[0,4,0,1,16,0,0,0,3,0,2,27,16,7],[runtime[24],runtime[28],runtime[31],runtime[60],4],[[0,1,0]],[[0,0]]]),
            '(≍˘˜⥊˘1‿5‿9)≡⌽⎉2⊸+⥊⟜(↕×´)3‿2‿1'                      :(1, [[0,17,0,16,0,13,11,3,0,9,0,1,26,0,5,20,0,11,0,3,27,16,0,0,0,10,0,16,0,12,0,6,27,27,16,0,2,0,13,0,14,0,15,11,3,0,8,0,3,26,16,0,7,0,8,0,4,26,26,16,17,7],[runtime[0],runtime[2],runtime[18],runtime[22],runtime[24],runtime[28],runtime[31],runtime[45],runtime[46],runtime[50],runtime[55],runtime[56],runtime[60],1,5,9,2,3],[[0,1,0]],[[0,0]]]),
            '(<0)≡≡˘0'                                            :(1, [[0,3,0,2,0,1,26,16,0,1,0,3,0,0,16,17,7],[runtime[12],runtime[18],runtime[46],0],[[0,1,0]],[[0,0]]]),
            '(<1)≡≡˘<0'                                           :(1, [[0,4,0,0,16,0,2,0,1,26,16,0,1,0,3,0,0,16,17,7],[runtime[12],runtime[18],runtime[46],1,0],[[0,1,0]],[[0,0]]]),
            '(2⥊<<"ab") ≡ ⋈˜˘<"ab"'                               :(1, [[0,7,0,0,16,0,5,0,4,0,3,26,26,16,0,1,0,7,0,0,16,0,0,16,0,2,0,6,17,17,7],[runtime[12],runtime[18],runtime[22],runtime[25],runtime[45],runtime[46],2,bqnstr("ab")],[[0,1,0]],[[0,0]]]),
            '(3⥊0) ≡ {-}=˘↕3'                                     :(1, [[0,6,0,4,16,0,5,0,1,26,1,1,17,0,2,0,7,0,3,0,6,17,17,7,0,0,7],[runtime[1],runtime[15],runtime[18],runtime[22],runtime[28],runtime[46],3,0],[[0,1,0],[0,1,1]],[[0,0],[24,0]]]),
            '(↕4)(×⌜≡×⎉0‿2)↕5'                                    :(1, [[0,8,0,2,16,0,6,0,7,11,2,0,4,0,0,27,0,1,0,3,0,0,26,21,0,5,0,2,16,17,7],[runtime[2],runtime[18],runtime[28],runtime[48],runtime[60],4,0,2,5],[[0,1,0]],[[0,0]]]),
            '(↕4)(⋆˜⌜˜≡⋆⎉∞‿¯4)↕5'                                 :(1, [[0,9,0,2,16,0,7,0,8,11,2,0,5,0,0,27,0,1,0,3,0,4,0,3,0,0,26,26,26,21,0,6,0,2,16,17,7],[runtime[4],runtime[18],runtime[28],runtime[45],runtime[48],runtime[60],4,math.inf,-4,5],[[0,1,0]],[[0,0]]]),
            '(⟨2⟩⊸∾⍟(2‿2⥊0‿1‿1‿1)2‿3)≡≢¨≍⎉(⌊○=)⌜˜⟨↕3,2‿3⥊↕6⟩'     :(1, [[0,18,0,7,16,0,19,0,7,16,0,4,0,15,0,18,11,2,17,11,2,0,8,0,10,0,1,0,11,0,0,27,0,13,0,6,27,26,26,16,0,9,0,3,26,16,0,2,0,15,0,18,11,2,0,16,0,17,0,17,0,17,11,4,0,4,0,15,0,15,11,2,17,0,14,0,5,0,12,0,15,11,1,27,27,16,17,7],[runtime[6],runtime[15],runtime[18],runtime[19],runtime[22],runtime[23],runtime[24],runtime[28],runtime[45],runtime[47],runtime[48],runtime[54],runtime[55],runtime[60],runtime[62],2,0,1,3,6],[[0,1,0]],[[0,0]]]),
            '(2=⌜○↕3)≡(2‿4⥊"abc")≡⎉1(2‿3‿4⥊"abc")'                :(1, [[0,11,0,2,0,7,0,8,0,9,11,3,17,0,10,0,6,0,1,27,0,11,0,2,0,7,0,9,11,2,17,17,0,1,0,8,0,3,0,5,0,4,0,0,26,27,0,7,17,17,7],[runtime[15],runtime[18],runtime[22],runtime[28],runtime[48],runtime[54],runtime[60],2,3,4,1,bqnstr("abc")],[[0,1,0]],[[0,0]]]),
            '⟨0,0⟩≡(2‿4⥊"abc")≡⎉¯1(2‿3‿4⥊"abc")'                  :(1, [[0,8,0,1,0,4,0,7,0,5,11,3,17,0,6,0,2,0,0,27,0,8,0,1,0,4,0,5,11,2,17,17,0,0,0,3,0,3,11,2,17,7],[runtime[18],runtime[22],runtime[60],0,2,4,-1,3,bqnstr("abc")],[[0,1,0]],[[0,0]]]),
            '⌽⚇2‿2.5 ↕3'                                          :(BQNError, [[0,5,0,0,16,0,3,0,4,11,2,0,2,0,1,27,16,7],[runtime[28],runtime[31],runtime[61],2,2.5,3],[[0,1,0]],[[0,0]]]),
            '(-≡-⚇¯1)5'                                           :(1, [[0,4,0,3,0,2,0,0,27,0,1,0,0,21,16,7],[runtime[1],runtime[18],runtime[61],-1,5],[[0,1,0]],[[0,0]]]),
            '⟨5,⟨15,1⟩⟩≡+´⚇1⟨⟨3,2⟩,⟨⟨4,5,6⟩,⟨1⟩⟩⟩'                :(1, [[0,7,0,8,11,2,0,9,0,4,0,10,11,3,0,6,11,1,11,2,11,2,0,6,0,3,0,2,0,0,26,27,16,0,1,0,4,0,5,0,6,11,2,11,2,17,7],[runtime[0],runtime[18],runtime[50],runtime[61],5,15,1,3,2,4,6],[[0,1,0]],[[0,0]]]),
            '5‿6‿15≡∾´+´⚇1⟨⟨0,1⟩,⟨⟨⟩⟩⟩⥊⊸∾⚇¯2‿1⟨⟨2,3⟩,⟨4,5,6⟩⟩'    :(1, [[0,13,0,14,11,2,0,15,0,7,0,8,11,3,11,2,0,12,0,10,11,2,0,6,0,3,0,5,0,2,27,27,0,11,0,10,11,2,11,0,11,1,11,2,17,0,10,0,6,0,4,0,0,26,27,16,0,4,0,3,26,16,0,1,0,7,0,8,0,9,11,3,17,7],[runtime[0],runtime[18],runtime[22],runtime[23],runtime[50],runtime[55],runtime[61],5,6,15,1,0,-2,2,3,4],[[0,1,0]],[[0,0]]]),
            '(5⥊1)≡(↕5)=○=⚇0{≍}'                                  :(1, [[1,1,0,9,0,6,0,0,0,5,0,0,27,27,0,7,0,4,16,17,0,1,0,8,0,2,0,7,17,17,7,0,3,7],[runtime[15],runtime[18],runtime[22],runtime[24],runtime[28],runtime[54],runtime[61],5,1,0],[[0,1,0],[0,1,1]],[[0,0],[31,0]]]),
            "2+⍟1‿'c'4"                                           :(BQNError, [[0,4,0,3,0,5,11,2,0,1,0,0,27,0,2,17,7],[runtime[0],runtime[62],2,1,4,'c'],[[0,1,0]],[[0,0]]]),
            '⋆⍟1.5 2'                                             :(BQNError, [[0,3,0,2,0,1,0,0,27,16,7],[runtime[4],runtime[62],1.5,2],[[0,1,0]],[[0,0]]]),
            '4≡2+⍟¯1 6'                                           :(1, [[0,6,0,5,0,2,0,0,27,0,4,17,0,1,0,3,17,7],[runtime[0],runtime[18],runtime[62],4,2,-1,6],[[0,1,0]],[[0,0]]]),
            '(2×↕7)≡2+⍟(¯3+↕7)6'                                  :(1, [[0,8,0,6,0,3,16,0,0,0,7,17,0,4,0,0,27,0,5,17,0,2,0,6,0,3,16,0,1,0,5,17,17,7],[runtime[0],runtime[2],runtime[18],runtime[28],runtime[62],2,7,-3,6],[[0,1,0]],[[0,0]]]),
            '(3⌊↕5)≡{i←0⋄r←{i+↩1⋄1+𝕩}⍟(↕4)𝕩⋄r∾i}0'                :(1, [[0,8,1,1,16,0,2,0,7,0,4,16,0,1,0,6,17,17,7,0,8,33,0,3,48,6,34,0,1,0,10,0,4,16,0,5,1,2,27,16,33,0,4,48,6,32,0,3,0,3,34,0,4,17,7,0,9,0,0,33,1,3,50,6,34,0,1,0,0,0,9,17,7],[runtime[0],runtime[6],runtime[18],runtime[23],runtime[28],runtime[62],3,5,0,1,4],[[0,1,0],[0,0,1],[0,0,2]],[[0,0],[19,5],[55,3]]]),
            '(+⌜˜≡·>1+⍟⊢⊢)↕5'                                     :(1, [[0,9,0,4,16,0,3,0,3,0,7,0,0,27,0,8,21,0,1,20,0,2,0,5,0,6,0,0,26,26,21,16,7],[runtime[0],runtime[13],runtime[18],runtime[21],runtime[28],runtime[45],runtime[48],runtime[62],1,5],[[0,1,0]],[[0,0]]]),
            '+˝6'                                                 :(BQNError, [[0,2,0,1,0,0,26,16,7],[runtime[0],runtime[51],6],[[0,1,0]],[[0,0]]]),
            '⊢˝<6'                                                :(BQNError, [[0,3,0,0,16,0,2,0,1,26,16,7],[runtime[12],runtime[21],runtime[51],6],[[0,1,0]],[[0,0]]]),
            "(+˝≡·<+´)¯8‿4‿¯38‿'!'‿21"                            :(1, [[0,5,0,6,0,7,0,9,0,8,11,5,0,3,0,0,26,0,1,20,0,2,0,4,0,0,26,21,16,7],[runtime[0],runtime[12],runtime[18],runtime[50],runtime[51],-8,4,-38,21,'!'],[[0,1,0]],[[0,0]]]),
            '(¯2⊸×≡·-˝×⌜˜)↕4'                                     :(1, [[0,9,0,3,16,0,4,0,5,0,1,26,26,0,6,0,0,26,20,0,2,0,1,0,7,0,8,27,21,16,7],[runtime[1],runtime[2],runtime[18],runtime[28],runtime[45],runtime[48],runtime[51],runtime[55],-2,4],[[0,1,0]],[[0,0]]]),
            '(⋈˝˘≡<¨)3‿2⥊"abcdef"'                                :(1, [[0,9,0,2,0,7,0,8,11,2,17,0,5,0,0,26,0,1,0,4,0,6,0,3,26,26,21,16,7],[runtime[12],runtime[18],runtime[22],runtime[25],runtime[46],runtime[47],runtime[51],3,2,bqnstr("abcdef")],[[0,1,0]],[[0,0]]]),
            '(⊣˝≡⊏)2‿1‿1‿2‿1⥊"abcd"'                              :(1, [[0,7,0,2,0,5,0,6,0,6,0,5,0,6,11,5,17,0,3,0,0,0,4,0,1,26,21,16,7],[runtime[18],runtime[20],runtime[22],runtime[36],runtime[51],2,1,bqnstr("abcd")],[[0,1,0]],[[0,0]]]),
            '0‿1‿3‿6‿10≡+`↕5'                                     :(1, [[0,9,0,2,16,0,3,0,0,26,16,0,1,0,4,0,5,0,6,0,7,0,8,11,5,17,7],[runtime[0],runtime[18],runtime[28],runtime[52],0,1,3,6,10,5],[[0,1,0]],[[0,0]]]),
            '(-0‿1‿3‿6‿10)≡-`↕5'                                  :(1, [[0,9,0,2,16,0,3,0,0,26,16,0,1,0,4,0,5,0,6,0,7,0,8,11,5,0,0,16,17,7],[runtime[1],runtime[18],runtime[28],runtime[52],0,1,3,6,10,5],[[0,1,0]],[[0,0]]]),
            '((0∾¨↕3)≍3⥊0)≡≡`↕2‿3'                                :(1, [[0,9,0,8,11,2,0,4,16,0,6,0,0,26,16,0,0,0,7,0,1,0,8,17,0,3,0,8,0,4,16,0,5,0,2,26,0,7,17,17,17,7],[runtime[18],runtime[22],runtime[23],runtime[24],runtime[28],runtime[47],runtime[52],0,3,2],[[0,1,0]],[[0,0]]]),
            '⟨⟩≡×`⟨⟩'                                             :(1, [[11,0,0,2,0,0,26,16,0,1,11,0,17,7],[runtime[2],runtime[18],runtime[52]],[[0,1,0]],[[0,0]]]),
            '≡⟜(!∘0`)3‿0‿2⥊""'                                    :(1, [[0,9,0,1,0,7,0,6,0,8,11,3,17,0,3,0,6,0,4,0,2,27,26,0,5,0,0,27,16,7],[runtime[18],runtime[22],runtime[43],runtime[52],runtime[53],runtime[56],0,3,2,bqnstr("")],[[0,1,0]],[[0,0]]]),
            '+`4'                                                 :(BQNError, [[0,2,0,1,0,0,26,16,7],[runtime[0],runtime[52],4],[[0,1,0]],[[0,0]]]),
            "+`<'c'"                                              :(BQNError, [[0,3,0,1,16,0,2,0,0,26,16,7],[runtime[0],runtime[12],runtime[52],'c'],[[0,1,0]],[[0,0]]]),
            '2‿3‿5‿8‿12≡2+`↕5'                                    :(1, [[0,6,0,2,16,0,3,0,0,26,0,4,17,0,1,0,4,0,5,0,6,0,7,0,8,11,5,17,7],[runtime[0],runtime[18],runtime[28],runtime[52],2,3,5,8,12],[[0,1,0]],[[0,0]]]),
            '3‿4+`4+⌜○↕3'                                         :(BQNError, [[0,5,0,1,0,4,0,2,0,0,26,27,0,6,17,0,3,0,0,26,0,5,0,6,11,2,17,7],[runtime[0],runtime[28],runtime[48],runtime[52],runtime[54],3,4],[[0,1,0]],[[0,0]]]),
            '(2⋆1‿2‿6×⌜0‿2)≡3‿4⋆`3+⌜○↕2'                          :(1, [[0,8,0,4,0,7,0,5,0,0,26,27,0,12,17,0,6,0,2,26,0,12,0,13,11,2,17,0,3,0,11,0,8,11,2,0,5,0,1,26,0,9,0,8,0,10,11,3,17,0,2,0,8,17,17,7],[runtime[0],runtime[2],runtime[4],runtime[18],runtime[28],runtime[48],runtime[52],runtime[54],2,1,6,0,3,4],[[0,1,0]],[[0,0]]]),
        })
        # fmt: on

    def test_layer5(self):
        runtime = self.runtime
        # fmt: off
        self.runcases({
            '(<\'a\')≡⊏"abc"'                                      :(1, [[0,4,0,2,16,0,1,0,3,0,0,16,17,7],[runtime[12],runtime[18],runtime[36],'a',bqnstr("abc")],[[0,1,0]],[[0,0]]]),
            '⊏""'                                                  :(BQNError, [[0,1,0,0,16,7],[runtime[36],bqnstr("")],[[0,1,0]],[[0,0]]]),
            '"a"≡⊏⥊˘"abc"'                                         :(1, [[0,5,0,3,0,1,26,16,0,2,16,0,0,0,4,17,7],[runtime[18],runtime[22],runtime[36],runtime[46],bqnstr("a"),bqnstr("abc")],[[0,1,0]],[[0,0]]]),
            '⊏0‿3⥊""'                                              :(BQNError, [[0,4,0,0,0,2,0,3,11,2,17,0,1,16,7],[runtime[22],runtime[36],0,3,bqnstr("")],[[0,1,0]],[[0,0]]]),
            '(<\'c\')≡2⊏"abc"'                                     :(1, [[0,5,0,2,0,3,17,0,1,0,4,0,0,16,17,7],[runtime[12],runtime[18],runtime[36],2,'c',bqnstr("abc")],[[0,1,0]],[[0,0]]]),
            '3⊏"abc"'                                              :(BQNError, [[0,2,0,0,0,1,17,7],[runtime[36],3,bqnstr("abc")],[[0,1,0]],[[0,0]]]),
            '1.5⊏"abc"'                                            :(BQNError, [[0,2,0,0,0,1,17,7],[runtime[36],1.5,bqnstr("abc")],[[0,1,0]],[[0,0]]]),
            '\'x\'⊏"abc"'                                          :(BQNError, [[0,2,0,0,0,1,17,7],[runtime[36],'x',bqnstr("abc")],[[0,1,0]],[[0,0]]]),
            '(<\'c\')≡¯1⊏"abc"'                                    :(1, [[0,5,0,2,0,3,17,0,1,0,4,0,0,16,17,7],[runtime[12],runtime[18],runtime[36],-1,'c',bqnstr("abc")],[[0,1,0]],[[0,0]]]),
            '"ccc"≡2‿¯1‿2⊏"abc"'                                   :(1, [[0,5,0,1,0,2,0,3,0,2,11,3,17,0,0,0,4,17,7],[runtime[18],runtime[36],2,-1,bqnstr("ccc"),bqnstr("abc")],[[0,1,0]],[[0,0]]]),
            '⟨⥊0,1⟩⊏≍"abc"'                                        :(BQNError, [[0,5,0,1,16,0,2,0,3,0,0,16,0,4,11,2,17,7],[runtime[22],runtime[24],runtime[36],0,1,bqnstr("abc")],[[0,1,0]],[[0,0]]]),
            '((3-˜↕5)⊸⊏≡2⊸⌽)↕5‿2'                                  :(1, [[0,8,0,9,11,2,0,2,16,0,3,0,6,0,9,27,0,1,0,4,0,6,0,8,0,2,16,0,5,0,0,26,0,7,17,27,21,16,7],[runtime[1],runtime[18],runtime[28],runtime[31],runtime[36],runtime[45],runtime[55],3,5,2],[[0,1,0]],[[0,0]]]),
            '(0‿3⥊0)≡⟨⟩⊏2‿3⥊↕6'                                    :(1, [[0,7,0,2,16,0,1,0,6,0,5,11,2,17,0,3,11,0,17,0,0,0,4,0,1,0,4,0,5,11,2,17,17,7],[runtime[18],runtime[22],runtime[28],runtime[36],0,3,2,6],[[0,1,0]],[[0,0]]]),
            '⟨3‿0,2‿1‿2⟩(×⟜5⊸+⌜´∘⊣≡⊏)⥊⟜(↕×´)6‿5'                   :(1, [[0,17,0,16,11,2,0,8,0,1,26,0,5,20,0,11,0,4,27,16,0,6,0,2,0,3,0,9,0,8,0,7,0,0,0,10,0,16,0,11,0,1,27,27,26,26,27,21,0,12,0,13,11,2,0,14,0,15,0,14,11,3,11,2,17,7],[runtime[0],runtime[2],runtime[18],runtime[20],runtime[22],runtime[28],runtime[36],runtime[48],runtime[50],runtime[53],runtime[55],runtime[56],3,0,2,1,5,6],[[0,1,0]],[[0,0]]]),
            '0‿0<¨⊸⊏"abc"'                                         :(BQNError, [[0,5,0,1,0,3,0,2,0,0,26,27,0,4,0,4,11,2,17,7],[runtime[12],runtime[36],runtime[47],runtime[55],0,bqnstr("abc")],[[0,1,0]],[[0,0]]]),
            '(2‿0⥊0)≡⟨3‿¯1,⟨⟩⟩⊏4‿3⥊0'                              :(1, [[0,4,0,1,0,7,0,5,11,2,17,0,2,0,5,0,6,11,2,11,0,11,2,17,0,0,0,4,0,1,0,3,0,4,11,2,17,17,7],[runtime[18],runtime[22],runtime[36],2,0,3,-1,4],[[0,1,0]],[[0,0]]]),
            '⟨3‿¯∞,⟨⟩⟩⊏4‿3⥊0'                                      :(BQNError, [[0,5,0,0,0,4,0,2,11,2,17,0,1,0,2,0,3,11,2,11,0,11,2,17,7],[runtime[22],runtime[36],3,-math.inf,4,0],[[0,1,0]],[[0,0]]]),
            '5‿1(<⊸⊏≡⊏)↕6‿2'                                       :(1, [[0,7,0,8,11,2,0,2,16,0,3,0,1,0,3,0,4,0,0,27,21,0,5,0,6,11,2,17,7],[runtime[12],runtime[18],runtime[28],runtime[36],runtime[55],5,1,6,2],[[0,1,0]],[[0,0]]]),
            '(≍≍<5‿1)⊏↕6‿2'                                        :(BQNError, [[0,6,0,7,11,2,0,2,16,0,3,0,4,0,5,11,2,0,0,16,0,1,16,0,1,16,17,7],[runtime[12],runtime[24],runtime[28],runtime[36],5,1,6,2],[[0,1,0]],[[0,0]]]),
            '⟨4‿0,1‿2‿3‿2‿1‿0⟩(+⌜´⊸(×⌜)≡⊏⟜(×⌜˜))+⌜˜↕5'             :(1, [[0,15,0,3,16,0,5,0,6,0,0,26,26,16,0,5,0,6,0,1,26,26,0,9,0,4,27,0,2,0,6,0,1,26,0,8,0,7,0,6,0,0,26,26,27,21,0,10,0,11,11,2,0,12,0,13,0,14,0,13,0,12,0,11,11,6,11,2,17,7],[runtime[0],runtime[2],runtime[18],runtime[28],runtime[36],runtime[45],runtime[48],runtime[50],runtime[55],runtime[56],4,0,1,2,3,5],[[0,1,0]],[[0,0]]]),
            '∧´1=≡¨(<⟨⟩)(↑¨∾↓¨)⟨@,+,<@,↕3⟩'                        :(1, [[0,13,0,0,0,13,0,2,16,0,12,0,8,16,11,4,0,9,0,7,26,0,5,0,9,0,6,26,21,11,0,0,2,16,17,0,9,0,4,26,16,0,3,0,11,17,0,10,0,1,26,16,7],[runtime[0],runtime[10],runtime[12],runtime[15],runtime[18],runtime[23],runtime[26],runtime[27],runtime[28],runtime[47],runtime[50],1,3,'\0'],[[0,1,0]],[[0,0]]]),
            '"abc"≡3↑"abce"'                                       :(1, [[0,4,0,1,0,2,17,0,0,0,3,17,7],[runtime[18],runtime[26],3,bqnstr("abc"),bqnstr("abce")],[[0,1,0]],[[0,0]]]),
            '"e"≡¯1↑"abce"'                                        :(1, [[0,4,0,1,0,2,17,0,0,0,3,17,7],[runtime[18],runtime[26],-1,bqnstr("e"),bqnstr("abce")],[[0,1,0]],[[0,0]]]),
            '""≡0↑"ab"'                                            :(1, [[0,4,0,1,0,2,17,0,0,0,3,17,7],[runtime[18],runtime[26],0,bqnstr(""),bqnstr("ab")],[[0,1,0]],[[0,0]]]),
            '2.5↑"abce"'                                           :(BQNError, [[0,2,0,0,0,1,17,7],[runtime[26],2.5,bqnstr("abce")],[[0,1,0]],[[0,0]]]),
            '(<⟜3⊸×↕5)≡5↑↕3'                                       :(1, [[0,7,0,4,16,0,3,0,8,17,0,2,0,8,0,4,16,0,0,0,5,0,7,0,6,0,1,27,27,16,17,7],[runtime[2],runtime[12],runtime[18],runtime[26],runtime[28],runtime[55],runtime[56],3,5],[[0,1,0]],[[0,0]]]),
            '(6⥊0)≡¯6↑↕0'                                          :(1, [[0,5,0,3,16,0,2,0,6,17,0,0,0,5,0,1,0,4,17,17,7],[runtime[18],runtime[22],runtime[26],runtime[28],6,0,-6],[[0,1,0]],[[0,0]]]),
            '(≍↕3)≡1↑2‿3⥊↕6'                                       :(1, [[0,8,0,4,16,0,1,0,7,0,5,11,2,17,0,3,0,6,17,0,0,0,5,0,4,16,0,2,16,17,7],[runtime[18],runtime[22],runtime[24],runtime[26],runtime[28],3,1,2,6],[[0,1,0]],[[0,0]]]),
            '(∾⟜0‿0‿0≡3⊸↑)2‿3⥊↕6'                                  :(1, [[0,10,0,4,16,0,1,0,9,0,8,11,2,17,0,3,0,5,0,8,27,0,0,0,7,0,7,0,7,11,3,0,6,0,2,27,21,16,7],[runtime[18],runtime[22],runtime[23],runtime[26],runtime[28],runtime[55],runtime[56],0,3,2,6],[[0,1,0]],[[0,0]]]),
            '((0×⊏)⊸∾≡¯4⊸↑)3‿5⥊↕15'                                :(1, [[0,12,0,5,16,0,2,0,10,0,11,11,2,17,0,4,0,7,0,9,27,0,1,0,3,0,7,0,6,0,0,0,8,21,27,21,16,7],[runtime[2],runtime[18],runtime[22],runtime[23],runtime[26],runtime[28],runtime[36],runtime[55],0,-4,3,5,15],[[0,1,0]],[[0,0]]]),
            '(↑⟜4≡⥊⟜0)↕3'                                          :(1, [[0,7,0,3,16,0,6,0,4,0,1,27,0,0,0,5,0,4,0,2,27,21,16,7],[runtime[18],runtime[22],runtime[26],runtime[28],runtime[56],4,0,3],[[0,1,0]],[[0,0]]]),
            '(≍"abc")≡(<1)↑2‿3↑"abcd"'                             :(1, [[0,8,0,3,0,5,0,6,11,2,17,0,3,0,4,0,0,16,17,0,1,0,7,0,2,16,17,7],[runtime[12],runtime[18],runtime[24],runtime[26],1,2,3,bqnstr("abc"),bqnstr("abcd")],[[0,1,0]],[[0,0]]]),
            '2‿\'c\'↑"abcd"'                                       :(BQNError, [[0,3,0,0,0,1,0,2,11,2,17,7],[runtime[26],2,'c',bqnstr("abcd")],[[0,1,0]],[[0,0]]]),
            '(≍2‿3)↑"abcd"'                                        :(BQNError, [[0,4,0,1,0,2,0,3,11,2,0,0,16,17,7],[runtime[24],runtime[26],2,3,bqnstr("abcd")],[[0,1,0]],[[0,0]]]),
            '(6⥊1)(↑≡⥊⟜⊑)2‿3⥊↕6'                                   :(1, [[0,6,0,3,16,0,1,0,8,0,9,11,2,17,0,4,0,5,0,1,27,0,0,0,2,21,0,7,0,1,0,6,17,17,7],[runtime[18],runtime[22],runtime[26],runtime[28],runtime[37],runtime[56],6,1,2,3],[[0,1,0]],[[0,0]]]),
            '(↕¨∘↕∘(1⊸+)≡↑∘↕)5'                                    :(1, [[0,8,0,3,0,5,0,2,27,0,1,0,0,0,6,0,7,27,0,5,0,3,0,5,0,4,0,3,26,27,27,21,16,7],[runtime[0],runtime[18],runtime[26],runtime[28],runtime[47],runtime[53],runtime[55],1,5],[[0,1,0]],[[0,0]]]),
            '(↑≡((↕4)≍¨2)⥊¨<)3‿2⥊"abcdef"'                         :(1, [[0,10,0,2,0,9,0,8,11,2,17,0,0,0,6,0,2,26,0,8,0,6,0,3,26,0,7,0,5,16,17,21,0,1,0,4,21,16,7],[runtime[12],runtime[18],runtime[22],runtime[24],runtime[26],runtime[28],runtime[47],4,2,3,bqnstr("abcdef")],[[0,1,0]],[[0,0]]]),
            '"d"≡3↓"abcd"'                                         :(1, [[0,4,0,1,0,2,17,0,0,0,3,17,7],[runtime[18],runtime[27],3,bqnstr("d"),bqnstr("abcd")],[[0,1,0]],[[0,0]]]),
            '0.1↓"abcd"'                                           :(BQNError, [[0,2,0,0,0,1,17,7],[runtime[27],0.1,bqnstr("abcd")],[[0,1,0]],[[0,0]]]),
            '⟨∘⟩↓"abcd"'                                           :(BQNError, [[0,2,0,0,0,1,11,1,17,7],[runtime[27],runtime[53],bqnstr("abcd")],[[0,1,0]],[[0,0]]]),
            '1‿2≡⟜(¯3⊸↓)○↕4‿2'                                     :(1, [[0,9,0,7,11,2,0,2,0,3,0,1,0,4,0,8,27,0,5,0,0,27,27,0,6,0,7,11,2,17,7],[runtime[18],runtime[27],runtime[28],runtime[54],runtime[55],runtime[56],1,2,-3,4],[[0,1,0]],[[0,0]]]),
            '1‿1‿3‿2‿1≡≢(5⥊0)↓↕3‿2‿1'                              :(1, [[0,6,0,7,0,5,11,3,0,4,16,0,3,0,9,0,2,0,8,17,17,0,1,16,0,0,0,5,0,5,0,6,0,7,0,5,11,5,17,7],[runtime[18],runtime[19],runtime[22],runtime[27],runtime[28],1,3,2,5,0],[[0,1,0]],[[0,0]]]),
            '(↓∘↕≡↕∘(1⊸+)+⟜⌽↑∘↕)5'                                 :(1, [[0,10,0,4,0,6,0,2,27,0,5,0,8,0,0,27,0,0,0,7,0,9,27,0,6,0,4,27,21,0,1,0,4,0,6,0,3,27,21,16,7],[runtime[0],runtime[18],runtime[26],runtime[27],runtime[28],runtime[31],runtime[53],runtime[55],runtime[56],1,5],[[0,1,0]],[[0,0]]]),
            '(↕3‿4)≡1↓¨⊏↕2‿3‿4'                                    :(1, [[0,8,0,5,0,6,11,3,0,2,16,0,3,16,0,4,0,1,26,0,7,17,0,0,0,5,0,6,11,2,0,2,16,17,7],[runtime[18],runtime[27],runtime[28],runtime[36],runtime[47],3,4,1,2],[[0,1,0]],[[0,0]]]),
            '(4+⌜○↕2)≡2↕↕5'                                        :(1, [[0,7,0,2,16,0,2,0,6,17,0,1,0,6,0,2,0,4,0,3,0,0,26,27,0,5,17,17,7],[runtime[0],runtime[18],runtime[28],runtime[48],runtime[54],4,2,5],[[0,1,0]],[[0,0]]]),
            '@↕↕5'                                                 :(BQNError, [[0,1,0,0,16,0,0,0,2,17,7],[runtime[28],5,'\0'],[[0,1,0]],[[0,0]]]),
            '2‿1↕↕5'                                               :(BQNError, [[0,3,0,0,16,0,0,0,1,0,2,11,2,17,7],[runtime[28],2,1,5],[[0,1,0]],[[0,0]]]),
            '¯1↕↕5'                                                :(BQNError, [[0,2,0,0,16,0,0,0,1,17,7],[runtime[28],-1,5],[[0,1,0]],[[0,0]]]),
            '7↕↕5'                                                 :(BQNError, [[0,2,0,0,16,0,0,0,1,17,7],[runtime[28],7,5],[[0,1,0]],[[0,0]]]),
            '⟨⟩(↕≡⊢)4‿3⥊"abcd"'                                    :(1, [[0,6,0,2,0,4,0,5,11,2,17,0,1,0,0,0,3,21,11,0,17,7],[runtime[18],runtime[21],runtime[22],runtime[28],4,3,bqnstr("abcd")],[[0,1,0]],[[0,0]]]),
            '(<≡⟨⟩⊸↕){×}'                                          :(1, [[1,1,0,3,0,4,11,0,27,0,2,0,1,21,16,7,0,0,7],[runtime[2],runtime[12],runtime[18],runtime[28],runtime[55]],[[0,1,0],[0,1,1]],[[0,0],[16,0]]]),
            '(0⊸↕≡(0≍˜1+≠)⊸⥊)↕6'                                   :(1, [[0,10,0,5,16,0,3,0,7,0,1,0,0,0,9,21,0,6,0,4,26,0,8,21,27,0,2,0,5,0,7,0,8,27,21,16,7],[runtime[0],runtime[14],runtime[18],runtime[22],runtime[24],runtime[28],runtime[45],runtime[55],0,1,6],[[0,1,0]],[[0,0]]]),
            '(7↕6‿0⥊"")≡0‿7‿0⥊""'                                  :(1, [[0,6,0,1,0,5,0,3,0,5,11,3,17,0,0,0,6,0,1,0,4,0,5,11,2,17,0,2,0,3,17,17,7],[runtime[18],runtime[22],runtime[28],7,6,0,bqnstr("")],[[0,1,0]],[[0,0]]]),
            "'a'«'b'"                                              :(BQNError, [[0,2,0,0,0,1,17,7],[runtime[29],'a','b'],[[0,1,0]],[[0,0]]]),
            '"a"»\'b\''                                            :(BQNError, [[0,1,0,0,0,2,17,7],[runtime[30],'b',bqnstr("a")],[[0,1,0]],[[0,0]]]),
            '≍⊸»"abc"'                                             :(BQNError, [[0,3,0,1,0,2,0,0,27,16,7],[runtime[24],runtime[30],runtime[55],bqnstr("abc")],[[0,1,0]],[[0,0]]]),
            '(»˜⊸≡∧«˜⊸≡)""'                                        :(1, [[0,6,0,1,0,5,0,4,0,2,26,27,0,0,0,1,0,5,0,4,0,3,26,27,21,16,7],[runtime[10],runtime[18],runtime[29],runtime[30],runtime[45],runtime[55],bqnstr("")],[[0,1,0]],[[0,0]]]),
            '"a"≡⟨⟩»"a"'                                           :(1, [[0,2,0,1,11,0,17,0,0,0,2,17,7],[runtime[18],runtime[30],bqnstr("a")],[[0,1,0]],[[0,0]]]),
            '⟨⟩≡"a"»⟨⟩'                                            :(1, [[11,0,0,1,0,2,17,0,0,11,0,17,7],[runtime[18],runtime[30],bqnstr("a")],[[0,1,0]],[[0,0]]]),
            '"aBC"≡"a"»"BCD"'                                      :(1, [[0,4,0,1,0,3,17,0,0,0,2,17,7],[runtime[18],runtime[30],bqnstr("aBC"),bqnstr("a"),bqnstr("BCD")],[[0,1,0]],[[0,0]]]),
            '"CDa"≡"a"«"BCD"'                                      :(1, [[0,4,0,1,0,3,17,0,0,0,2,17,7],[runtime[18],runtime[29],bqnstr("CDa"),bqnstr("a"),bqnstr("BCD")],[[0,1,0]],[[0,0]]]),
            '"d"≡"abcd"«⟨4⟩'                                       :(1, [[0,2,11,1,0,1,0,4,17,0,0,0,3,17,7],[runtime[18],runtime[29],4,bqnstr("d"),bqnstr("abcd")],[[0,1,0]],[[0,0]]]),
            '((⊢⌜˜≠¨)≡(≠¨«⌜˜))""‿⟨2,3⟩‿"abcde"'                    :(1, [[0,9,0,7,0,8,11,2,0,10,11,3,0,4,0,6,0,3,26,26,0,5,0,0,26,20,0,1,0,5,0,0,26,0,4,0,6,0,2,26,26,20,21,16,7],[runtime[14],runtime[18],runtime[21],runtime[29],runtime[45],runtime[47],runtime[48],2,3,bqnstr(""),bqnstr("abcde")],[[0,1,0]],[[0,0]]]),
            '"Zcab"≡"WXYZ"«´"ab"‿"c"‿""'                           :(1, [[0,5,0,6,0,7,11,3,0,2,0,1,26,0,4,17,0,0,0,3,17,7],[runtime[18],runtime[29],runtime[50],bqnstr("Zcab"),bqnstr("WXYZ"),bqnstr("ab"),bqnstr("c"),bqnstr("")],[[0,1,0]],[[0,0]]]),
            '"dab"≡\'d\'»"abc"'                                    :(1, [[0,4,0,1,0,2,17,0,0,0,3,17,7],[runtime[18],runtime[30],'d',bqnstr("dab"),bqnstr("abc")],[[0,1,0]],[[0,0]]]),
            '"dab"≡\'d\'<⊸»"abc"'                                  :(1, [[0,6,0,2,0,3,0,0,27,0,4,17,0,1,0,5,17,7],[runtime[12],runtime[18],runtime[30],runtime[55],'d',bqnstr("dab"),bqnstr("abc")],[[0,1,0]],[[0,0]]]),
            "(1⊸⌽≡⊏⊸«)'a'+⥊⟜(↕×´)4‿2"                              :(1, [[0,12,0,13,11,2,0,8,0,1,26,0,4,20,0,10,0,3,27,16,0,0,0,14,17,0,5,0,9,0,7,27,0,2,0,6,0,9,0,11,27,21,16,7],[runtime[0],runtime[2],runtime[18],runtime[22],runtime[28],runtime[29],runtime[31],runtime[36],runtime[50],runtime[55],runtime[56],1,4,2,'a'],[[0,1,0]],[[0,0]]]),
            "¯2(⌽≡↑»⊢)'a'+⥊⟜(↕×´)4‿2"                              :(1, [[0,12,0,13,11,2,0,9,0,1,26,0,6,20,0,10,0,4,27,16,0,0,0,14,17,0,3,0,7,0,5,21,0,2,0,8,21,0,11,17,7],[runtime[0],runtime[2],runtime[18],runtime[21],runtime[22],runtime[26],runtime[28],runtime[30],runtime[31],runtime[50],runtime[56],-2,4,2,'a'],[[0,1,0]],[[0,0]]]),
            '6(↑≡»⟜(⥊⟜0)˜)↕4'                                      :(1, [[0,9,0,3,16,0,5,0,8,0,6,0,1,27,0,6,0,4,27,26,0,0,0,2,21,0,7,17,7],[runtime[18],runtime[22],runtime[26],runtime[28],runtime[30],runtime[45],runtime[56],6,0,4],[[0,1,0]],[[0,0]]]),
            '«˜⊸≡2‿3⥊"abcdef"'                                     :(1, [[0,7,0,1,0,5,0,6,11,2,17,0,0,0,4,0,3,0,2,26,27,16,7],[runtime[18],runtime[22],runtime[29],runtime[45],runtime[55],2,3,bqnstr("abcdef")],[[0,1,0]],[[0,0]]]),
            '(»≡0⌈-⟜1)↕6'                                          :(1, [[0,8,0,3,16,0,7,0,5,0,0,27,0,1,0,6,21,0,2,0,4,21,16,7],[runtime[1],runtime[7],runtime[18],runtime[28],runtime[30],runtime[56],0,1,6],[[0,1,0]],[[0,0]]]),
            '(«≡1⊸⌽)↕6'                                            :(1, [[0,6,0,1,16,0,3,0,4,0,5,27,0,0,0,2,21,16,7],[runtime[18],runtime[28],runtime[29],runtime[31],runtime[55],1,6],[[0,1,0]],[[0,0]]]),
            '(»≡0⌈-⟜2)⥊⟜(↕×´)5‿2'                                  :(1, [[0,11,0,10,11,2,0,7,0,1,26,0,5,20,0,8,0,4,27,16,0,10,0,8,0,0,27,0,2,0,9,21,0,3,0,6,21,16,7],[runtime[1],runtime[2],runtime[7],runtime[18],runtime[22],runtime[28],runtime[30],runtime[50],runtime[56],0,2,5],[[0,1,0]],[[0,0]]]),
            '(«≡1⌽1⊸<⊸×)⥊⟜(↕×´)5‿2'                                :(1, [[0,11,0,12,11,2,0,7,0,0,26,0,4,20,0,9,0,3,27,16,0,0,0,8,0,1,0,8,0,10,27,27,0,6,0,10,21,0,2,0,5,21,16,7],[runtime[2],runtime[12],runtime[18],runtime[22],runtime[28],runtime[29],runtime[31],runtime[50],runtime[55],runtime[56],1,5,2],[[0,1,0]],[[0,0]]]),
            "⌽'a'"                                                 :(BQNError, [[0,1,0,0,16,7],[runtime[31],'a'],[[0,1,0]],[[0,0]]]),
            '⌽<∞'                                                  :(BQNError, [[0,2,0,0,16,0,1,16,7],[runtime[12],runtime[31],math.inf],[[0,1,0]],[[0,0]]]),
            '≡⟜⌽⟨⟩'                                                :(1, [[11,0,0,1,0,2,0,0,27,16,7],[runtime[18],runtime[31],runtime[56]],[[0,1,0]],[[0,0]]]),
            '≡⟜⌽"a"'                                               :(1, [[0,3,0,1,0,2,0,0,27,16,7],[runtime[18],runtime[31],runtime[56],bqnstr("a")],[[0,1,0]],[[0,0]]]),
            '"ba"≡⟜⌽"ab"'                                          :(1, [[0,4,0,1,0,2,0,0,27,0,3,17,7],[runtime[18],runtime[31],runtime[56],bqnstr("ba"),bqnstr("ab")],[[0,1,0]],[[0,0]]]),
            '(⌽≡(1-˜≠)(-○⊑∾1↓⊢)⚇1⊢)↕3‿2‿4'                         :(1, [[0,13,0,14,0,15,11,3,0,6,16,0,3,0,12,0,11,0,3,0,5,0,12,21,0,4,0,8,0,10,0,0,27,21,27,0,1,0,9,0,0,26,0,12,21,21,0,2,0,7,21,16,7],[runtime[1],runtime[14],runtime[18],runtime[21],runtime[23],runtime[27],runtime[28],runtime[31],runtime[37],runtime[45],runtime[54],runtime[61],1,3,2,4],[[0,1,0]],[[0,0]]]),
            '≡⟜⌽↕↕3'                                               :(1, [[0,4,0,1,16,0,1,16,0,2,0,3,0,0,27,16,7],[runtime[18],runtime[28],runtime[31],runtime[56],3],[[0,1,0]],[[0,0]]]),
            "2⌽'a'"                                                :(BQNError, [[0,2,0,0,0,1,17,7],[runtime[31],2,'a'],[[0,1,0]],[[0,0]]]),
            '1‿2⌽↕4'                                               :(BQNError, [[0,4,0,0,16,0,1,0,2,0,3,11,2,17,7],[runtime[28],runtime[31],1,2,4],[[0,1,0]],[[0,0]]]),
            '⌽‿2⌽3+⌜○↕4'                                           :(BQNError, [[0,7,0,1,0,4,0,3,0,0,26,27,0,6,17,0,2,0,2,0,5,11,2,17,7],[runtime[0],runtime[28],runtime[31],runtime[48],runtime[54],2,3,4],[[0,1,0]],[[0,0]]]),
            '(<<3)⌽↕4'                                             :(BQNError, [[0,4,0,1,16,0,2,0,3,0,0,16,0,0,16,17,7],[runtime[12],runtime[28],runtime[31],3,4],[[0,1,0]],[[0,0]]]),
            '∧´5(⌽≡⊢)¨⟨"",⥊∞,↕5,↕0‿4,2‿0‿3⥊""⟩'                    :(1, [[0,14,0,9,0,3,16,0,8,0,4,16,0,10,0,11,11,2,0,4,16,0,14,0,3,0,12,0,10,0,13,11,3,17,11,5,0,6,0,2,0,1,0,5,21,26,0,8,17,0,7,0,0,26,16,7],[runtime[10],runtime[18],runtime[21],runtime[22],runtime[28],runtime[31],runtime[47],runtime[50],5,math.inf,0,4,2,3,bqnstr("")],[[0,1,0]],[[0,0]]]),
            '∧´("bcdea"≡⌽⟜"abcde")¨1+5×¯10‿¯2‿¯1‿0‿1‿6‿61'         :(1, [[0,10,0,11,0,12,0,13,0,8,0,14,0,15,11,7,0,1,0,9,17,0,0,0,8,17,0,5,0,17,0,7,0,4,27,0,3,0,16,21,26,16,0,6,0,2,26,16,7],[runtime[0],runtime[2],runtime[10],runtime[18],runtime[31],runtime[47],runtime[50],runtime[56],1,5,-10,-2,-1,0,6,61,bqnstr("bcdea"),bqnstr("abcde")],[[0,1,0]],[[0,0]]]),
            '∧´⟨1,0‿2,¯1‿1‿3⟩(⊑∘⌽≡(3⊸↑)⊸⊑)⚇¯1‿∞ 2‿3‿5⥊"abcdef"'    :(1, [[0,17,0,2,0,12,0,14,0,16,11,3,17,0,13,0,15,11,2,0,9,0,5,0,8,0,3,0,8,0,14,27,27,0,1,0,4,0,7,0,5,27,21,27,0,10,0,11,0,12,11,2,0,13,0,10,0,14,11,3,11,3,17,0,6,0,0,26,16,7],[runtime[10],runtime[18],runtime[22],runtime[26],runtime[31],runtime[37],runtime[50],runtime[53],runtime[55],runtime[61],1,0,2,-1,3,math.inf,5,bqnstr("abcdef")],[[0,1,0]],[[0,0]]]),
            "(⟨⟩⊸⌽≡<)'a'"                                          :(1, [[0,4,0,0,0,1,0,2,0,3,11,0,27,21,16,7],[runtime[12],runtime[18],runtime[31],runtime[55],'a'],[[0,1,0]],[[0,0]]]),
            '/2'                                                   :(BQNError, [[0,1,0,0,16,7],[runtime[33],2],[[0,1,0]],[[0,0]]]),
            '/1‿¯1‿0'                                              :(BQNError, [[0,1,0,2,0,3,11,3,0,0,16,7],[runtime[33],1,-1,0],[[0,1,0]],[[0,0]]]),
            '/=⌜˜↕2'                                               :(BQNError, [[0,5,0,1,16,0,3,0,4,0,0,26,26,16,0,2,16,7],[runtime[15],runtime[28],runtime[33],runtime[45],runtime[48],2],[[0,1,0]],[[0,0]]]),
            '0‿4≡/1‿0‿0‿0‿1‿0'                                     :(1, [[0,4,0,2,0,2,0,2,0,4,0,2,11,6,0,1,16,0,0,0,2,0,3,11,2,17,7],[runtime[18],runtime[33],0,4,1],[[0,1,0]],[[0,0]]]),
            '1‿1‿2≡/0‿2‿1'                                         :(1, [[0,4,0,3,0,2,11,3,0,1,16,0,0,0,2,0,2,0,3,11,3,17,7],[runtime[18],runtime[33],1,2,0],[[0,1,0]],[[0,0]]]),
            '≡⟜/⟨⟩'                                                :(1, [[11,0,0,1,0,2,0,0,27,16,7],[runtime[18],runtime[33],runtime[56]],[[0,1,0]],[[0,0]]]),
            '2/<2'                                                 :(BQNError, [[0,2,0,0,16,0,1,0,2,17,7],[runtime[12],runtime[33],2],[[0,1,0]],[[0,0]]]),
            '0‿1/"abc"'                                            :(BQNError, [[0,3,0,0,0,1,0,2,11,2,17,7],[runtime[33],0,1,bqnstr("abc")],[[0,1,0]],[[0,0]]]),
            '⟨↕3,↕3⟩/"abc"'                                        :(BQNError, [[0,3,0,1,0,2,0,0,16,0,2,0,0,16,11,2,17,7],[runtime[28],runtime[33],3,bqnstr("abc")],[[0,1,0]],[[0,0]]]),
            '1‿2/○≍"ab"'                                           :(BQNError, [[0,5,0,0,0,2,0,1,27,0,3,0,4,11,2,17,7],[runtime[24],runtime[33],runtime[54],1,2,bqnstr("ab")],[[0,1,0]],[[0,0]]]),
            '¯1‿2/"ab"'                                            :(BQNError, [[0,3,0,0,0,1,0,2,11,2,17,7],[runtime[33],-1,2,bqnstr("ab")],[[0,1,0]],[[0,0]]]),
            '"aabbcc"≡2/"abc"'                                     :(1, [[0,4,0,1,0,2,17,0,0,0,3,17,7],[runtime[18],runtime[33],2,bqnstr("aabbcc"),bqnstr("abc")],[[0,1,0]],[[0,0]]]),
            '""≡4/""'                                              :(1, [[0,3,0,1,0,2,17,0,0,0,3,17,7],[runtime[18],runtime[33],4,bqnstr("")],[[0,1,0]],[[0,0]]]),
            '(6‿0⥊"")≡⟨5,1⟩‿⟨⟩/2‿0⥊""'                             :(1, [[0,8,0,1,0,7,0,4,11,2,17,0,2,0,5,0,6,11,2,11,0,11,2,17,0,0,0,8,0,1,0,3,0,4,11,2,17,17,7],[runtime[18],runtime[22],runtime[33],6,0,5,1,2,bqnstr("")],[[0,1,0]],[[0,0]]]),
            '3‿3‿3‿2‿2‿1≡/˜3‿2‿1'                                  :(1, [[0,3,0,4,0,5,11,3,0,2,0,1,26,16,0,0,0,3,0,3,0,3,0,4,0,4,0,5,11,6,17,7],[runtime[18],runtime[33],runtime[45],3,2,1],[[0,1,0]],[[0,0]]]),
            '3‿3‿3‿2‿2‿1≡<⊸/3‿2‿1'                                 :(1, [[0,4,0,5,0,6,11,3,0,2,0,3,0,0,27,16,0,1,0,4,0,4,0,4,0,5,0,5,0,6,11,6,17,7],[runtime[12],runtime[18],runtime[33],runtime[55],3,2,1],[[0,1,0]],[[0,0]]]),
            '(≍1∾¨1‿2‿2)≡(↕¨/↕)2‿3'                                :(1, [[0,7,0,8,11,2,0,3,0,4,0,5,0,3,26,21,16,0,0,0,6,0,7,0,7,11,3,0,5,0,1,26,0,6,17,0,2,16,17,7],[runtime[18],runtime[23],runtime[24],runtime[28],runtime[33],runtime[47],1,2,3],[[0,1,0]],[[0,0]]]),
            "(⟨⟩⊸/≡<)'a'"                                          :(1, [[0,4,0,0,0,1,0,2,0,3,11,0,27,21,16,7],[runtime[12],runtime[18],runtime[33],runtime[55],'a'],[[0,1,0]],[[0,0]]]),
            '⟨⟩(/≡⊢)↕10'                                           :(1, [[0,4,0,2,16,0,1,0,0,0,3,21,11,0,17,7],[runtime[18],runtime[21],runtime[28],runtime[33],10],[[0,1,0]],[[0,0]]]),
            '⟨⟩(/≡⊢)≍"ab"'                                         :(1, [[0,4,0,2,16,0,1,0,0,0,3,21,11,0,17,7],[runtime[18],runtime[21],runtime[24],runtime[33],bqnstr("ab")],[[0,1,0]],[[0,0]]]),
            "⟨2,<3⟩(/≡⥊˜¨⟜≢/⊢)'a'+4‿2⥊↕8"                          :(1, [[0,14,0,6,16,0,5,0,13,0,11,11,2,17,0,0,0,15,17,0,4,0,7,0,3,0,10,0,9,0,8,0,5,26,26,27,21,0,2,0,7,21,0,11,0,12,0,1,16,11,2,17,7],[runtime[0],runtime[12],runtime[18],runtime[19],runtime[21],runtime[22],runtime[28],runtime[33],runtime[45],runtime[47],runtime[56],2,3,4,8,'a'],[[0,1,0]],[[0,0]]]),
        })
        # fmt: on

    def test_layer6(self):
        runtime = self.runtime
        # fmt: off
        self.runcases({
            "∾'c'"                                                                             :(BQNError, [[0,1,0,0,16,7],[runtime[23],'c'],[[0,1,0]],[[0,0]]]),
            '≡⟜(∾⥊¨)"abc"'                                                                     :(1, [[0,5,0,3,0,1,26,0,2,20,0,4,0,0,27,16,7],[runtime[18],runtime[22],runtime[23],runtime[47],runtime[56],bqnstr("abc")],[[0,1,0]],[[0,0]]]),
            '(∾´≡∾)"ab"‿"cde"‿""'                                                              :(1, [[0,3,0,4,0,5,11,3,0,1,0,0,0,2,0,1,26,21,16,7],[runtime[18],runtime[23],runtime[50],bqnstr("ab"),bqnstr("cde"),bqnstr("")],[[0,1,0]],[[0,0]]]),
            '∾"abc"'                                                                           :(BQNError, [[0,1,0,0,16,7],[runtime[23],bqnstr("abc")],[[0,1,0]],[[0,0]]]),
            '∾≍"ab"‿"cde"‿""'                                                                  :(BQNError, [[0,2,0,3,0,4,11,3,0,1,16,0,0,16,7],[runtime[23],runtime[24],bqnstr("ab"),bqnstr("cde"),bqnstr("")],[[0,1,0]],[[0,0]]]),
            '"abc"≡∾"ab"‿\'c\'‿""'                                                             :(1, [[0,4,0,2,0,5,11,3,0,1,16,0,0,0,3,17,7],[runtime[18],runtime[23],'c',bqnstr("abc"),bqnstr("ab"),bqnstr("")],[[0,1,0]],[[0,0]]]),
            '1‿2‿3‿4‿6‿9≡∾(⊢×≠↑↓)1+↕3'                                                         :(1, [[0,11,0,8,16,0,0,0,9,17,0,7,0,6,0,2,21,0,1,0,4,21,16,0,5,16,0,3,0,9,0,10,0,11,0,12,0,13,0,14,11,6,17,7],[runtime[0],runtime[2],runtime[14],runtime[18],runtime[21],runtime[23],runtime[26],runtime[27],runtime[28],1,2,3,4,6,9],[[0,1,0]],[[0,0]]]),
            '(≡⟜∾∧≡⟜(∾<))<4'                                                                   :(1, [[0,5,0,1,16,0,1,0,3,20,0,4,0,2,27,0,0,0,3,0,4,0,2,27,21,16,7],[runtime[10],runtime[12],runtime[18],runtime[23],runtime[56],4],[[0,1,0]],[[0,0]]]),
            '⟨1‿4,⥊2⟩((∾⋆⌜⌜)≡⋆⌜○∾)⟨2‿3‿4,⟨⟩,⥊5⟩'                                               :(1, [[0,8,0,9,0,7,11,3,11,0,0,10,0,2,16,11,3,0,3,0,5,0,4,0,0,26,27,0,1,0,4,0,4,0,0,26,26,0,3,20,21,0,6,0,7,11,2,0,8,0,2,16,11,2,17,7],[runtime[4],runtime[18],runtime[22],runtime[23],runtime[48],runtime[54],1,4,2,3,5],[[0,1,0]],[[0,0]]]),
            '(6‿3⥊0)≡∾⟨2‿3,3,3‿3⟩⥊¨0'                                                          :(1, [[0,6,0,3,0,1,26,0,7,0,5,11,2,0,5,0,5,0,5,11,2,11,3,17,0,2,16,0,0,0,6,0,1,0,4,0,5,11,2,17,17,7],[runtime[18],runtime[22],runtime[23],runtime[47],6,3,0,2],[[0,1,0]],[[0,0]]]),
            '∾⟨3,3,4,4‿3⟩⥊¨0'                                                                  :(BQNError, [[0,5,0,2,0,0,26,0,3,0,3,0,4,0,4,0,3,11,2,11,4,17,0,1,16,7],[runtime[22],runtime[23],runtime[47],3,4,0],[[0,1,0]],[[0,0]]]),
            '∾⟨2‿3,1‿3,2‿2⟩⥊¨0'                                                                :(BQNError, [[0,6,0,2,0,0,26,0,3,0,4,11,2,0,5,0,4,11,2,0,3,0,3,11,2,11,3,17,0,1,16,7],[runtime[22],runtime[23],runtime[47],2,3,1,0],[[0,1,0]],[[0,0]]]),
            '"abcd"≡"abc"∾\'d\''                                                               :(1, [[0,2,0,1,0,4,17,0,0,0,3,17,7],[runtime[18],runtime[23],'d',bqnstr("abcd"),bqnstr("abc")],[[0,1,0]],[[0,0]]]),
            '"abcd"≡"abc"∾<\'d\''                                                              :(1, [[0,3,0,0,16,0,2,0,5,17,0,1,0,4,17,7],[runtime[12],runtime[18],runtime[23],'d',bqnstr("abcd"),bqnstr("abc")],[[0,1,0]],[[0,0]]]),
            '(↕4‿3)≡(↕3‿3)∾3∾¨↕3'                                                              :(1, [[0,5,0,2,16,0,3,0,1,26,0,5,17,0,1,0,5,0,5,11,2,0,2,16,17,0,0,0,4,0,5,11,2,0,2,16,17,7],[runtime[18],runtime[23],runtime[28],runtime[47],4,3],[[0,1,0]],[[0,0]]]),
            '(∾˜≡·¯1⊸(×´∘↓∾↑)∘≢⊸⥊≍˜)2‿3⥊"abcdef"'                                              :(1, [[0,15,0,3,0,13,0,14,11,2,17,0,8,0,5,26,0,3,0,11,0,2,0,10,0,6,0,4,0,7,0,10,0,9,0,0,26,27,21,0,11,0,12,27,27,27,20,0,1,0,8,0,4,26,21,16,7],[runtime[2],runtime[18],runtime[19],runtime[22],runtime[23],runtime[24],runtime[26],runtime[27],runtime[45],runtime[50],runtime[53],runtime[55],-1,2,3,bqnstr("abcdef")],[[0,1,0]],[[0,0]]]),
            '(∾´≡∾)⟨3‿2‿1,0‿2‿1⟩⥊¨<↕6'                                                         :(1, [[0,11,0,4,16,0,0,16,0,5,0,2,26,0,7,0,8,0,9,11,3,0,10,0,8,0,9,11,3,11,2,17,0,3,0,1,0,6,0,3,26,21,16,7],[runtime[12],runtime[18],runtime[22],runtime[23],runtime[28],runtime[47],runtime[50],3,2,1,0,6],[[0,1,0]],[[0,0]]]),
            '\'a\'∾≍"abc"'                                                                     :(BQNError, [[0,3,0,1,16,0,0,0,2,17,7],[runtime[23],runtime[24],'a',bqnstr("abc")],[[0,1,0]],[[0,0]]]),
            '"ab"∾○≍"cde"'                                                                     :(BQNError, [[0,4,0,1,0,2,0,0,27,0,3,17,7],[runtime[23],runtime[24],runtime[54],bqnstr("ab"),bqnstr("cde")],[[0,1,0]],[[0,0]]]),
            '(2‿3⥊↕6)∾↕2'                                                                      :(BQNError, [[0,3,0,2,16,0,1,0,5,0,2,16,0,0,0,3,0,4,11,2,17,17,7],[runtime[22],runtime[23],runtime[28],2,3,6],[[0,1,0]],[[0,0]]]),
            '⟨1‿2,⥊0,⥊3⟩≡⊔1‿0‿0‿2'                                                             :(1, [[0,3,0,5,0,5,0,4,11,4,0,2,16,0,0,0,3,0,4,11,2,0,5,0,1,16,0,6,0,1,16,11,3,17,7],[runtime[18],runtime[22],runtime[42],1,2,0,3],[[0,1,0]],[[0,0]]]),
            '⟨⟩≡⊔5⥊¯1'                                                                         :(1, [[0,4,0,1,0,3,17,0,2,16,0,0,11,0,17,7],[runtime[18],runtime[22],runtime[42],5,-1],[[0,1,0]],[[0,0]]]),
            '≡⟜⊔⟨⟩'                                                                            :(1, [[11,0,0,1,0,2,0,0,27,16,7],[runtime[18],runtime[42],runtime[56]],[[0,1,0]],[[0,0]]]),
            '⊔3'                                                                               :(BQNError, [[0,1,0,0,16,7],[runtime[42],3],[[0,1,0]],[[0,0]]]),
            '⊔<3'                                                                              :(BQNError, [[0,2,0,0,16,0,1,16,7],[runtime[12],runtime[42],3],[[0,1,0]],[[0,0]]]),
            '⊔≍↕3'                                                                             :(BQNError, [[0,3,0,1,16,0,0,16,0,2,16,7],[runtime[24],runtime[28],runtime[42],3],[[0,1,0]],[[0,0]]]),
            '⊔1.5‿0‿2'                                                                         :(BQNError, [[0,1,0,2,0,3,11,3,0,0,16,7],[runtime[42],1.5,0,2],[[0,1,0]],[[0,0]]]),
            '⊔1‿¯2'                                                                            :(BQNError, [[0,1,0,2,11,2,0,0,16,7],[runtime[42],1,-2],[[0,1,0]],[[0,0]]]),
            '(⊔≡⥊¨¨∘⊔∘⊑)⟨1‿0‿0‿2⟩'                                                             :(1, [[0,6,0,7,0,7,0,8,11,4,11,1,0,2,0,5,0,3,0,5,0,4,0,4,0,1,26,26,27,27,0,0,0,3,21,16,7],[runtime[18],runtime[22],runtime[37],runtime[42],runtime[47],runtime[53],1,0,2],[[0,1,0]],[[0,0]]]),
            '(≍⍟2∘<¨⌽↕3‿2)≡⊔⟨2‿1‿0,0‿1⟩'                                                       :(1, [[0,9,0,11,0,12,11,3,0,12,0,11,11,2,11,2,0,5,16,0,1,0,10,0,9,11,2,0,3,16,0,4,16,0,6,0,0,0,7,0,9,0,8,0,2,27,27,26,16,17,7],[runtime[12],runtime[18],runtime[24],runtime[28],runtime[31],runtime[42],runtime[47],runtime[53],runtime[62],2,3,1,0],[[0,1,0]],[[0,0]]]),
            '(↕0‿0)≡⊔⟨⟩‿⟨⟩'                                                                    :(1, [[11,0,11,0,11,2,0,2,16,0,0,0,3,0,3,11,2,0,1,16,17,7],[runtime[18],runtime[28],runtime[42],0],[[0,1,0]],[[0,0]]]),
            '(⊔≡·≍⍟2∘<·∾⌜´/∘(0⊸=)¨)⟨0‿¯1‿0‿0,¯1‿0‿0⟩'                                          :(1, [[0,14,0,15,0,14,0,14,11,4,0,15,0,14,0,14,11,3,11,2,0,7,0,1,0,11,0,14,27,0,10,0,5,27,26,0,9,0,8,0,3,26,26,20,0,0,0,10,0,13,0,12,0,4,27,27,20,0,2,0,6,21,16,7],[runtime[12],runtime[15],runtime[18],runtime[23],runtime[24],runtime[33],runtime[42],runtime[47],runtime[48],runtime[50],runtime[53],runtime[55],runtime[62],2,0,-1],[[0,1,0]],[[0,0]]]),
            '(0‿0‿1↑⌜≍⍟2∘<∘⥊¨1‿0)≡⊔⟨2,1‿0⟩'                                                    :(1, [[0,12,0,11,0,10,11,2,11,2,0,5,16,0,1,0,11,0,10,11,2,0,6,0,2,0,8,0,0,0,8,0,12,0,9,0,3,27,27,27,26,16,0,7,0,4,26,0,10,0,10,0,11,11,3,17,17,7],[runtime[12],runtime[18],runtime[22],runtime[24],runtime[26],runtime[42],runtime[47],runtime[48],runtime[53],runtime[62],0,1,2],[[0,1,0]],[[0,0]]]),
            '(0‿0‿1↑⌜≍⍟2∘(<0‿0‿0⊸∾)¨1‿0)≡⊔0‿0⊸↓¨⟨2,1‿0⟩'                                       :(1, [[0,14,0,13,0,12,11,2,11,2,0,7,0,5,0,10,0,12,0,12,11,2,27,26,16,0,6,16,0,1,0,13,0,12,11,2,0,7,0,2,0,10,0,12,0,12,0,12,11,3,27,0,0,20,0,9,0,14,0,11,0,3,27,27,26,16,0,8,0,4,26,0,12,0,12,0,13,11,3,17,17,7],[runtime[12],runtime[18],runtime[23],runtime[24],runtime[26],runtime[27],runtime[42],runtime[47],runtime[48],runtime[53],runtime[55],runtime[62],0,1,2],[[0,1,0]],[[0,0]]]),
            '4‿3‿2(⋈≡·(≠¨⋈∾)/⊸⊔)"abcdefghi"'                                                   :(1, [[0,11,0,5,0,7,0,4,27,0,2,0,3,0,6,0,0,26,21,20,0,1,0,3,21,0,8,0,9,0,10,11,3,17,7],[runtime[14],runtime[18],runtime[23],runtime[25],runtime[33],runtime[42],runtime[47],runtime[55],4,3,2,bqnstr("abcdefghi")],[[0,1,0]],[[0,0]]]),
            '⟨⟩≡(3⥊¯1)⊔"abc"'                                                                  :(1, [[0,5,0,2,0,4,0,1,0,3,17,17,0,0,11,0,17,7],[runtime[18],runtime[22],runtime[42],3,-1,bqnstr("abc")],[[0,1,0]],[[0,0]]]),
            '⟨⟩≡(2⥊¯1)⊔"a"'                                                                    :(1, [[0,5,0,2,0,4,0,1,0,3,17,17,0,0,11,0,17,7],[runtime[18],runtime[22],runtime[42],2,-1,bqnstr("a")],[[0,1,0]],[[0,0]]]),
            '⟨⟩≡⟨¯1⟩⊔""'                                                                       :(1, [[0,3,0,1,0,2,11,1,17,0,0,11,0,17,7],[runtime[18],runtime[42],-1,bqnstr("")],[[0,1,0]],[[0,0]]]),
            "⊔˜'a'‿1‿0"                                                                        :(BQNError, [[0,4,0,2,0,3,11,3,0,1,0,0,26,16,7],[runtime[42],runtime[45],1,0,'a'],[[0,1,0]],[[0,0]]]),
            '4⊔○↕2'                                                                            :(BQNError, [[0,4,0,0,0,2,0,1,27,0,3,17,7],[runtime[28],runtime[42],runtime[54],4,2],[[0,1,0]],[[0,0]]]),
            '(≍˘1‿1‿4<∘⥊⎉1 16‿4+⌜↕4)≡2↓⟨3‿2,¯1‿0‿¯1⟩⊔2‿3‿4⥊↕24'                                :(1, [[0,19,0,6,16,0,3,0,15,0,16,0,13,11,3,17,0,7,0,16,0,15,11,2,0,17,0,18,0,17,11,3,11,2,17,0,5,0,15,17,0,2,0,13,0,6,16,0,9,0,0,26,0,14,0,13,11,2,17,0,12,0,11,0,3,0,10,0,1,27,27,0,12,0,12,0,13,11,3,17,0,8,0,4,26,16,17,7],[runtime[0],runtime[12],runtime[18],runtime[22],runtime[24],runtime[27],runtime[28],runtime[42],runtime[46],runtime[48],runtime[53],runtime[60],1,4,16,2,3,-1,0,24],[[0,1,0]],[[0,0]]]),
            '⥊⚇0⊸≡○⊔⟜(⥊<)1‿2‿2‿¯1‿0'                                                           :(1, [[0,9,0,10,0,10,0,11,0,8,11,5,0,0,0,2,20,0,6,0,3,0,4,0,1,0,5,0,8,0,7,0,2,27,27,27,27,16,7],[runtime[12],runtime[18],runtime[22],runtime[42],runtime[54],runtime[55],runtime[56],runtime[61],0,1,2,-1],[[0,1,0]],[[0,0]]]),
            '(∾↕¨∘≢⊸⊔)⊸≡ 3‿2‿4⥊↕24'                                                            :(1, [[0,12,0,4,16,0,2,0,9,0,10,0,11,11,3,17,0,0,0,8,0,5,0,8,0,1,0,7,0,6,0,4,26,27,27,0,3,20,27,16,7],[runtime[18],runtime[19],runtime[22],runtime[23],runtime[28],runtime[42],runtime[47],runtime[53],runtime[55],3,2,4,24],[[0,1,0]],[[0,0]]]),
            '-⟜\'a\'⊸(⊔≡⊔○⥊)"acc"≍"bac"'                                                       :(1, [[0,10,0,3,0,9,17,0,2,0,5,0,4,27,0,1,0,4,21,0,6,0,8,0,7,0,0,27,27,16,7],[runtime[1],runtime[18],runtime[22],runtime[24],runtime[42],runtime[54],runtime[55],runtime[56],'a',bqnstr("acc"),bqnstr("bac")],[[0,1,0]],[[0,0]]]),
            '(2‿1/⟨↕0‿1,1‿1⥊3⟩)≡2⊔⥊3'                                                          :(1, [[0,8,0,1,16,0,4,0,5,17,0,0,0,7,0,6,11,2,0,2,16,0,8,0,1,0,6,0,6,11,2,17,11,2,0,3,0,5,0,6,11,2,17,17,7],[runtime[18],runtime[22],runtime[28],runtime[33],runtime[42],2,1,0,3],[[0,1,0]],[[0,0]]]),
            '((<=·↕1⊸+)≡·≢¨<¨⊸⊔⟜(<@))2‿1‿3'                                                    :(1, [[0,11,0,10,0,12,11,3,0,13,0,1,16,0,9,0,6,0,8,0,7,0,1,26,27,27,0,7,0,4,26,20,0,3,0,0,0,8,0,10,27,0,5,20,0,2,0,1,21,21,16,7],[runtime[0],runtime[12],runtime[15],runtime[18],runtime[19],runtime[28],runtime[42],runtime[47],runtime[55],runtime[56],1,2,3,'\0'],[[0,1,0]],[[0,0]]]),
            '⟨1‿2,3‿1⟩⊔2‿3⥊0'                                                                  :(BQNError, [[0,5,0,0,0,3,0,4,11,2,17,0,1,0,2,0,3,11,2,0,4,0,2,11,2,11,2,17,7],[runtime[22],runtime[42],1,2,3,0],[[0,1,0]],[[0,0]]]),
            '⟨1‿2,3‿4‿5,6‿7⟩⊔2‿3⥊0'                                                            :(BQNError, [[0,9,0,0,0,3,0,4,11,2,17,0,1,0,2,0,3,11,2,0,4,0,5,0,6,11,3,0,7,0,8,11,2,11,3,17,7],[runtime[22],runtime[42],1,2,3,4,5,6,7,0],[[0,1,0]],[[0,0]]]),
            '≍⊸⊔≍˘↕3'                                                                          :(BQNError, [[0,5,0,1,16,0,3,0,0,26,16,0,2,0,4,0,0,27,16,7],[runtime[24],runtime[28],runtime[42],runtime[46],runtime[55],3],[[0,1,0]],[[0,0]]]),
            '⟨⟨<3,2⟩,¯1‿0‿¯1⟩⊔2‿3‿4⥊↕24'                                                       :(BQNError, [[0,9,0,2,16,0,1,0,5,0,4,0,8,11,3,17,0,3,0,4,0,0,16,0,5,11,2,0,6,0,7,0,6,11,3,11,2,17,7],[runtime[12],runtime[22],runtime[28],runtime[42],3,2,-1,0,4,24],[[0,1,0]],[[0,0]]]),
            '(1‿3/⟨"a",""⟩)≡0‿¯1‿4⊔"ab"'                                                       :(1, [[0,10,0,2,0,5,0,6,0,7,11,3,17,0,0,0,8,0,9,11,2,0,1,0,3,0,4,11,2,17,17,7],[runtime[18],runtime[33],runtime[42],1,3,0,-1,4,bqnstr("a"),bqnstr(""),bqnstr("ab")],[[0,1,0]],[[0,0]]]),
            '¯1⊸↓⊸(≡○(⊔⟜"ab"))2‿3‿1'                                                           :(1, [[0,7,0,8,0,9,11,3,0,10,0,5,0,2,27,0,3,0,0,27,0,4,0,1,0,4,0,6,27,27,16,7],[runtime[18],runtime[27],runtime[42],runtime[54],runtime[55],runtime[56],-1,2,3,1,bqnstr("ab")],[[0,1,0]],[[0,0]]]),
            '(≍1‿1‿0≍∘/⟜≍¨"bac")≡⟨0,1‿0‿3⟩⊔"ab"'                                               :(1, [[0,11,0,3,0,8,0,7,0,8,0,9,11,3,11,2,17,0,0,0,10,0,4,0,1,0,6,0,2,0,5,0,1,27,27,26,0,7,0,7,0,8,11,3,17,0,1,16,17,7],[runtime[18],runtime[24],runtime[33],runtime[42],runtime[47],runtime[53],runtime[56],1,0,3,bqnstr("bac"),bqnstr("ab")],[[0,1,0]],[[0,0]]]),
            '(⌽˘≡·∾⟨2‿2,1‿0‿1⟩⊸⊔)"ab"≍"cd"'                                                    :(1, [[0,11,0,2,0,10,17,0,4,0,6,0,7,0,7,11,2,0,8,0,9,0,8,11,3,11,2,27,0,1,20,0,0,0,5,0,3,26,21,16,7],[runtime[18],runtime[23],runtime[24],runtime[31],runtime[42],runtime[46],runtime[55],2,1,0,bqnstr("ab"),bqnstr("cd")],[[0,1,0]],[[0,0]]]),
            '(2‿3⥊↕4)⊔↕2‿2'                                                                    :(BQNError, [[0,3,0,3,11,2,0,1,16,0,2,0,5,0,1,16,0,0,0,3,0,4,11,2,17,17,7],[runtime[22],runtime[28],runtime[42],2,3,4],[[0,1,0]],[[0,0]]]),
            '(3‿3⥊↕4)⊔↕2‿2'                                                                    :(BQNError, [[0,5,0,5,11,2,0,1,16,0,2,0,4,0,1,16,0,0,0,3,0,3,11,2,17,17,7],[runtime[22],runtime[28],runtime[42],3,4,2],[[0,1,0]],[[0,0]]]),
            "⊐˜'a'"                                                                            :(BQNError, [[0,2,0,1,0,0,26,16,7],[runtime[38],runtime[45],'a'],[[0,1,0]],[[0,0]]]),
            '⊏⊸⊐"abc"'                                                                         :(BQNError, [[0,3,0,1,0,2,0,0,27,16,7],[runtime[36],runtime[38],runtime[55],bqnstr("abc")],[[0,1,0]],[[0,0]]]),
            '(3‿2‿4⥊0)⊐4⥊1'                                                                    :(BQNError, [[0,6,0,0,0,4,17,0,1,0,5,0,0,0,2,0,3,0,4,11,3,17,17,7],[runtime[22],runtime[38],3,2,4,0,1],[[0,1,0]],[[0,0]]]),
            '2‿0‿4≡"abcd"⊐"cae"'                                                               :(1, [[0,6,0,1,0,5,17,0,0,0,2,0,3,0,4,11,3,17,7],[runtime[18],runtime[38],2,0,4,bqnstr("abcd"),bqnstr("cae")],[[0,1,0]],[[0,0]]]),
            '⟨1⟩≡"abcd"⊐"b"'                                                                   :(1, [[0,4,0,1,0,3,17,0,0,0,2,11,1,17,7],[runtime[18],runtime[38],1,bqnstr("abcd"),bqnstr("b")],[[0,1,0]],[[0,0]]]),
            '(<2)≡"cdef"⊐\'e\''                                                                :(1, [[0,4,0,2,0,5,17,0,1,0,3,0,0,16,17,7],[runtime[12],runtime[18],runtime[38],2,'e',bqnstr("cdef")],[[0,1,0]],[[0,0]]]),
            '(<3)≡⊐⟜(3⊸⊏)"abcd"'                                                               :(1, [[0,7,0,2,0,4,0,6,27,0,5,0,3,27,16,0,1,0,6,0,0,16,17,7],[runtime[12],runtime[18],runtime[36],runtime[38],runtime[55],runtime[56],3,bqnstr("abcd")],[[0,1,0]],[[0,0]]]),
            '(5⌊3+↕5)≡⊐⟜(3‿0‿0+⚇1⊢)↕5‿2‿1'                                                     :(1, [[0,8,0,12,0,11,11,3,0,4,16,0,3,0,11,0,7,0,0,27,0,9,0,10,0,10,11,3,21,0,6,0,5,27,16,0,2,0,8,0,4,16,0,0,0,9,17,0,1,0,8,17,17,7],[runtime[0],runtime[6],runtime[18],runtime[21],runtime[28],runtime[38],runtime[56],runtime[61],5,3,0,1,2],[[0,1,0]],[[0,0]]]),
            '⊐+˙@'                                                                             :(BQNError, [[0,3,0,2,0,0,26,16,0,1,16,7],[runtime[0],runtime[38],runtime[44],'\0'],[[0,1,0]],[[0,0]]]),
            '0‿0‿1‿0‿2≡⊐"ccacb"'                                                               :(1, [[0,5,0,1,16,0,0,0,2,0,2,0,3,0,2,0,4,11,5,17,7],[runtime[18],runtime[38],0,1,2,bqnstr("ccacb")],[[0,1,0]],[[0,0]]]),
            '0‿0‿1‿0‿2≡⊐≍˜˘"ccacb"'                                                            :(1, [[0,8,0,4,0,3,0,1,26,26,16,0,2,16,0,0,0,5,0,5,0,6,0,5,0,7,11,5,17,7],[runtime[18],runtime[24],runtime[38],runtime[45],runtime[46],0,1,2,bqnstr("ccacb")],[[0,1,0]],[[0,0]]]),
            '≡⟜⊐⟨⟩'                                                                            :(1, [[11,0,0,1,0,2,0,0,27,16,7],[runtime[18],runtime[38],runtime[56]],[[0,1,0]],[[0,0]]]),
            '(↕5)∊1'                                                                           :(BQNError, [[0,3,0,1,0,2,0,0,16,17,7],[runtime[28],runtime[40],5,1],[[0,1,0]],[[0,0]]]),
            '2∊≍˘↕4'                                                                           :(BQNError, [[0,5,0,1,16,0,3,0,0,26,16,0,2,0,4,17,7],[runtime[24],runtime[28],runtime[40],runtime[46],2,4],[[0,1,0]],[[0,0]]]),
            '1‿0‿0‿1≡"acef"∊"adf"'                                                             :(1, [[0,5,0,1,0,4,17,0,0,0,2,0,3,0,3,0,2,11,4,17,7],[runtime[18],runtime[40],1,0,bqnstr("acef"),bqnstr("adf")],[[0,1,0]],[[0,0]]]),
            '(∊⟜(↕2)≡<⟜2)3⋆⌜○↕5'                                                               :(1, [[0,10,0,3,0,6,0,5,0,0,26,27,0,9,17,0,8,0,7,0,1,27,0,2,0,8,0,3,16,0,7,0,4,27,21,16,7],[runtime[4],runtime[12],runtime[18],runtime[28],runtime[40],runtime[48],runtime[54],runtime[56],2,3,5],[[0,1,0]],[[0,0]]]),
            '(<1)≡3‿4‿5∊4+⌜○↕3'                                                                :(1, [[0,8,0,3,0,6,0,5,0,0,26,27,0,9,17,0,4,0,8,0,9,0,10,11,3,17,0,2,0,7,0,1,16,17,7],[runtime[0],runtime[12],runtime[18],runtime[28],runtime[40],runtime[48],runtime[54],1,3,4,5],[[0,1,0]],[[0,0]]]),
            '∊<4'                                                                              :(BQNError, [[0,2,0,0,16,0,1,16,7],[runtime[12],runtime[40],4],[[0,1,0]],[[0,0]]]),
            '(\'0\'≠"11010001")≡∊"abacbacd"'                                                   :(1, [[0,5,0,2,16,0,1,0,4,0,0,0,3,17,17,7],[runtime[14],runtime[18],runtime[40],'0',bqnstr("11010001"),bqnstr("abacbacd")],[[0,1,0]],[[0,0]]]),
            '(↑⟜1≡⟜∊⥊⟜∞)9'                                                                     :(1, [[0,7,0,6,0,4,0,1,27,0,3,0,4,0,0,27,0,5,0,4,0,2,27,21,16,7],[runtime[18],runtime[22],runtime[26],runtime[40],runtime[56],1,math.inf,9],[[0,1,0]],[[0,0]]]),
            '(⥊⟜1≡∊∘↕)6'                                                                       :(1, [[0,7,0,2,0,4,0,3,27,0,0,0,6,0,5,0,1,27,21,16,7],[runtime[18],runtime[22],runtime[28],runtime[40],runtime[53],runtime[56],1,6],[[0,1,0]],[[0,0]]]),
            '≡⟜∊⟨⟩'                                                                            :(1, [[11,0,0,1,0,2,0,0,27,16,7],[runtime[18],runtime[40],runtime[56]],[[0,1,0]],[[0,0]]]),
            '≡○∊⟜(≍˜˘)"abcadbba"'                                                              :(1, [[0,7,0,4,0,3,0,1,26,26,0,6,0,2,0,5,0,0,27,27,16,7],[runtime[18],runtime[24],runtime[40],runtime[45],runtime[46],runtime[54],runtime[56],bqnstr("abcadbba")],[[0,1,0]],[[0,0]]]),
            "⍷'a'"                                                                             :(BQNError, [[0,1,0,0,16,7],[runtime[41],'a'],[[0,1,0]],[[0,0]]]),
            '≡⟜⍷⟨⟩'                                                                            :(1, [[11,0,0,1,0,2,0,0,27,16,7],[runtime[18],runtime[41],runtime[56]],[[0,1,0]],[[0,0]]]),
            '"ba"≡⍷"baa"'                                                                      :(1, [[0,3,0,1,16,0,0,0,2,17,7],[runtime[18],runtime[41],bqnstr("ba"),bqnstr("baa")],[[0,1,0]],[[0,0]]]),
            '≍⊸⍷"abc"'                                                                         :(BQNError, [[0,3,0,1,0,2,0,0,27,16,7],[runtime[24],runtime[41],runtime[55],bqnstr("abc")],[[0,1,0]],[[0,0]]]),
            '0‿1‿0‿0≡"abc"⍷"aabcba"'                                                           :(1, [[0,5,0,1,0,4,17,0,0,0,2,0,3,0,2,0,2,11,4,17,7],[runtime[18],runtime[41],0,1,bqnstr("abc"),bqnstr("aabcba")],[[0,1,0]],[[0,0]]]),
            '(0‿1≍0‿0)≡(1‿2≍4‿5)⍷3‿3⥊↕9'                                                       :(1, [[0,11,0,3,16,0,1,0,10,0,10,11,2,17,0,4,0,8,0,9,11,2,0,2,0,6,0,7,11,2,17,17,0,0,0,5,0,5,11,2,0,2,0,5,0,6,11,2,17,17,7],[runtime[18],runtime[22],runtime[24],runtime[28],runtime[41],0,1,2,4,5,3,9],[[0,1,0]],[[0,0]]]),
            '(↕3‿0)≡⍷⟜(≍˘)"abc"'                                                               :(1, [[0,8,0,4,0,1,26,0,5,0,3,27,16,0,0,0,6,0,7,11,2,0,2,16,17,7],[runtime[18],runtime[24],runtime[28],runtime[41],runtime[46],runtime[56],3,0,bqnstr("abc")],[[0,1,0]],[[0,0]]]),
            '\'a\'(=≡⍷)"abc"'                                                                  :(1, [[0,4,0,2,0,1,0,0,21,0,3,17,7],[runtime[15],runtime[18],runtime[41],'a',bqnstr("abc")],[[0,1,0]],[[0,0]]]),
            '(⌽¨≡⍉)↕2⥊3'                                                                       :(1, [[0,7,0,1,0,6,17,0,2,16,0,4,0,0,0,5,0,3,26,21,16,7],[runtime[18],runtime[22],runtime[28],runtime[31],runtime[32],runtime[47],2,3],[[0,1,0]],[[0,0]]]),
            "(⍉≡<)'a'"                                                                         :(1, [[0,3,0,0,0,1,0,2,21,16,7],[runtime[12],runtime[18],runtime[32],'a'],[[0,1,0]],[[0,0]]]),
            '∧´⍉⊸≡¨⟨<\'a\',"a","abc",""⟩'                                                      :(1, [[0,7,0,1,16,0,8,0,9,0,10,11,4,0,4,0,2,0,6,0,3,27,26,16,0,5,0,0,26,16,7],[runtime[10],runtime[12],runtime[18],runtime[32],runtime[47],runtime[50],runtime[55],'a',bqnstr("a"),bqnstr("abc"),bqnstr("")],[[0,1,0]],[[0,0]]]),
            '(↕4)(-˜⌜˜≡·⍉-⌜)↕3‿2'                                                              :(1, [[0,7,0,8,11,2,0,2,16,0,5,0,0,26,0,3,20,0,1,0,4,0,5,0,4,0,0,26,26,26,21,0,6,0,2,16,17,7],[runtime[1],runtime[18],runtime[28],runtime[32],runtime[45],runtime[48],4,3,2],[[0,1,0]],[[0,0]]]),
            '0‿¯1‿1⍉(3⥊1)⥊1'                                                                   :(BQNError, [[0,4,0,0,0,4,0,0,0,5,17,17,0,1,0,2,0,3,0,4,11,3,17,7],[runtime[22],runtime[32],0,-1,1,3],[[0,1,0]],[[0,0]]]),
            '1‿0≍˘⊸⍉"ab"≍"cd"'                                                                 :(BQNError, [[0,7,0,0,0,6,17,0,1,0,3,0,2,0,0,26,27,0,4,0,5,11,2,17,7],[runtime[24],runtime[32],runtime[46],runtime[55],1,0,bqnstr("ab"),bqnstr("cd")],[[0,1,0]],[[0,0]]]),
            '0‿2⍉+⌜˜↕3'                                                                        :(BQNError, [[0,7,0,1,16,0,3,0,4,0,0,26,26,16,0,2,0,5,0,6,11,2,17,7],[runtime[0],runtime[28],runtime[32],runtime[45],runtime[48],0,2,3],[[0,1,0]],[[0,0]]]),
            '2‿0‿0⍉↕↕3'                                                                        :(BQNError, [[0,4,0,0,16,0,0,16,0,1,0,2,0,3,0,3,11,3,17,7],[runtime[28],runtime[32],2,0,3],[[0,1,0]],[[0,0]]]),
            '3⍉↕↕3'                                                                            :(BQNError, [[0,2,0,0,16,0,0,16,0,1,0,2,17,7],[runtime[28],runtime[32],3],[[0,1,0]],[[0,0]]]),
            '(2×↕3)≡0‿0⍉6+⌜○↕3'                                                                :(1, [[0,8,0,3,0,6,0,5,0,0,26,27,0,10,17,0,4,0,9,0,9,11,2,17,0,2,0,8,0,3,16,0,1,0,7,17,17,7],[runtime[0],runtime[2],runtime[18],runtime[28],runtime[32],runtime[48],runtime[54],2,3,0,6],[[0,1,0]],[[0,0]]]),
            '(⟨⟩⊸⍉≡<)4'                                                                        :(1, [[0,4,0,0,0,1,0,2,0,3,11,0,27,21,16,7],[runtime[12],runtime[18],runtime[32],runtime[55],4],[[0,1,0]],[[0,0]]]),
            '⟨⟩(⍉≡⊢)<4'                                                                        :(1, [[0,4,0,0,16,0,2,0,1,0,3,21,11,0,17,7],[runtime[12],runtime[18],runtime[21],runtime[32],4],[[0,1,0]],[[0,0]]]),
            '(2‿0‿1⥊⟨⟩)≡1‿2‿0‿1⍉↕↕4'                                                           :(1, [[0,7,0,2,16,0,2,16,0,3,0,6,0,4,0,5,0,6,11,4,17,0,0,11,0,0,1,0,4,0,5,0,6,11,3,17,17,7],[runtime[18],runtime[22],runtime[28],runtime[32],2,0,1,4],[[0,1,0]],[[0,0]]]),
            '(↕1‿2‿0‿3)≡2<⊸⍉↕↕4'                                                               :(1, [[0,9,0,2,16,0,2,16,0,3,0,4,0,0,27,0,6,17,0,1,0,5,0,6,0,7,0,8,11,4,0,2,16,17,7],[runtime[12],runtime[18],runtime[28],runtime[32],runtime[55],1,2,0,3,4],[[0,1,0]],[[0,0]]]),
            '0⊸⍉⊸≡2‿3⥊↕6'                                                                      :(1, [[0,8,0,2,16,0,1,0,6,0,7,11,2,17,0,0,0,4,0,3,0,4,0,5,27,27,16,7],[runtime[18],runtime[22],runtime[28],runtime[32],runtime[55],0,2,3,6],[[0,1,0]],[[0,0]]]),
            "⍋'a'"                                                                             :(BQNError, [[0,1,0,0,16,7],[runtime[34],'a'],[[0,1,0]],[[0,0]]]),
            "⍋'a'‿∘"                                                                           :(BQNError, [[0,2,0,1,11,2,0,0,16,7],[runtime[34],runtime[53],'a'],[[0,1,0]],[[0,0]]]),
            '⍒2'                                                                               :(BQNError, [[0,1,0,0,16,7],[runtime[35],2],[[0,1,0]],[[0,0]]]),
            '2‿0‿3‿1‿4≡⍋"bdace"'                                                               :(1, [[0,7,0,1,16,0,0,0,2,0,3,0,4,0,5,0,6,11,5,17,7],[runtime[18],runtime[34],2,0,3,1,4,bqnstr("bdace")],[[0,1,0]],[[0,0]]]),
            '5‿2‿4‿3‿0‿1≡⍋↓"deabb"'                                                            :(1, [[0,9,0,1,16,0,2,16,0,0,0,3,0,4,0,5,0,6,0,7,0,8,11,6,17,7],[runtime[18],runtime[27],runtime[34],5,2,4,3,0,1,bqnstr("deabb")],[[0,1,0]],[[0,0]]]),
            '(⍋≡⍒)⟨"",↕0,0↑<"abc"⟩'                                                            :(1, [[0,7,0,6,0,3,16,0,8,0,0,16,0,2,0,6,17,11,3,0,5,0,1,0,4,21,16,7],[runtime[12],runtime[18],runtime[26],runtime[28],runtime[34],runtime[35],0,bqnstr(""),bqnstr("abc")],[[0,1,0]],[[0,0]]]),
            '(⍋≡↕∘≠)4‿0⥊@'                                                                     :(1, [[0,8,0,2,0,6,0,7,11,2,17,0,0,0,5,0,3,27,0,1,0,4,21,16,7],[runtime[14],runtime[18],runtime[22],runtime[28],runtime[34],runtime[53],4,0,'\0'],[[0,1,0]],[[0,0]]]),
            "(⍒≡⌽∘↕∘≠)⟨¯∞,¯1.5,π,∞,'A','a','b'⟩"                                               :(1, [[0,6,0,7,0,8,0,9,0,10,0,11,0,12,11,7,0,0,0,5,0,2,0,5,0,3,27,27,0,1,0,4,21,16,7],[runtime[14],runtime[18],runtime[28],runtime[31],runtime[35],runtime[53],-math.inf,-1.5,3.141592653589793,math.inf,'A','a','b'],[[0,1,0]],[[0,0]]]),
            '(⍒≡⌽∘↕∘≠)⟨↕0,¯1.1,¯1,¯1‿¯∞,¯1‿0,¯1‿0‿0,¯1‿∞,0,6⥊0,1e¯20,1,1+1e¯15⟩'               :(1, [[0,8,0,4,16,0,9,0,10,0,10,0,11,11,2,0,10,0,8,11,2,0,10,0,8,0,8,11,3,0,10,0,12,11,2,0,8,0,8,0,3,0,13,17,0,14,0,15,0,16,0,0,0,15,17,11,12,0,1,0,7,0,4,0,7,0,5,27,27,0,2,0,6,21,16,7],[runtime[0],runtime[14],runtime[18],runtime[22],runtime[28],runtime[31],runtime[35],runtime[53],0,-1.1,-1,-math.inf,math.inf,6,1e-20,1,1e-15],[[0,1,0]],[[0,0]]]),
            "(⍒≡⌽∘↕∘≠)(<∾⟨↕0,1,1‿1,2‿1‿1,2‿1,2,1‿2,2‿2,3⟩⥊¨<)'a'"                              :(1, [[0,14,0,0,0,8,0,3,26,0,10,0,5,16,0,11,0,11,0,11,11,2,0,12,0,11,0,11,11,3,0,12,0,11,11,2,0,12,0,11,0,12,11,2,0,12,0,12,11,2,0,13,11,9,21,0,4,0,0,21,16,0,1,0,9,0,5,0,9,0,6,27,27,0,2,0,7,21,16,7],[runtime[12],runtime[14],runtime[18],runtime[22],runtime[23],runtime[28],runtime[31],runtime[35],runtime[47],runtime[53],0,1,2,3,'a'],[[0,1,0]],[[0,0]]]),
            "(⍋≡↕∘≠)⥊⍉(↕5)⥊⟜1⊸⥊⌜1‿'b'"                                                         :(1, [[0,11,0,12,11,2,0,6,0,2,0,8,0,11,0,9,0,2,27,27,26,0,10,0,3,16,17,0,4,16,0,2,16,0,0,0,7,0,3,27,0,1,0,5,21,16,7],[runtime[14],runtime[18],runtime[22],runtime[28],runtime[32],runtime[34],runtime[48],runtime[53],runtime[55],runtime[56],5,1,'b'],[[0,1,0]],[[0,0]]]),
            "(⊢≡○⍋(0‿1+≠)⥊⊢)⟨¯2,'a',1,'f'⟩"                                                    :(1, [[0,9,0,10,0,8,0,11,11,4,0,3,0,4,0,1,0,0,0,7,0,8,11,2,21,21,0,5,0,6,0,2,27,0,3,21,16,7],[runtime[0],runtime[14],runtime[18],runtime[21],runtime[22],runtime[34],runtime[54],0,1,-2,'a','f'],[[0,1,0]],[[0,0]]]),
            '⟨1,2,3,1‿2,2‿1,1‿3,2‿2,3‿1⟩(⥊⊸(≠∘⊣∾˜¯1⊸⊑⊸(⌊∾⊣)∾×´⊸⌊)⌜≡○(⍋⥊)⥊⌜⟜(+`∘≠⟜(↕6)¨))↕4'    :(1, [[0,25,0,8,16,0,12,0,24,0,8,16,0,19,0,3,0,16,0,15,0,0,26,27,27,26,0,19,0,13,0,6,26,27,0,6,0,9,20,0,17,0,4,27,0,13,0,2,0,18,0,14,0,1,26,27,0,7,0,5,0,7,0,2,21,0,18,0,10,0,18,0,23,27,27,21,0,11,0,7,26,0,5,0,16,0,3,27,21,0,18,0,6,27,26,21,0,20,0,21,0,22,0,20,0,21,11,2,0,21,0,20,11,2,0,20,0,22,11,2,0,21,0,21,11,2,0,22,0,20,11,2,11,8,17,7],[runtime[0],runtime[2],runtime[6],runtime[14],runtime[18],runtime[20],runtime[22],runtime[23],runtime[28],runtime[34],runtime[37],runtime[45],runtime[47],runtime[48],runtime[50],runtime[52],runtime[53],runtime[54],runtime[55],runtime[56],1,2,3,-1,6,4],[[0,1,0]],[[0,0]]]),
            '((⥊˜-⥊⟜2‿0)∘≠≡⍋+⍒)2/↕5'                                                           :(1, [[0,14,0,5,16,0,6,0,12,17,0,8,0,0,0,7,21,0,3,0,2,0,10,0,12,0,13,11,2,0,11,0,4,27,0,1,0,9,0,4,26,21,27,21,16,7],[runtime[0],runtime[1],runtime[14],runtime[18],runtime[22],runtime[28],runtime[33],runtime[34],runtime[35],runtime[45],runtime[53],runtime[56],2,0,5],[[0,1,0]],[[0,0]]]),
            '∧⊏⟨+⟩'                                                                            :(BQNError, [[0,0,11,1,0,2,16,0,1,16,7],[runtime[0],runtime[10],runtime[36]],[[0,1,0]],[[0,0]]]),
            '∧+‿-'                                                                             :(BQNError, [[0,0,0,1,11,2,0,2,16,7],[runtime[0],runtime[1],runtime[10]],[[0,1,0]],[[0,0]]]),
            "∨'c'"                                                                             :(BQNError, [[0,1,0,0,16,7],[runtime[11],'c'],[[0,1,0]],[[0,0]]]),
            '"edcba"≡∨"bdace"'                                                                 :(1, [[0,3,0,0,16,0,1,0,2,17,7],[runtime[11],runtime[18],bqnstr("edcba"),bqnstr("bdace")],[[0,1,0]],[[0,0]]]),
            '(↕7)≡∧⍋|⟜⌽1+↕7'                                                                   :(1, [[0,8,0,4,16,0,0,0,9,17,0,5,0,7,0,1,27,16,0,6,16,0,2,16,0,3,0,8,0,4,16,17,7],[runtime[0],runtime[8],runtime[10],runtime[18],runtime[28],runtime[31],runtime[34],runtime[56],7,1],[[0,1,0]],[[0,0]]]),
            '(∧≡⌽)⟨↕0‿3‿1,↕0‿1‿1⟩'                                                             :(1, [[0,4,0,5,0,6,11,3,0,2,16,0,4,0,6,0,6,11,3,0,2,16,11,2,0,3,0,1,0,0,21,16,7],[runtime[10],runtime[18],runtime[28],runtime[31],0,3,1],[[0,1,0]],[[0,0]]]),
            '⍋˜6'                                                                              :(BQNError, [[0,2,0,1,0,0,26,16,7],[runtime[34],runtime[45],6],[[0,1,0]],[[0,0]]]),
            '⍒⟜↕4'                                                                             :(BQNError, [[0,3,0,0,0,2,0,1,27,16,7],[runtime[28],runtime[35],runtime[56],4],[[0,1,0]],[[0,0]]]),
            '(3‿2‿4⥊0)⍋4⥊1'                                                                    :(BQNError, [[0,6,0,0,0,4,17,0,1,0,5,0,0,0,2,0,3,0,4,11,3,17,17,7],[runtime[22],runtime[34],3,2,4,0,1],[[0,1,0]],[[0,0]]]),
            '(3‿2‿4⥊0)⍒1'                                                                      :(BQNError, [[0,6,0,1,0,5,0,0,0,2,0,3,0,4,11,3,17,17,7],[runtime[22],runtime[35],3,2,4,0,1],[[0,1,0]],[[0,0]]]),
            '⟨+⟩⍋↕6'                                                                           :(BQNError, [[0,3,0,1,16,0,2,0,0,11,1,17,7],[runtime[0],runtime[28],runtime[34],6],[[0,1,0]],[[0,0]]]),
            '⟨1‿3‿1,1‿3‿2⟩⍒⟨1‿3‿{𝕩}⟩'                                                          :(BQNError, [[0,1,0,2,1,1,11,3,11,1,0,0,0,1,0,2,0,1,11,3,0,1,0,2,0,3,11,3,11,2,17,7,34,0,1,7],[runtime[35],1,3,2],[[0,1,0],[0,0,1]],[[0,0],[32,3]]]),
            '⟨1,3,∞,\'e\',\'i\'⟩ (⍋≡≠∘⊣(⊣↓⊢⍋⊸⊏+`∘>)⍋∘∾) (2÷˜↕8)∾"aegz"'                        :(1, [[0,23,0,7,0,20,0,9,16,0,12,0,1,26,0,19,17,17,0,7,0,14,0,10,27,0,2,0,14,0,13,0,0,26,27,0,11,0,15,0,10,27,0,6,21,0,8,0,5,21,0,5,0,14,0,3,27,21,0,4,0,10,21,0,16,0,17,0,18,0,21,0,22,11,5,17,7],[runtime[0],runtime[3],runtime[13],runtime[14],runtime[18],runtime[20],runtime[21],runtime[23],runtime[27],runtime[28],runtime[34],runtime[36],runtime[45],runtime[52],runtime[53],runtime[55],1,3,math.inf,2,8,'e','i',bqnstr("aegz")],[[0,1,0]],[[0,0]]]),
            '⟨\'z\',\'d\',1‿0,0⟩ (⍒≡≠∘⊣(⊣↓⊢⍋⊸⊏+`∘>)⍒∘∾) (2÷˜↕8)∾"aegz"'                        :(1, [[0,23,0,7,0,20,0,9,16,0,13,0,1,26,0,19,17,17,0,7,0,15,0,11,27,0,2,0,15,0,14,0,0,26,27,0,12,0,16,0,10,27,0,6,21,0,8,0,5,21,0,5,0,15,0,3,27,21,0,4,0,11,21,0,21,0,22,0,17,0,18,11,2,0,18,11,4,17,7],[runtime[0],runtime[3],runtime[13],runtime[14],runtime[18],runtime[20],runtime[21],runtime[23],runtime[27],runtime[28],runtime[34],runtime[35],runtime[36],runtime[45],runtime[52],runtime[53],runtime[55],1,0,2,8,'z','d',bqnstr("aegz")],[[0,1,0]],[[0,0]]]),
            '(<∘⌈≡(↕6)⊸⍋)2.5'                                                                  :(1, [[0,8,0,4,0,6,0,7,0,3,16,27,0,2,0,0,0,5,0,1,27,21,16,7],[runtime[7],runtime[12],runtime[18],runtime[28],runtime[34],runtime[53],runtime[55],6,2.5],[[0,1,0]],[[0,0]]]),
            '(<1)≡(↕2‿3)⍋1+↕3'                                                                 :(1, [[0,7,0,3,16,0,0,0,5,17,0,4,0,6,0,7,11,2,0,3,16,17,0,2,0,5,0,1,16,17,7],[runtime[0],runtime[12],runtime[18],runtime[28],runtime[34],1,2,3],[[0,1,0]],[[0,0]]]),
            '(<0)≡"abc"⥊⊸⍒○<≍"acc"'                                                            :(1, [[0,9,0,3,16,0,0,0,5,0,4,0,6,0,2,27,27,0,8,17,0,1,0,7,0,0,16,17,7],[runtime[12],runtime[18],runtime[22],runtime[24],runtime[35],runtime[54],runtime[55],0,bqnstr("abc"),bqnstr("acc")],[[0,1,0]],[[0,0]]]),
            '⊒∞'                                                                               :(BQNError, [[0,1,0,0,16,7],[runtime[39],math.inf],[[0,1,0]],[[0,0]]]),
            '⊒⊏"y"'                                                                            :(BQNError, [[0,2,0,0,16,0,1,16,7],[runtime[36],runtime[39],bqnstr("y")],[[0,1,0]],[[0,0]]]),
            '⊒⊸≡""'                                                                            :(1, [[0,3,0,0,0,2,0,1,27,16,7],[runtime[18],runtime[39],runtime[55],bqnstr("")],[[0,1,0]],[[0,0]]]),
            '("001001231"-\'0\')≡⊒"eccdaeccd"'                                                 :(1, [[0,5,0,2,16,0,1,0,3,0,0,0,4,17,17,7],[runtime[1],runtime[18],runtime[39],'0',bqnstr("001001231"),bqnstr("eccdaeccd")],[[0,1,0]],[[0,0]]]),
            '(↕∘≠≡⊒˜)"abbc"+⌜↕6'                                                               :(1, [[0,8,0,3,16,0,6,0,0,26,0,9,17,0,5,0,4,26,0,2,0,1,0,7,0,3,27,21,16,7],[runtime[0],runtime[14],runtime[18],runtime[28],runtime[39],runtime[45],runtime[48],runtime[53],6,bqnstr("abbc")],[[0,1,0]],[[0,0]]]),
            '(3⌊∘÷˜↕8)≡⊒8‿2⥊4÷˜↕3'                                                             :(1, [[0,8,0,4,16,0,6,0,0,26,0,11,17,0,3,0,9,0,10,11,2,17,0,5,16,0,2,0,9,0,4,16,0,6,0,0,0,7,0,1,27,26,0,8,17,17,7],[runtime[3],runtime[6],runtime[18],runtime[22],runtime[28],runtime[39],runtime[45],runtime[53],3,8,2,4],[[0,1,0]],[[0,0]]]),
            '\'c\'⊒"cde"'                                                                      :(BQNError, [[0,2,0,0,0,1,17,7],[runtime[39],'c',bqnstr("cde")],[[0,1,0]],[[0,0]]]),
            '(0‿4‿1‿1⥊0)⊒4‿1⥊↕4'                                                               :(BQNError, [[0,4,0,1,16,0,0,0,4,0,5,11,2,17,0,2,0,3,0,0,0,3,0,4,0,5,0,5,11,4,17,17,7],[runtime[22],runtime[28],runtime[39],0,4,1],[[0,1,0]],[[0,0]]]),
            '("244031444"-\'0\')≡"bbac"⊒"aaabcbcbc"'                                           :(1, [[0,6,0,2,0,5,17,0,1,0,3,0,0,0,4,17,17,7],[runtime[1],runtime[18],runtime[39],'0',bqnstr("244031444"),bqnstr("bbac"),bqnstr("aaabcbcbc")],[[0,1,0]],[[0,0]]]),
            '(<3)≡1‿1‿1⊒0'                                                                     :(1, [[0,5,0,2,0,4,0,4,0,4,11,3,17,0,1,0,3,0,0,16,17,7],[runtime[12],runtime[18],runtime[39],3,1,0],[[0,1,0]],[[0,0]]]),
            '(<0)≡(0‿4‿1⥊0)⊒4‿1⥊↕4'                                                            :(1, [[0,6,0,3,16,0,2,0,6,0,7,11,2,17,0,4,0,5,0,2,0,5,0,6,0,7,11,3,17,17,0,1,0,5,0,0,16,17,7],[runtime[12],runtime[18],runtime[22],runtime[28],runtime[39],0,4,1],[[0,1,0]],[[0,0]]]),
            '4(⌊⟜(↕≠)≡↑⊒⊢)7‿3⥊1‿1‿3‿1‿1'                                                       :(1, [[0,12,0,12,0,11,0,12,0,12,11,5,0,4,0,10,0,11,11,2,17,0,3,0,7,0,5,21,0,2,0,1,0,6,20,0,8,0,0,27,21,0,9,17,7],[runtime[6],runtime[14],runtime[18],runtime[21],runtime[22],runtime[26],runtime[28],runtime[39],runtime[56],4,7,3,1],[[0,1,0]],[[0,0]]]),
            '(2‿3‿0≍3‿1‿3)≡"cca"⊒○(≍˜⎉0)3↕"abcd"'                                              :(1, [[0,12,0,2,0,8,17,0,9,0,6,0,4,0,1,26,27,0,5,0,3,27,0,11,17,0,0,0,8,0,10,0,8,11,3,0,1,0,7,0,8,0,9,11,3,17,17,7],[runtime[18],runtime[24],runtime[28],runtime[39],runtime[45],runtime[54],runtime[60],2,3,0,1,bqnstr("cca"),bqnstr("abcd")],[[0,1,0]],[[0,0]]]),
        })
        # fmt: on


class InfefredTests(RuntimeBasedTestCase):
    def test_identity(self):
        """https://github.com/mlochbaum/BQN/blob/ea6597c92f75320319cd7366423c2c97b7e2d3e4/test/cases/identity.bqn"""
        runtime = self.runtime
        # fmt: off
        self.runcases({
            # Fold
            '∧´ {𝕩≡𝕎´⟨⟩}´¨ ⟨+‿0,-‿0,×‿1,÷‿1,∨‿0,∧‿1⟩'    :(1, [[0,0,0,9,11,2,0,1,0,9,11,2,0,2,0,10,11,2,0,3,0,10,11,2,0,5,0,9,11,2,0,4,0,10,11,2,11,6,0,7,0,8,1,1,26,26,16,0,8,0,4,26,16,7,11,0,0,8,34,0,2,26,16,0,6,34,0,1,17,7],[runtime[0],runtime[1],runtime[2],runtime[3],runtime[10],runtime[11],runtime[18],runtime[47],runtime[50],0,1],[[0,1,0],[0,0,[[],[1]]]],[[0,0],[54,3]]]),
            '∧´ {𝕩≡𝕎´⟨⟩}´¨ ⟨⋆‿1,¬‿1,⌊‿∞,⌈‿¯∞⟩'           :(1, [[0,0,0,8,11,2,0,3,0,8,11,2,0,1,0,9,11,2,0,2,0,10,11,2,11,4,0,6,0,7,1,1,26,26,16,0,7,0,4,26,16,7,11,0,0,7,34,0,2,26,16,0,5,34,0,1,17,7],[runtime[4],runtime[6],runtime[7],runtime[9],runtime[10],runtime[18],runtime[47],runtime[50],1,math.inf,-math.inf],[[0,1,0],[0,0,[[],[1]]]],[[0,0],[42,3]]]),
            '∧´ {𝕩≡𝕎´⟨⟩}´¨ ⟨≠‿0,=‿1,>‿0,≥‿1⟩'            :(1, [[0,2,0,8,11,2,0,3,0,9,11,2,0,1,0,8,11,2,0,4,0,9,11,2,11,4,0,6,0,7,1,1,26,26,16,0,7,0,0,26,16,7,11,0,0,7,34,0,2,26,16,0,5,34,0,1,17,7],[runtime[10],runtime[13],runtime[14],runtime[15],runtime[17],runtime[18],runtime[47],runtime[50],0,1],[[0,1,0],[0,0,[[],[1]]]],[[0,0],[42,3]]]),
            '√´↕0'                                       :(BQNError, [[0,3,0,1,16,0,2,0,0,26,16,7],[runtime[5],runtime[28],runtime[50],0],[[0,1,0]],[[0,0]]]),
            '|´↕0'                                       :(BQNError, [[0,3,0,1,16,0,2,0,0,26,16,7],[runtime[8],runtime[28],runtime[50],0],[[0,1,0]],[[0,0]]]),
            '⊢´""'                                       :(BQNError, [[0,2,0,1,0,0,26,16,7],[runtime[21],runtime[50],bqnstr("")],[[0,1,0]],[[0,0]]]),
            '⊣´""'                                       :(BQNError, [[0,2,0,1,0,0,26,16,7],[runtime[20],runtime[50],bqnstr("")],[[0,1,0]],[[0,0]]]),
            '∾´⟨⟩'                                       :(BQNError, [[11,0,0,1,0,0,26,16,7],[runtime[23],runtime[50]],[[0,1,0]],[[0,0]]]),
            '≍´⟨⟩'                                       :(BQNError, [[11,0,0,1,0,0,26,16,7],[runtime[24],runtime[50]],[[0,1,0]],[[0,0]]]),

            # Insert
            '∧´ {(3‿1⥊𝕩)≡𝕎˝0‿3‿1⥊""}´¨ ⟨+‿0,-‿0,×‿1,÷‿1,∨‿0,∧‿1,⋆‿1,¬‿1,⌊‿∞,⌈‿¯∞,≠‿0,=‿1,>‿0,≥‿1⟩'    :(1, [[0,0,0,21,11,2,0,1,0,21,11,2,0,2,0,20,11,2,0,3,0,20,11,2,0,9,0,21,11,2,0,8,0,20,11,2,0,4,0,20,11,2,0,7,0,20,11,2,0,5,0,22,11,2,0,6,0,23,11,2,0,11,0,21,11,2,0,12,0,20,11,2,0,10,0,21,11,2,0,13,0,20,11,2,11,14,0,16,0,17,1,1,26,26,16,0,17,0,8,26,16,7,0,24,0,15,0,21,0,19,0,20,11,3,17,0,18,34,0,2,26,16,0,14,34,0,1,0,15,0,19,0,20,11,2,17,17,7],[runtime[0],runtime[1],runtime[2],runtime[3],runtime[4],runtime[6],runtime[7],runtime[9],runtime[10],runtime[11],runtime[13],runtime[14],runtime[15],runtime[17],runtime[18],runtime[22],runtime[47],runtime[50],runtime[51],3,1,0,math.inf,-math.inf,bqnstr("")],[[0,1,0],[0,0,[[],[1]]]],[[0,0],[102,3]]]),
            '∾˝""'                                                                                    :(BQNError, [[0,2,0,1,0,0,26,16,7],[runtime[23],runtime[51],bqnstr("")],[[0,1,0]],[[0,0]]]),
            '(∾˝(↕5)⥊"") ≡ (≠⟜1⊸/↕5)⥊""'                                                              :(1, [[0,11,0,2,0,9,0,4,16,0,5,0,7,0,10,0,8,0,0,27,27,16,17,0,1,0,11,0,2,0,9,0,4,16,17,0,6,0,3,26,16,17,7],[runtime[14],runtime[18],runtime[22],runtime[23],runtime[28],runtime[33],runtime[51],runtime[55],runtime[56],5,1,bqnstr("")],[[0,1,0]],[[0,0]]]),
            '(∾˝¨≡⥊¨) (≍⥊0˙)⌜˜0‿2‿5'                                                                  :(1, [[0,9,0,10,0,11,11,3,0,5,0,7,0,4,0,9,26,0,1,0,3,21,26,26,16,0,6,0,1,26,0,0,0,6,0,8,0,2,26,26,21,16,7],[runtime[18],runtime[22],runtime[23],runtime[24],runtime[44],runtime[45],runtime[47],runtime[48],runtime[51],0,2,5],[[0,1,0]],[[0,0]]]),
            '⌽˝0‿3⥊⟨⟩'                                                                                :(BQNError, [[11,0,0,0,0,3,0,4,11,2,17,0,2,0,1,26,16,7],[runtime[22],runtime[31],runtime[51],0,3],[[0,1,0]],[[0,0]]]),
        })
        # fmt: on

    def test_under(self):
        """https://github.com/mlochbaum/BQN/blob/ea6597c92f75320319cd7366423c2c97b7e2d3e4/test/cases/under.bqn"""
        runtime = self.runtime
        # fmt: off
        self.runcases({
            # Invertible
            '(⊑≡⊑⌾⊢) ⟨↕3,2,<"abc"⟩'                                   :(1, [[0,6,0,3,16,0,7,0,8,0,0,16,11,3,0,2,0,5,0,4,27,0,1,0,4,21,16,7],[runtime[12],runtime[18],runtime[21],runtime[28],runtime[37],runtime[57],3,2,bqnstr("abc")],[[0,1,0]],[[0,0]]]),
            '3 (+≡+⌾⊣) 4'                                             :(1, [[0,5,0,2,0,3,0,0,27,0,1,0,0,21,0,4,17,7],[runtime[0],runtime[18],runtime[20],runtime[57],3,4],[[0,1,0]],[[0,0]]]),
            '(¯2⊸↓ ≡ 2⊸↓⌾⌽) ↕6'                                       :(1, [[0,8,0,2,16,0,3,0,5,0,1,0,4,0,7,27,27,0,0,0,1,0,4,0,6,27,21,16,7],[runtime[18],runtime[27],runtime[28],runtime[31],runtime[55],runtime[57],-2,2,6],[[0,1,0]],[[0,0]]]),
            '(1⊸↓⌾⍉ ≡ 1⊸↓˘) ↕3‿3'                                     :(1, [[0,8,0,8,11,2,0,2,16,0,4,0,1,0,5,0,7,27,26,0,0,0,3,0,6,0,1,0,5,0,7,27,27,21,16,7],[runtime[18],runtime[27],runtime[28],runtime[32],runtime[46],runtime[55],runtime[57],1,3],[[0,1,0]],[[0,0]]]),
            '7(⥊⌾(<˘)≡·<˘⁼⥊⟜(<˘))3‿3⥊↕9'                              :(1, [[0,10,0,3,16,0,2,0,9,0,9,11,2,17,0,4,0,0,26,0,6,0,2,27,0,5,0,4,0,0,26,26,20,0,1,0,4,0,0,26,0,7,0,2,27,21,0,8,17,7],[runtime[12],runtime[18],runtime[22],runtime[28],runtime[46],runtime[49],runtime[56],runtime[57],7,3,9],[[0,1,0]],[[0,0]]]),
            '"abcd" (⊣≡»⌾≍) ↕4'                                       :(1, [[0,6,0,3,16,0,2,0,5,0,4,27,0,0,0,1,21,0,7,17,7],[runtime[18],runtime[20],runtime[24],runtime[28],runtime[30],runtime[57],4,bqnstr("abcd")],[[0,1,0]],[[0,0]]]),
            '⍉⌾≍ "abc"'                                               :(BQNError, [[0,3,0,0,0,2,0,1,27,16,7],[runtime[24],runtime[32],runtime[57],bqnstr("abc")],[[0,1,0]],[[0,0]]]),
            '(⌽∘|⊸/4‿¯3) ≡ ↕∘≠⊸-⌾(3⊸⌽)↕7'                             :(1, [[0,13,0,4,16,0,5,0,8,0,12,27,0,9,0,0,0,8,0,2,0,7,0,4,27,27,27,16,0,3,0,10,0,11,11,2,0,6,0,8,0,1,0,7,0,5,27,27,16,17,7],[runtime[1],runtime[8],runtime[14],runtime[18],runtime[28],runtime[31],runtime[33],runtime[53],runtime[55],runtime[57],4,-3,3,7],[[0,1,0]],[[0,0]]]),
            # Structural
            # Monad
            '"bbcd" ≡ 1⊸+⌾⊑ "abcd"'                                   :(1, [[0,7,0,2,0,4,0,0,0,3,0,5,27,27,16,0,1,0,6,17,7],[runtime[0],runtime[18],runtime[37],runtime[55],runtime[57],1,bqnstr("bbcd"),bqnstr("abcd")],[[0,1,0]],[[0,0]]]),
            '(<∘- ≡ -⌾⊑) 4'                                           :(1, [[0,6,0,3,0,5,0,0,27,0,2,0,0,0,4,0,1,27,21,16,7],[runtime[1],runtime[12],runtime[18],runtime[37],runtime[53],runtime[57],4],[[0,1,0]],[[0,0]]]),
            '(⌽⌾⊏ ≡ ⌽⊸≍˝) "abc"≍"def"'                                :(1, [[0,8,0,1,0,7,17,0,4,0,1,0,5,0,2,27,26,0,0,0,3,0,6,0,2,27,21,16,7],[runtime[18],runtime[24],runtime[31],runtime[36],runtime[51],runtime[55],runtime[57],bqnstr("abc"),bqnstr("def")],[[0,1,0]],[[0,0]]]),
            '-⌾⊏ 4'                                                   :(BQNError, [[0,3,0,1,0,2,0,0,27,16,7],[runtime[1],runtime[36],runtime[57],4],[[0,1,0]],[[0,0]]]),
            '1 ≡ "cd"‿"ab"⊸⊐⌾< "ab"'                                  :(1, [[0,7,0,0,0,4,0,2,0,3,0,6,0,7,11,2,27,27,16,0,1,0,5,17,7],[runtime[12],runtime[18],runtime[38],runtime[55],runtime[57],1,bqnstr("cd"),bqnstr("ab")],[[0,1,0]],[[0,0]]]),
            '(0‿1+⌜0‿4‿2) ≡ ⍋∘⍋⌾⥊ "apl"≍"bqn"'                        :(1, [[0,13,0,3,0,12,17,0,2,0,7,0,4,0,6,0,4,27,27,16,0,1,0,8,0,10,0,11,11,3,0,5,0,0,26,0,8,0,9,11,2,17,17,7],[runtime[0],runtime[18],runtime[22],runtime[24],runtime[34],runtime[48],runtime[53],runtime[57],0,1,4,2,bqnstr("apl"),bqnstr("bqn")],[[0,1,0]],[[0,0]]]),
            '2 (⌽⌾⥊ ≡ 12|+) ⥊⟜(↕×´)6‿2'                               :(1, [[0,12,0,10,11,2,0,7,0,1,26,0,5,20,0,8,0,4,27,16,0,0,0,2,0,11,21,0,3,0,4,0,9,0,6,27,21,0,10,17,7],[runtime[0],runtime[2],runtime[8],runtime[18],runtime[22],runtime[28],runtime[31],runtime[50],runtime[56],runtime[57],2,12,6],[[0,1,0]],[[0,0]]]),
            '↕∘≠⊸+{𝔽≡𝔽¨⌾↑} "abcde"'                                   :(1, [[0,9,1,1,0,0,0,7,0,1,0,6,0,4,27,27,26,16,7,0,3,0,8,0,5,32,0,1,26,27,0,2,34,0,1,21,7],[runtime[0],runtime[14],runtime[18],runtime[26],runtime[28],runtime[47],runtime[53],runtime[55],runtime[57],bqnstr("abcde")],[[0,1,0],[1,1,1]],[[0,0],[19,2]]]),
            '2⊸+{𝔽≡𝔽¨⌾↓} "abcde"'                                     :(1, [[0,7,1,1,0,0,0,4,0,6,27,26,16,7,0,2,0,5,0,3,32,0,1,26,27,0,1,34,0,1,21,7],[runtime[0],runtime[18],runtime[27],runtime[47],runtime[55],runtime[57],2,bqnstr("abcde")],[[0,1,0],[1,1,1]],[[0,0],[14,2]]]),
            # Dyad
            '↕∘≠⊸+⌾(10⊸⥊)↕6'                                          :(BQNError, [[0,8,0,3,16,0,2,0,5,0,7,27,0,6,0,0,0,5,0,1,0,4,0,3,27,27,27,16,7],[runtime[0],runtime[14],runtime[22],runtime[28],runtime[53],runtime[55],runtime[57],10,6],[[0,1,0]],[[0,0]]]),
            '(⌽⍒⌊2÷˜↕7) ≡ ⌽˘⌾(⌊‿2⥊⊢)↕7'                               :(1, [[0,12,0,5,16,0,3,0,4,0,1,0,11,11,2,21,0,10,0,9,0,6,26,27,16,0,2,0,12,0,5,16,0,8,0,0,26,0,11,17,0,1,16,0,7,16,0,6,16,17,7],[runtime[3],runtime[6],runtime[18],runtime[21],runtime[22],runtime[28],runtime[31],runtime[35],runtime[45],runtime[46],runtime[57],2,7],[[0,1,0]],[[0,0]]]),
            '¯1‿0‿1‿3 ≡ -⟜(+´÷≠)⌾(3⊸↑)↕4'                             :(1, [[0,15,0,6,16,0,5,0,8,0,14,27,0,10,0,3,0,2,0,7,0,0,26,21,0,9,0,1,27,27,16,0,4,0,11,0,12,0,13,0,14,11,4,17,7],[runtime[0],runtime[1],runtime[3],runtime[14],runtime[18],runtime[26],runtime[28],runtime[50],runtime[55],runtime[56],runtime[57],-1,0,1,3,4],[[0,1,0]],[[0,0]]]),
            '"adcb" ≡ ⌽⌾(1⊸↓)"abcd"'                                  :(1, [[0,7,0,1,0,3,0,5,27,0,4,0,2,27,16,0,0,0,6,17,7],[runtime[18],runtime[27],runtime[31],runtime[55],runtime[57],1,bqnstr("adcb"),bqnstr("abcd")],[[0,1,0]],[[0,0]]]),
            '5‿6‿3‿0 ≡ (5‿3‿1⌾(0‿0⊸⍉)4‿3⥊0) +´∘×⎉1‿∞ 1+↕3'            :(1, [[0,13,0,4,16,0,0,0,15,17,0,15,0,17,11,2,0,10,0,1,0,7,0,6,0,0,26,27,27,0,14,0,3,0,16,0,13,11,2,17,0,5,0,8,0,14,0,14,11,2,27,0,9,0,11,0,13,0,15,11,3,27,16,17,0,2,0,11,0,12,0,13,0,14,11,4,17,7],[runtime[0],runtime[2],runtime[18],runtime[22],runtime[28],runtime[32],runtime[50],runtime[53],runtime[55],runtime[57],runtime[60],5,6,3,0,1,4,math.inf],[[0,1,0]],[[0,0]]]),
            '"AbcD" ≡ (\'A\'-\'a\')⊸+⌾(1‿0‿0‿1⊸/)"abcd"'              :(1, [[0,11,0,3,0,4,0,6,0,7,0,7,0,6,11,4,27,0,5,0,0,0,4,0,9,0,1,0,8,17,27,27,16,0,2,0,10,17,7],[runtime[0],runtime[1],runtime[18],runtime[33],runtime[55],runtime[57],1,0,'A','a',bqnstr("AbcD"),bqnstr("abcd")],[[0,1,0]],[[0,0]]]),
            '"AbcD" ≡ "ABCD"⊣⌾(1‿0‿0‿1⊸/)"abcd"'                      :(1, [[0,9,0,2,0,3,0,5,0,6,0,6,0,5,11,4,27,0,4,0,1,27,0,8,17,0,0,0,7,17,7],[runtime[18],runtime[20],runtime[33],runtime[55],runtime[57],1,0,bqnstr("AbcD"),bqnstr("ABCD"),bqnstr("abcd")],[[0,1,0]],[[0,0]]]),
            '↕∘≠⊸+⌾(2⊸/)↕5'                                           :(BQNError, [[0,8,0,2,16,0,3,0,5,0,7,27,0,6,0,0,0,5,0,1,0,4,0,2,27,27,27,16,7],[runtime[0],runtime[14],runtime[28],runtime[33],runtime[53],runtime[55],runtime[57],2,5],[[0,1,0]],[[0,0]]]),
            '(1⊸⌽ ≡ 2⊸⌽⌾(2⊸/)) ↕5'                                    :(1, [[0,8,0,1,16,0,3,0,4,0,7,27,0,5,0,2,0,4,0,7,27,27,0,0,0,2,0,4,0,6,27,21,16,7],[runtime[18],runtime[28],runtime[31],runtime[33],runtime[55],runtime[57],1,2,5],[[0,1,0]],[[0,0]]]),
            '"bdca" ≡ 1⊸⌽⌾(1‿3‿0⊸⊏)"abcd"'                            :(1, [[0,9,0,2,0,3,0,5,0,6,0,7,11,3,27,0,4,0,1,0,3,0,5,27,27,16,0,0,0,8,17,7],[runtime[18],runtime[31],runtime[36],runtime[55],runtime[57],1,3,0,bqnstr("bdca"),bqnstr("abcd")],[[0,1,0]],[[0,0]]]),
            '1⊸⌽⌾(1‿3‿3‿0⊸⊏)"abcd"'                                   :(BQNError, [[0,7,0,1,0,2,0,4,0,5,0,5,0,6,11,4,27,0,3,0,0,0,2,0,4,27,27,16,7],[runtime[31],runtime[36],runtime[55],runtime[57],1,3,0,bqnstr("abcd")],[[0,1,0]],[[0,0]]]),
            '((¯1⋆2∧⌜○(⌽0=↕)3)⊸× ≡ -⌾(1‿2⊑⊢))↕2‿3'                    :(1, [[0,15,0,17,11,2,0,7,16,0,6,0,9,0,18,0,15,11,2,21,0,13,0,0,27,0,5,0,1,0,12,0,17,0,7,0,4,0,16,21,0,8,20,0,11,0,10,0,3,26,27,0,15,17,0,2,0,14,17,27,21,16,7],[runtime[1],runtime[2],runtime[4],runtime[10],runtime[15],runtime[18],runtime[21],runtime[28],runtime[31],runtime[37],runtime[48],runtime[54],runtime[55],runtime[57],-1,2,0,3,1],[[0,1,0]],[[0,0]]]),
            '((0‿3≍1‿2)⊸+ ≡ ⟨1,2‿3⟩⊸+⌾(⟨1‿0,⟨1‿1,0‿1⟩⟩⊸⊑))↕2‿2'       :(1, [[0,10,0,10,11,2,0,3,16,0,4,0,5,0,9,0,7,11,2,0,9,0,9,11,2,0,7,0,9,11,2,11,2,11,2,27,0,6,0,0,0,5,0,9,0,10,0,8,11,2,11,2,27,27,0,1,0,0,0,5,0,9,0,10,11,2,0,2,0,7,0,8,11,2,17,27,21,16,7],[runtime[0],runtime[18],runtime[24],runtime[28],runtime[37],runtime[55],runtime[57],0,3,1,2],[[0,1,0]],[[0,0]]]),
            # Compound
            '(1+↕3) ≡ 1⊸↓⌾(@⊢·⊑<)↕4'                                  :(1, [[0,11,0,5,16,0,1,0,6,20,0,3,0,12,21,0,8,0,4,0,7,0,9,27,27,16,0,2,0,10,0,5,16,0,0,0,9,17,17,7],[runtime[0],runtime[12],runtime[18],runtime[21],runtime[27],runtime[28],runtime[37],runtime[55],runtime[57],1,3,4,'\0'],[[0,1,0]],[[0,0]]]),
            '"210abc" ≡ ⌽⌾((2÷˜≠)⊸↑)"012abc"'                         :(1, [[0,10,0,3,0,6,0,1,0,5,0,0,26,0,8,21,27,0,7,0,4,27,16,0,2,0,9,17,7],[runtime[3],runtime[14],runtime[18],runtime[26],runtime[31],runtime[45],runtime[55],runtime[57],2,bqnstr("210abc"),bqnstr("012abc")],[[0,1,0]],[[0,0]]]),
            '"bac"‿\'d\' ≡ ⌽⌾(2↑⊑)"abc"‿\'d\''                        :(1, [[0,8,0,6,11,2,0,3,0,1,0,5,21,0,4,0,2,27,16,0,0,0,7,0,6,11,2,17,7],[runtime[18],runtime[26],runtime[31],runtime[37],runtime[57],2,'d',bqnstr("bac"),bqnstr("abc")],[[0,1,0]],[[0,0]]]),
            '(⌽¨⌾(<2‿3⊸⊏) ≡ ⌽⌾(2‿3⊸⊏)) "abcdef"'                      :(1, [[0,9,0,3,0,5,0,7,0,8,11,2,27,0,6,0,2,27,0,1,0,3,0,5,0,7,0,8,11,2,27,0,0,20,0,6,0,4,0,2,26,27,21,16,7],[runtime[12],runtime[18],runtime[31],runtime[36],runtime[47],runtime[55],runtime[57],2,3,bqnstr("abcdef")],[[0,1,0]],[[0,0]]]),
            '"bdca" ≡ 1⊸⌽⌾(1‿3‿0˙⊏⊢)"abcd"'                           :(1, [[0,11,0,1,0,3,0,4,0,7,0,8,0,9,11,3,26,21,0,6,0,2,0,5,0,7,27,27,16,0,0,0,10,17,7],[runtime[18],runtime[21],runtime[31],runtime[36],runtime[44],runtime[55],runtime[57],1,3,0,bqnstr("bdca"),bqnstr("abcd")],[[0,1,0]],[[0,0]]]),
            # Multi-source
            '⟨3‿\'b\',\'a\'⟩ ≡ ⌽⌾(⊑∘⊑⋈1⊸⊑)"ab"‿3'                     :(1, [[0,11,0,7,11,2,0,3,0,5,0,8,27,0,1,0,3,0,4,0,3,27,21,0,6,0,2,27,16,0,0,0,7,0,9,11,2,0,10,11,2,17,7],[runtime[18],runtime[25],runtime[31],runtime[37],runtime[53],runtime[55],runtime[57],3,1,'b','a',bqnstr("ab")],[[0,1,0]],[[0,0]]]),
            '(4‿3⋈⊸∾"ba") ≡ ⌽⌾(⊑⋈·⌽1⊸↓)"ab"‿3‿4'                      :(1, [[0,12,0,9,0,8,11,3,0,3,0,6,0,10,27,0,4,20,0,2,0,5,21,0,7,0,4,27,16,0,0,0,11,0,1,0,6,0,2,27,0,8,0,9,11,2,17,17,7],[runtime[18],runtime[23],runtime[25],runtime[27],runtime[31],runtime[37],runtime[55],runtime[57],4,3,1,bqnstr("ba"),bqnstr("ab")],[[0,1,0]],[[0,0]]]),
            '⟨"ba"⟩ ≡ 2⊸⌽⌾(⊑∾⌽∘⊑)⟨"ab"⟩'                              :(1, [[0,9,11,1,0,3,0,4,0,2,27,0,1,0,3,21,0,6,0,2,0,5,0,7,27,27,16,0,0,0,8,11,1,17,7],[runtime[18],runtime[23],runtime[31],runtime[37],runtime[53],runtime[55],runtime[57],2,bqnstr("ba"),bqnstr("ab")],[[0,1,0]],[[0,0]]]),
            '"hg"‿"fed"‿""‿"cba" ≡ ⌽⌾∾"ab"‿"cde"‿""‿"fgh"'            :(1, [[0,8,0,9,0,6,0,10,11,4,0,1,0,3,0,2,27,16,0,0,0,4,0,5,0,6,0,7,11,4,17,7],[runtime[18],runtime[23],runtime[31],runtime[57],bqnstr("hg"),bqnstr("fed"),bqnstr(""),bqnstr("cba"),bqnstr("ab"),bqnstr("cde"),bqnstr("fgh")],[[0,1,0]],[[0,0]]]),
            '"ab"‿"gde"‿""‿"fch" ≡ ⌽⌾(2‿4‿6⊏∾)"ab"‿"cde"‿""‿"fgh"'    :(1, [[0,8,0,12,0,10,0,13,11,4,0,1,0,3,0,5,0,6,0,7,11,3,21,0,4,0,2,27,16,0,0,0,8,0,9,0,10,0,11,11,4,17,7],[runtime[18],runtime[23],runtime[31],runtime[36],runtime[57],2,4,6,bqnstr("ab"),bqnstr("gde"),bqnstr(""),bqnstr("fch"),bqnstr("cde"),bqnstr("fgh")],[[0,1,0]],[[0,0]]]),
            '"ac"‿"bd" ≡ ⍉⌾>"ab"‿"cd"'                                :(1, [[0,6,0,7,11,2,0,0,0,3,0,2,27,16,0,1,0,4,0,5,11,2,17,7],[runtime[13],runtime[18],runtime[32],runtime[57],bqnstr("ac"),bqnstr("bd"),bqnstr("ab"),bqnstr("cd")],[[0,1,0]],[[0,0]]]),
            '"aed"‿"cb" ≡ ⌽⌾(∾⌽) "abc"‿"de"'                          :(1, [[0,6,0,7,11,2,0,2,0,1,20,0,3,0,2,27,16,0,0,0,4,0,5,11,2,17,7],[runtime[18],runtime[23],runtime[31],runtime[57],bqnstr("aed"),bqnstr("cb"),bqnstr("abc"),bqnstr("de")],[[0,1,0]],[[0,0]]]),
            '-´⌾(⊑¨) "abc"‿"de"'                                      :(BQNError, [[0,5,0,6,11,2,0,2,0,1,26,0,4,0,3,0,0,26,27,16,7],[runtime[1],runtime[37],runtime[47],runtime[50],runtime[57],bqnstr("abc"),bqnstr("de")],[[0,1,0]],[[0,0]]]),
            '"dbc"‿"ae" ≡ ⌽⌾(⊑¨) "abc"‿"de"'                          :(1, [[0,7,0,8,11,2,0,3,0,2,26,0,4,0,1,27,16,0,0,0,5,0,6,11,2,17,7],[runtime[18],runtime[31],runtime[37],runtime[47],runtime[57],bqnstr("dbc"),bqnstr("ae"),bqnstr("abc"),bqnstr("de")],[[0,1,0]],[[0,0]]]),
            '"aec"‿"db" ≡ ⌽⌾(1⊑¨⊢) "abc"‿"de"'                        :(1, [[0,9,0,10,11,2,0,1,0,4,0,3,26,0,6,21,0,5,0,2,27,16,0,0,0,7,0,8,11,2,17,7],[runtime[18],runtime[21],runtime[31],runtime[37],runtime[47],runtime[57],1,bqnstr("aec"),bqnstr("db"),bqnstr("abc"),bqnstr("de")],[[0,1,0]],[[0,0]]]),
            '⟨⟨2‿1‿2‿3,1‿2‿3,0‿3⟩⟩ ≡ ⌽¨⌾(⊑¨¨) ⋈3↑↓↕4'                 :(1, [[0,13,0,4,16,0,3,16,0,2,0,11,17,0,1,16,0,7,0,7,0,6,26,26,0,8,0,7,0,5,26,27,16,0,0,0,9,0,10,0,9,0,11,11,4,0,10,0,9,0,11,11,3,0,12,0,11,11,2,11,3,11,1,17,7],[runtime[18],runtime[25],runtime[26],runtime[27],runtime[28],runtime[31],runtime[37],runtime[47],runtime[57],2,1,3,0,4],[[0,1,0]],[[0,0]]]),
            '⟨⟨2‿1‿2‿3,1‿2‿3,0‿3⟩⟩ ≡ ⌽¨⌾(⊑⚇¯2) ⋈3↑↓↕4'                :(1, [[0,15,0,4,16,0,3,16,0,2,0,12,17,0,1,16,0,14,0,9,0,6,27,0,8,0,7,0,5,26,27,16,0,0,0,10,0,11,0,10,0,12,11,4,0,11,0,10,0,12,11,3,0,13,0,12,11,2,11,3,11,1,17,7],[runtime[18],runtime[25],runtime[26],runtime[27],runtime[28],runtime[31],runtime[37],runtime[47],runtime[57],runtime[61],2,1,3,0,-2,4],[[0,1,0]],[[0,0]]]),
            '"dbe"‿"ac" ≡ ⌽˘⌾(0‿¯1⊑⌜⊢) "abc"‿"de"'                    :(1, [[0,11,0,12,11,2,0,1,0,5,0,3,26,0,7,0,8,11,2,21,0,6,0,4,0,2,26,27,16,0,0,0,9,0,10,11,2,17,7],[runtime[18],runtime[21],runtime[31],runtime[37],runtime[46],runtime[48],runtime[57],0,-1,bqnstr("dbe"),bqnstr("ac"),bqnstr("abc"),bqnstr("de")],[[0,1,0]],[[0,0]]]),
            '"dbe"‿"ac" ≡ ⌽⌾(0‿¯1⊏⚇∞‿¯1⊢) "abc"‿"de"'                 :(1, [[0,11,0,12,11,2,0,1,0,8,0,7,11,2,0,5,0,3,27,0,6,0,7,11,2,21,0,4,0,2,27,16,0,0,0,9,0,10,11,2,17,7],[runtime[18],runtime[21],runtime[31],runtime[36],runtime[57],runtime[61],0,-1,math.inf,bqnstr("dbe"),bqnstr("ac"),bqnstr("abc"),bqnstr("de")],[[0,1,0]],[[0,0]]]),
            '("bac"≍"def") ≡ ⌽˘⌾((-⟜1¨≢)⊸↑) "abc"≍"def"'              :(1, [[0,13,0,3,0,14,17,0,4,0,8,0,2,0,7,0,11,0,9,0,0,27,26,20,27,0,10,0,6,0,5,26,27,16,0,1,0,13,0,3,0,12,17,17,7],[runtime[1],runtime[18],runtime[19],runtime[24],runtime[26],runtime[31],runtime[46],runtime[47],runtime[55],runtime[56],runtime[57],1,bqnstr("bac"),bqnstr("def"),bqnstr("abc")],[[0,1,0]],[[0,0]]]),
            '"acbd" ≡ ⍉⌾(>2⊸↑⋈2⊸↓) "abcd"'                            :(1, [[0,10,0,4,0,6,0,8,27,0,2,0,3,0,6,0,8,27,21,0,0,20,0,7,0,5,27,16,0,1,0,9,17,7],[runtime[13],runtime[18],runtime[25],runtime[26],runtime[27],runtime[32],runtime[55],runtime[57],2,bqnstr("acbd"),bqnstr("abcd")],[[0,1,0]],[[0,0]]]),
            '("dbc"≍"aef") ≡ ⌽⌾(⊏˘) "abc"≍"def"'                      :(1, [[0,9,0,1,0,8,17,0,4,0,3,26,0,5,0,2,27,16,0,0,0,7,0,1,0,6,17,17,7],[runtime[18],runtime[24],runtime[31],runtime[36],runtime[46],runtime[57],bqnstr("dbc"),bqnstr("aef"),bqnstr("abc"),bqnstr("def")],[[0,1,0]],[[0,0]]]),
            '("aef"≍"dbc") ≡ ⌽⌾(2‿1⊏⎉1⊢) "abc"≍"def"'                 :(1, [[0,12,0,2,0,11,17,0,1,0,8,0,6,0,4,27,0,7,0,8,11,2,21,0,5,0,3,27,16,0,0,0,10,0,2,0,9,17,17,7],[runtime[18],runtime[21],runtime[24],runtime[31],runtime[36],runtime[57],runtime[60],2,1,bqnstr("aef"),bqnstr("dbc"),bqnstr("abc"),bqnstr("def")],[[0,1,0]],[[0,0]]]),
            '("abe"≍"dcf") ≡ ⌽⌾(2‿1⊏⎉¯1⊢) "abc"≍"def"'                :(1, [[0,13,0,2,0,12,17,0,1,0,9,0,6,0,4,27,0,7,0,8,11,2,21,0,5,0,3,27,16,0,0,0,11,0,2,0,10,17,17,7],[runtime[18],runtime[21],runtime[24],runtime[31],runtime[36],runtime[57],runtime[60],2,1,-1,bqnstr("abe"),bqnstr("dcf"),bqnstr("abc"),bqnstr("def")],[[0,1,0]],[[0,0]]]),
            '("aef"≍"dbc") ≡ ⌽⌾(2‿1⊏⎉(-˜○=)⊢) "abc"≍"def"'            :(1, [[0,16,0,4,0,15,17,0,3,0,1,0,8,0,7,0,0,26,27,0,10,0,6,27,0,11,0,12,11,2,21,0,9,0,5,27,16,0,2,0,14,0,4,0,13,17,17,7],[runtime[1],runtime[15],runtime[18],runtime[21],runtime[24],runtime[31],runtime[36],runtime[45],runtime[54],runtime[57],runtime[60],2,1,bqnstr("aef"),bqnstr("dbc"),bqnstr("abc"),bqnstr("def")],[[0,1,0]],[[0,0]]]),
            '"32sdlf"‿"10qd" ≡ ⌽⌾(∾2⊸↑¨) "01sdlf"‿"23qd"'             :(1, [[0,10,0,11,11,2,0,4,0,2,0,5,0,7,27,26,0,1,20,0,6,0,3,27,16,0,0,0,8,0,9,11,2,17,7],[runtime[18],runtime[23],runtime[26],runtime[31],runtime[47],runtime[55],runtime[57],2,bqnstr("32sdlf"),bqnstr("10qd"),bqnstr("01sdlf"),bqnstr("23qd")],[[0,1,0]],[[0,0]]]),
            # Fills
            '⌽⌾(1↓4↑⊢)"abc"'                                          :(BQNError, [[0,7,0,0,0,1,0,6,21,0,2,0,5,21,0,4,0,3,27,16,7],[runtime[21],runtime[26],runtime[27],runtime[31],runtime[57],1,4,bqnstr("abc")],[[0,1,0]],[[0,0]]]),
            # Computational
            '1⊸+⌾-4'              :(3, [[0,5,0,1,0,3,0,0,0,2,0,4,27,27,16,7],[runtime[0],runtime[1],runtime[55],runtime[57],1,4],[[0,1,0]],[[0,0]]]),
            '⌊0.5+ 4+⌾(⋆⁼)5'      :(20, [[0,7,0,3,0,1,26,0,4,0,0,27,0,6,17,0,0,0,5,17,0,2,16,7],[runtime[0],runtime[4],runtime[6],runtime[49],runtime[57],0.5,4,5],[[0,1,0]],[[0,0]]]),
            '⊢⌾2 3'               :(2, [[0,3,0,2,0,1,0,0,27,16,7],[runtime[21],runtime[57],2,3],[[0,1,0]],[[0,0]]]),
            '⊢⌾(2∘-) 3'           :(-2, [[0,5,0,0,0,2,0,4,27,0,3,0,1,27,16,7],[runtime[1],runtime[21],runtime[53],runtime[57],2,3],[[0,1,0]],[[0,0]]]),
            '∘‿+ ≡ ⊢⌾∘‿+ 1'       :(1, [[0,5,0,3,0,0,11,2,0,4,0,2,27,16,0,1,0,3,0,0,11,2,17,7],[runtime[0],runtime[18],runtime[21],runtime[53],runtime[57],1],[[0,1,0]],[[0,0]]]),
            '÷⟜2⌾(⋆⁼1-˜÷) 0.5'    :(0.5, [[0,9,0,1,0,3,0,0,26,0,8,21,0,4,0,2,26,20,0,6,0,7,0,5,0,1,27,27,16,7],[runtime[1],runtime[3],runtime[4],runtime[45],runtime[49],runtime[56],runtime[57],2,1,0.5],[[0,1,0]],[[0,0]]]),
        })
        # fmt: on

    def test_undo(self):
        """https://github.com/mlochbaum/BQN/blob/ea6597c92f75320319cd7366423c2c97b7e2d3e4/test/cases/undo.bqn"""
        runtime = self.runtime
        # fmt: off
        self.runcases({
            # Data
            "∧´{𝕩≡𝕩⁼𝕩}¨⟨¯∞,3,@,'⁼',↕4⟩"               :(1, [[0,6,0,7,0,9,0,10,0,8,0,2,16,11,5,0,3,1,1,26,16,0,5,0,0,26,16,7,32,0,1,0,4,32,0,1,26,16,0,1,34,0,1,17,7],[runtime[10],runtime[18],runtime[28],runtime[47],runtime[49],runtime[50],-math.inf,3,4,'\0','⁼'],[[0,1,0],[0,0,1]],[[0,0],[28,3]]]),
            '3⁼4'                                     :(BQNError, [[0,2,0,0,0,1,26,16,7],[runtime[49],3,4],[[0,1,0]],[[0,0]]]),
            '2‿3⁼2‿3.1'                               :(BQNError, [[0,1,0,3,11,2,0,0,0,1,0,2,11,2,26,16,7],[runtime[49],2,3,3.1],[[0,1,0]],[[0,0]]]),
            # Primitives
            '∧´ {(𝕎≡𝕎⁼)𝕩}⟜¯0.3‿0‿8¨ +‿-‿÷‿¬‿⊢‿⊣‿⌽'    :(1, [[0,0,0,1,0,2,0,3,0,7,0,6,0,8,11,7,0,9,0,13,0,14,0,15,11,3,0,12,1,1,27,26,16,0,11,0,4,26,16,7,34,0,1,0,10,32,0,2,26,0,5,34,0,2,21,16,7],[runtime[0],runtime[1],runtime[3],runtime[9],runtime[10],runtime[18],runtime[20],runtime[21],runtime[31],runtime[47],runtime[49],runtime[50],runtime[56],-0.3,0,8],[[0,1,0],[0,0,[[],[1]]]],[[0,0],[40,3]]]),
            "-⁼ 'a'"                                  :(BQNError, [[0,2,0,1,0,0,26,16,7],[runtime[1],runtime[49],'a'],[[0,1,0]],[[0,0]]]),
            '×⁼ 5'                                    :(BQNError, [[0,2,0,1,0,0,26,16,7],[runtime[2],runtime[49],5],[[0,1,0]],[[0,0]]]),
            '(√√⁼)⊸≡ 0‿0.4‿π‿1e9‿∞'                   :(1, [[0,4,0,5,0,6,0,7,0,8,11,5,0,1,0,3,0,2,0,0,26,0,0,20,27,16,7],[runtime[5],runtime[18],runtime[49],runtime[55],0,0.4,3.141592653589793,1000000000,math.inf],[[0,1,0]],[[0,0]]]),
            '(⋆⁼⋆)⊸≡ ↕4'                              :(1, [[0,5,0,2,16,0,1,0,4,0,0,0,3,0,0,26,20,27,16,7],[runtime[4],runtime[18],runtime[28],runtime[49],runtime[55],4],[[0,1,0]],[[0,0]]]),
            '1e¯14>|1-⋆+´⋆⁼1(⊢÷«)1+↕11'               :(1, [[0,13,0,7,16,0,0,0,12,17,0,8,0,2,0,6,21,0,12,17,0,9,0,3,26,16,0,10,0,0,26,16,0,3,16,0,1,0,12,17,0,4,16,0,5,0,11,17,7],[runtime[0],runtime[1],runtime[3],runtime[4],runtime[8],runtime[13],runtime[21],runtime[28],runtime[29],runtime[49],runtime[50],1e-14,1,11],[[0,1,0]],[[0,0]]]),
            '∧´ {𝕩≡6𝕎6𝕎⁼𝕩}⟜1‿2‿3¨ +‿-‿×‿÷‿√‿∧‿¬‿⊢'    :(1, [[0,0,0,1,0,2,0,3,0,4,0,6,0,5,0,8,11,8,0,9,0,14,0,15,0,16,11,3,0,12,1,1,27,26,16,0,11,0,6,26,16,7,32,0,1,0,10,32,0,2,26,0,13,17,34,0,2,0,13,17,0,7,34,0,1,17,7],[runtime[0],runtime[1],runtime[2],runtime[3],runtime[5],runtime[9],runtime[10],runtime[18],runtime[21],runtime[47],runtime[49],runtime[50],runtime[56],6,1,2,3],[[0,1,0],[0,0,[[],[1]]]],[[0,0],[42,3]]]),
            "'a' ≡ 3+⁼'d'"                            :(1, [[0,5,0,2,0,0,26,0,3,17,0,1,0,4,17,7],[runtime[0],runtime[18],runtime[49],3,'a','d'],[[0,1,0]],[[0,0]]]),
            "'d'-⁼'a'"                                :(3, [[0,3,0,1,0,0,26,0,2,17,7],[runtime[1],runtime[49],'d','a'],[[0,1,0]],[[0,0]]]),
            '0.3‿1.01‿π(⋆⁼⌜≡÷˜⌜○(⋆⁼))0‿2‿5.6‿∞'       :(1, [[0,10,0,11,0,12,0,13,11,4,0,5,0,1,26,0,6,0,4,0,3,0,0,26,26,27,0,2,0,4,0,5,0,1,26,26,21,0,7,0,8,0,9,11,3,17,7],[runtime[3],runtime[4],runtime[18],runtime[45],runtime[48],runtime[49],runtime[54],0.3,1.01,3.141592653589793,0,2,5.6,math.inf],[[0,1,0]],[[0,0]]]),
            '(⊢≡⊣⁼˜)"abcd"'                           :(1, [[0,5,0,3,0,4,0,1,26,26,0,0,0,2,21,16,7],[runtime[18],runtime[20],runtime[21],runtime[45],runtime[49],bqnstr("abcd")],[[0,1,0]],[[0,0]]]),
            '"ab"⊣⁼"ac"'                              :(BQNError, [[0,3,0,1,0,0,26,0,2,17,7],[runtime[20],runtime[49],bqnstr("ab"),bqnstr("ac")],[[0,1,0]],[[0,0]]]),
            '(<⁼<)¨⊸≡⟨0,⟨⟩,"abc"⟩'                    :(1, [[0,5,11,0,0,6,11,3,0,1,0,4,0,2,0,0,0,3,0,0,26,20,26,27,16,7],[runtime[12],runtime[18],runtime[47],runtime[49],runtime[55],0,bqnstr("abc")],[[0,1,0]],[[0,0]]]),
            '(/⁼/)⊸≡1‿0‿2‿4'                          :(1, [[0,4,0,5,0,6,0,7,11,4,0,0,0,3,0,1,0,2,0,1,26,20,27,16,7],[runtime[18],runtime[33],runtime[49],runtime[55],1,0,2,4],[[0,1,0]],[[0,0]]]),
            '⟨⟩≡/⁼⟨⟩'                                 :(1, [[11,0,0,2,0,1,26,16,0,0,11,0,17,7],[runtime[18],runtime[33],runtime[49]],[[0,1,0]],[[0,0]]]),
            '(3⊸⌽≡2⌽⁼⊢)↕5'                            :(1, [[0,8,0,2,16,0,1,0,4,0,3,26,0,7,21,0,0,0,3,0,5,0,6,27,21,16,7],[runtime[18],runtime[21],runtime[28],runtime[31],runtime[49],runtime[55],3,2,5],[[0,1,0]],[[0,0]]]),
            '((≢⍉⁼)≡¯1⌽≢)↕↕4'                         :(1, [[0,7,0,2,16,0,2,16,0,1,0,3,0,6,21,0,0,0,5,0,4,26,0,1,20,21,16,7],[runtime[18],runtime[19],runtime[28],runtime[31],runtime[32],runtime[49],-1,4],[[0,1,0]],[[0,0]]]),
            '≡´⍉⍟¯1‿2⥊⟜(↕×´)2‿3‿3'                    :(1, [[0,9,0,10,0,10,11,3,0,5,0,0,26,0,3,20,0,6,0,2,27,16,0,8,0,9,11,2,0,7,0,4,27,16,0,5,0,1,26,16,7],[runtime[2],runtime[18],runtime[22],runtime[28],runtime[32],runtime[50],runtime[56],runtime[62],-1,2,3],[[0,1,0]],[[0,0]]]),
            '2‿1(⊢≡⊣⍉⍉⁼)⥊⟜(↕×´)2‿3‿1‿4'               :(1, [[0,10,0,12,0,11,0,13,11,4,0,8,0,0,26,0,5,20,0,9,0,4,27,16,0,7,0,6,26,0,6,0,2,21,0,1,0,3,21,0,10,0,11,11,2,17,7],[runtime[2],runtime[18],runtime[20],runtime[21],runtime[22],runtime[28],runtime[32],runtime[49],runtime[50],runtime[56],2,1,3,4],[[0,1,0]],[[0,0]]]),
            # Self/Swap
            '∧´ {6(𝕎˜⁼≡𝕎⁼)𝕩}⟜¯0.8‿0‿3¨ +‿×‿∧'         :(1, [[0,0,0,1,0,2,11,3,0,5,0,10,0,11,0,12,11,3,0,8,1,1,27,26,16,0,7,0,2,26,16,7,34,0,1,0,6,32,0,2,26,0,3,0,6,0,4,34,0,2,26,26,21,0,9,17,7],[runtime[0],runtime[2],runtime[10],runtime[18],runtime[45],runtime[47],runtime[49],runtime[50],runtime[56],6,-0.8,0,3],[[0,1,0],[0,0,[[],[1]]]],[[0,0],[32,3]]]),
            '+˜⁼7'                                    :(3.5, [[0,3,0,2,0,1,0,0,26,26,16,7],[runtime[0],runtime[45],runtime[49],7],[[0,1,0]],[[0,0]]]),
            '∨˜⁼0.75'                                 :(0.5, [[0,3,0,2,0,1,0,0,26,26,16,7],[runtime[11],runtime[45],runtime[49],0.75],[[0,1,0]],[[0,0]]]),
            '+´∊⟨√,×˜⁼,∧˜⁼⟩{𝕎𝕩}⌜0‿2‿∞'                :(1, [[0,9,0,10,0,11,11,3,0,6,1,1,26,0,2,0,7,0,5,0,1,26,26,0,7,0,5,0,3,26,26,11,3,17,0,4,16,0,8,0,0,26,16,7,34,0,1,34,0,2,16,7],[runtime[0],runtime[2],runtime[5],runtime[10],runtime[40],runtime[45],runtime[48],runtime[49],runtime[50],0,2,math.inf],[[0,1,0],[0,0,[[],[1]]]],[[0,0],[44,3]]]),
            '∧´ -‿÷‿⋆ {3(𝕎˜⁼≡𝕏)2‿π∾⋆2}¨ +‿×‿√'        :(1, [[0,0,0,2,0,5,11,3,0,10,1,1,26,0,1,0,3,0,4,11,3,17,0,12,0,6,26,16,7,0,14,0,4,16,0,8,0,14,0,15,11,2,17,34,0,1,0,7,0,11,0,9,34,0,2,26,26,21,0,13,17,7],[runtime[0],runtime[1],runtime[2],runtime[3],runtime[4],runtime[5],runtime[10],runtime[18],runtime[23],runtime[45],runtime[47],runtime[49],runtime[50],3,2,3.141592653589793],[[0,1,0],[0,0,[[],[1]]]],[[0,0],[29,3]]]),
            '16√˜⁼2'                                  :(4, [[0,4,0,2,0,1,0,0,26,26,0,3,17,7],[runtime[5],runtime[45],runtime[49],16,2],[[0,1,0]],[[0,0]]]),
            '4‿2‿0(¬˜⁼≡¯1++)1‿2‿9'                    :(1, [[0,9,0,6,0,10,11,3,0,0,0,0,0,8,21,0,2,0,4,0,3,0,1,26,26,21,0,5,0,6,0,7,11,3,17,7],[runtime[0],runtime[9],runtime[18],runtime[45],runtime[49],4,2,0,-1,1,9],[[0,1,0]],[[0,0]]]),
            # Mapping and scan
            '-¨⁼ 2'                                   :(BQNError, [[0,3,0,2,0,1,0,0,26,26,16,7],[runtime[1],runtime[47],runtime[49],2],[[0,1,0]],[[0,0]]]),
            '-⌜⁼ 2'                                   :(BQNError, [[0,3,0,2,0,1,0,0,26,26,16,7],[runtime[1],runtime[48],runtime[49],2],[[0,1,0]],[[0,0]]]),
            '-˘⁼ 2'                                   :(BQNError, [[0,3,0,2,0,1,0,0,26,26,16,7],[runtime[1],runtime[46],runtime[49],2],[[0,1,0]],[[0,0]]]),
            '-˘⁼ <2'                                  :(BQNError, [[0,4,0,1,16,0,3,0,2,0,0,26,26,16,7],[runtime[1],runtime[12],runtime[46],runtime[49],2],[[0,1,0]],[[0,0]]]),
            '-`⁼ 2'                                   :(BQNError, [[0,3,0,1,0,2,0,0,26,26,16,7],[runtime[1],runtime[49],runtime[52],2],[[0,1,0]],[[0,0]]]),
            '0-´⁼ 2'                                  :(BQNError, [[0,4,0,1,0,2,0,0,26,26,0,3,17,7],[runtime[1],runtime[49],runtime[50],0,2],[[0,1,0]],[[0,0]]]),
            '(∾˜ ≡ ·(<⌜⁼∾<¨⁼)<¨) "abcd"'              :(1, [[0,7,0,4,0,0,26,0,6,0,4,0,0,26,26,0,2,0,6,0,5,0,0,26,26,21,20,0,1,0,3,0,2,26,21,16,7],[runtime[12],runtime[18],runtime[23],runtime[45],runtime[47],runtime[48],runtime[49],bqnstr("abcd")],[[0,1,0]],[[0,0]]]),
            '"ab"‿"abc"≡1⌽⁼¨"ba"‿"bca"'               :(1, [[0,7,0,8,11,2,0,2,0,3,0,1,26,26,0,4,17,0,0,0,5,0,6,11,2,17,7],[runtime[18],runtime[31],runtime[47],runtime[49],1,bqnstr("ab"),bqnstr("abc"),bqnstr("ba"),bqnstr("bca")],[[0,1,0]],[[0,0]]]),
            '(2-=⌜˜↕2)≡/˘⁼0‿1‿1≍0‿0‿1'                :(1, [[0,11,0,11,0,12,11,3,0,3,0,11,0,12,0,12,11,3,17,0,9,0,7,0,5,26,26,16,0,2,0,10,0,4,16,0,6,0,8,0,1,26,26,16,0,0,0,10,17,17,7],[runtime[1],runtime[15],runtime[18],runtime[24],runtime[28],runtime[33],runtime[45],runtime[46],runtime[48],runtime[49],2,0,1],[[0,1,0]],[[0,0]]]),
            '2(⌽˘⁼≡·⍉⌽⁼⟜⍉)≍"abcde"'                   :(1, [[0,8,0,1,16,0,3,0,6,0,5,0,2,26,27,0,3,20,0,0,0,5,0,4,0,2,26,26,21,0,7,17,7],[runtime[18],runtime[24],runtime[31],runtime[32],runtime[46],runtime[49],runtime[56],2,bqnstr("abcde")],[[0,1,0]],[[0,0]]]),
            '(4⥊1) ≡ +`⁼ 1+↕4'                        :(1, [[0,6,0,3,16,0,0,0,7,17,0,4,0,5,0,0,26,26,16,0,1,0,7,0,2,0,6,17,17,7],[runtime[0],runtime[18],runtime[22],runtime[28],runtime[49],runtime[52],4,1],[[0,1,0]],[[0,0]]]),
            '⟨⟩ ≡ !`⁼⟨⟩'                              :(1, [[11,0,0,2,0,3,0,1,26,26,16,0,0,11,0,17,7],[runtime[18],runtime[43],runtime[49],runtime[52]],[[0,1,0]],[[0,0]]]),
            '(-⟜» ≡ +`⁼) 2|⌊×⌜˜π+↕5'                  :(1, [[0,15,0,6,16,0,0,0,14,17,0,8,0,9,0,2,26,26,16,0,3,16,0,4,0,13,17,0,10,0,11,0,0,26,26,0,5,0,7,0,12,0,1,27,21,16,7],[runtime[0],runtime[1],runtime[2],runtime[6],runtime[8],runtime[18],runtime[28],runtime[30],runtime[45],runtime[48],runtime[49],runtime[52],runtime[56],2,3.141592653589793,5],[[0,1,0]],[[0,0]]]),
            '(5⥊2)≡2÷`⁼2⋆-↕5'                         :(1, [[0,8,0,5,16,0,0,16,0,2,0,9,17,0,6,0,7,0,1,26,26,0,9,17,0,3,0,9,0,4,0,8,17,17,7],[runtime[1],runtime[3],runtime[4],runtime[18],runtime[22],runtime[28],runtime[49],runtime[52],5,2],[[0,1,0]],[[0,0]]]),
            '(0‿1‿1×⌜⥊˜4)≡(↕4)+`⁼3‿4⥊↕12'             :(1, [[0,13,0,4,16,0,3,0,12,0,11,11,2,17,0,7,0,8,0,0,26,26,0,11,0,4,16,17,0,2,0,11,0,5,0,3,26,16,0,6,0,1,26,0,9,0,10,0,10,11,3,17,17,7],[runtime[0],runtime[2],runtime[18],runtime[22],runtime[28],runtime[45],runtime[48],runtime[49],runtime[52],0,1,4,3,12],[[0,1,0]],[[0,0]]]),
            '(↕3)+`⁼3‿4⥊↕12'                          :(BQNError, [[0,7,0,2,16,0,1,0,5,0,6,11,2,17,0,3,0,4,0,0,26,26,0,5,0,2,16,17,7],[runtime[0],runtime[22],runtime[28],runtime[49],runtime[52],3,4,12],[[0,1,0]],[[0,0]]]),
            # Composition
            '(÷¬)⁼ 4'                                 :(0.75, [[0,3,0,2,0,1,0,0,20,26,16,7],[runtime[3],runtime[9],runtime[49],4],[[0,1,0]],[[0,0]]]),
            '⊢∘√⁼ 2'                                  :(4, [[0,4,0,2,0,0,0,3,0,1,27,26,16,7],[runtime[5],runtime[21],runtime[49],runtime[53],2],[[0,1,0]],[[0,0]]]),
            '(⌽/1‿3)≡(·+`⌽)⁼↕4'                       :(1, [[0,9,0,2,16,0,5,0,3,0,6,0,0,26,20,26,16,0,1,0,7,0,8,11,2,0,4,16,0,3,16,17,7],[runtime[0],runtime[18],runtime[28],runtime[31],runtime[33],runtime[49],runtime[52],1,3,4],[[0,1,0]],[[0,0]]]),
            '(⌽⊸/1‿3)≡(⌽·-`⌽)⁼↕4'                     :(1, [[0,10,0,2,16,0,5,0,3,0,6,0,0,26,20,0,3,20,26,16,0,1,0,8,0,9,11,2,0,4,0,7,0,3,27,16,17,7],[runtime[1],runtime[18],runtime[28],runtime[31],runtime[33],runtime[49],runtime[52],runtime[55],1,3,4],[[0,1,0]],[[0,0]]]),
            '(¯1‿0+⌜"BQN")≡(1⌽⍉)⁼3‿2⥊"PQMNAB"'        :(1, [[0,13,0,2,0,10,0,11,11,2,17,0,6,0,4,0,3,0,9,21,26,16,0,1,0,12,0,5,0,0,26,0,7,0,8,11,2,17,17,7],[runtime[0],runtime[18],runtime[22],runtime[31],runtime[32],runtime[48],runtime[49],-1,0,1,3,2,bqnstr("BQN"),bqnstr("PQMNAB")],[[0,1,0]],[[0,0]]]),
            '(3×·√2+¬)⁼6'                             :(-1, [[0,7,0,4,0,3,0,0,0,6,21,0,2,20,0,1,0,5,21,26,16,7],[runtime[0],runtime[2],runtime[5],runtime[9],runtime[49],3,2,6],[[0,1,0]],[[0,0]]]),
            '(3⊸√+⟜7)⁼2'                              :(1, [[0,7,0,2,0,6,0,4,0,0,27,0,1,0,3,0,5,27,20,26,16,7],[runtime[0],runtime[5],runtime[49],runtime[55],runtime[56],3,7,2],[[0,1,0]],[[0,0]]]),
            '5×⟜¬⁼10'                                 :(-1, [[0,5,0,2,0,1,0,3,0,0,27,26,0,4,17,7],[runtime[2],runtime[9],runtime[49],runtime[56],5,10],[[0,1,0]],[[0,0]]]),
            '(√-2{𝔽})⁼1'                              :(9, [[0,4,0,2,1,1,0,3,26,0,0,0,1,21,26,16,7,34,0,1,7],[runtime[1],runtime[5],runtime[49],2,1],[[0,1,0],[1,1,1]],[[0,0],[17,2]]]),
            '(√-2˙)⁼1'                                :(9, [[0,5,0,3,0,2,0,4,26,0,0,0,1,21,26,16,7],[runtime[1],runtime[5],runtime[44],runtime[49],2,1],[[0,1,0]],[[0,0]]]),
            '21(1+÷)⁼8'                               :(3, [[0,5,0,2,0,1,0,0,0,4,21,26,0,3,17,7],[runtime[0],runtime[3],runtime[49],21,1,8],[[0,1,0]],[[0,0]]]),
            '(2⊸⌽ ≡ 2⊸(-⊸⌽)⁼)"abcde"'                 :(1, [[0,6,0,3,0,2,0,4,0,0,27,0,4,0,5,27,26,0,1,0,2,0,4,0,5,27,21,16,7],[runtime[1],runtime[18],runtime[31],runtime[49],runtime[55],2,bqnstr("abcde")],[[0,1,0]],[[0,0]]]),
            '¯2 ÷˜○¬⁼ ¯1'                             :(4, [[0,6,0,3,0,1,0,4,0,2,0,0,26,27,26,0,5,17,7],[runtime[3],runtime[9],runtime[45],runtime[49],runtime[54],-2,-1],[[0,1,0]],[[0,0]]]),
            '1e¯12>|16- 2 ÷˜○(⋆⁼)⁼ 4'                 :(1, [[0,11,0,6,0,6,0,2,26,0,7,0,5,0,1,26,27,26,0,10,17,0,0,0,9,17,0,3,16,0,4,0,8,17,7],[runtime[1],runtime[3],runtime[4],runtime[8],runtime[13],runtime[45],runtime[49],runtime[54],1e-12,16,2,4],[[0,1,0]],[[0,0]]]),
            '(+`⌾⌽⁼≡+`⁼⌾⌽) ↕4'                        :(1, [[0,7,0,2,16,0,3,0,6,0,4,0,5,0,0,26,26,27,0,1,0,4,0,3,0,6,0,5,0,0,26,27,26,21,16,7],[runtime[0],runtime[18],runtime[28],runtime[31],runtime[49],runtime[52],runtime[57],4],[[0,1,0]],[[0,0]]]),
            '×˜⍟3⁼256'                                :(2, [[0,5,0,2,0,4,0,3,0,1,0,0,26,27,26,16,7],[runtime[2],runtime[45],runtime[49],runtime[62],3,256],[[0,1,0]],[[0,0]]]),
            '√⊘-{𝕗⁼≡6𝕗⁼⊢} ¯3‿2'                       :(1, [[0,7,0,8,11,2,1,1,0,0,0,5,0,1,27,26,16,7,0,3,0,4,32,0,1,26,0,6,21,0,2,0,4,34,0,1,26,21,7],[runtime[1],runtime[5],runtime[18],runtime[21],runtime[49],runtime[58],6,-3,2],[[0,1,0],[1,1,1]],[[0,0],[18,2]]]),
            '∧´ {(𝕎≡𝕎⁼⁼)𝕩}⟜2‿4‿1¨ /‿⌽‿<'              :(1, [[0,4,0,3,0,1,11,3,0,5,0,9,0,10,0,11,11,3,0,8,1,1,27,26,16,0,7,0,0,26,16,7,34,0,1,0,6,0,6,32,0,2,26,26,0,2,34,0,2,21,16,7],[runtime[10],runtime[12],runtime[18],runtime[31],runtime[33],runtime[47],runtime[49],runtime[50],runtime[56],2,4,1],[[0,1,0],[0,0,[[],[1]]]],[[0,0],[32,3]]]),
            # Extensions
            '9 ≡ ×˜⁼⁼ ¯3'                             :(1, [[0,5,0,3,0,3,0,2,0,0,26,26,26,16,0,1,0,4,17,7],[runtime[2],runtime[18],runtime[45],runtime[49],9,-3],[[0,1,0]],[[0,0]]]),
            '2 ≡ @ {≠𝕨‿𝕩}⁼⁼ π'                        :(1, [[0,4,0,2,0,2,1,1,26,26,0,5,17,0,1,0,3,17,7,34,0,2,34,0,1,11,2,0,0,16,7],[runtime[14],runtime[18],runtime[49],2,3.141592653589793,'\0'],[[0,1,0],[0,0,[[],[1]]]],[[0,0],[19,3]]]),
            '0‿2‿1‿1 ≡ /⁼2‿3‿1‿1'                     :(1, [[0,4,0,6,0,5,0,5,11,4,0,2,0,1,26,16,0,0,0,3,0,4,0,5,0,5,11,4,17,7],[runtime[18],runtime[33],runtime[49],0,2,1,3],[[0,1,0]],[[0,0]]]),
            '(/2‿3) ≡ /⁼⁼2‿3‿0'                       :(1, [[0,3,0,4,0,5,11,3,0,2,0,2,0,1,26,26,16,0,0,0,3,0,4,11,2,0,1,16,17,7],[runtime[18],runtime[33],runtime[49],2,3,0],[[0,1,0]],[[0,0]]]),
            '(/2‿3) ≡ /⍟¯1⁼2‿3‿0'                     :(1, [[0,4,0,5,0,7,11,3,0,2,0,6,0,3,0,1,27,26,16,0,0,0,4,0,5,11,2,0,1,16,17,7],[runtime[18],runtime[33],runtime[49],runtime[62],2,3,-1,0],[[0,1,0]],[[0,0]]]),
        })
        # fmt: on


if __name__ == "__main__":
    unittest.main()
